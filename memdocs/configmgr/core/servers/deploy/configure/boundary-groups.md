---
title: Настройка групп границ
titleSuffix: Configuration Manager
description: Как помочь клиентам найти системы сайта, используя группы границ для логической организации связанных сетевых расположений, называемых границами
ms.date: 04/01/2020
ms.prod: configuration-manager
ms.technology: configmgr-core
ms.topic: conceptual
ms.assetid: 5db2926f-f03e-49c7-b44b-e89b1a5a6779
author: mestew
ms.author: mstewart
manager: dougeby
ms.openlocfilehash: c9567cc441636bbda31262e0857e2fc6484c2af7
ms.sourcegitcommit: 555cb8102715afbe06c4de5fdbc943608f00b52c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/28/2020
ms.locfileid: "84153406"
---
# <a name="configure-boundary-groups-for-configuration-manager"></a>Настройка групп границ для Configuration Manager

*Область применения: Configuration Manager (Current Branch)*

Группы границ используются в Configuration Manager для логической организации связанных сетевых расположений ([границ](boundaries.md)), чтобы упростить управление инфраструктурой. Перед использованием группы границ ей необходимо назначить границы.

По умолчанию Configuration Manager создает стандартную группу границ для каждого сайта.

Чтобы настроить группу границ, нужно связать с ней границы (сетевые расположения) и роли системы сайта, например точки распространения. Эта конфигурация позволяет связать клиентов с серверами системы сайта (например, точками распространения), расположенными рядом с клиентами в сети.

Чтобы увеличить доступность серверов для более широкого диапазона расположений в сети, назначьте одну и ту же границу и один и тот же сервер нескольким группам границ.

Вот для чего клиенты используют группы границ.  

- Автоматическое назначение сайта  
- Чтобы найти сервер системы сайта, который может предоставить службу, в том числе:

  - точки распространения содержимого;  
  - Точки обновления программного обеспечения  
  - Точки миграции состояния  

    > [!NOTE]
    > Точка миграции состояния не использует резервные отношения. Дополнительные сведения см. в разделе [Резервирование](#fallback).

  - Предпочтительные точки управления  

    > [!NOTE]  
    > Использование предпочтительных точек управления позволяет включить этот параметр для иерархии, а не для конфигурации групп границ. Подробнее см. раздел [Включение предпочтительных точек управления](boundary-group-procedures.md#bkmk_proc-prefer).  

  - Шлюз управления облаком (начиная с версии 1902)

## <a name="boundary-groups-and-relationships"></a>Группы границ и отношения

Для каждой группы границ в иерархии вы можете назначить следующие элементы.

- Одну или несколько границ. **Текущая** группа границ клиента — это сетевое расположение, которое определено как граница, назначенная определенной группе границ. У клиента может быть несколько текущих групп границ.  

- Одну или несколько ролей систем сайта. Клиенты всегда могут использовать роли, связанные с текущей группой границ. В зависимости от дополнительных параметров, они иногда могут использовать роли, относящиеся к другим группам границ.  

Для каждой создаваемой группы границ можно настроить одностороннюю связь с другой группой границ. Такая связь называется **отношением**. Группы границ, на которые указывает созданная связь, называются **соседними**. Каждая группа границ может иметь несколько отношений с разными соседними группами границ.

Конфигурация каждого конкретного отношения определяет, при каких условиях клиент, который не может найти доступную систему сайта в текущей группе границ, может начать поиск в соседней группе границ. Такой поиск в дополнительных группах называется **резервированием**.

Дополнительные сведения см. в следующих разделах:  

- [Создание группы границ](boundary-group-procedures.md#bkmk_create)  
- [Настройка группы границ](boundary-group-procedures.md#bkmk_config)  

### <a name="show-boundary-groups-for-devices"></a><a name="bkmk_show-boundary"></a> Отображение групп границ для устройств

<!--6521835-->

Начиная с версии 2002, чтобы эффективнее выявлять и устранять неполадки поведения устройств с группами границ, теперь можно просматривать группы границ для конкретных устройств. В узле **Устройства** или при отображении элементов **коллекции устройств** добавьте в представление списка новый столбец **Группы границ**.

- Если устройство находится в нескольких группах границ, это значение представляет собой разделенный запятыми список имен групп границ.

- Данные обновляются или в случае, когда клиент выполняет запрос местоположения к сайту, или максимум каждые 24 часа.

- Если клиент перемещается и не является членом группы границ, значение остается пустым.

> [!NOTE]
> Эти сведения являются данными сайта и доступны только на первичных сайтах. При подключении Configuration Manager к сайту центра администрирования значение этого столбца отображаться не будет.

## <a name="fallback"></a>Резервирование

Чтобы помочь клиентам, которым не удается найти доступную систему сайта в пределах текущей группы границ, избежать проблем, вам следует определить отношения между группами границ в качестве резервного поведения. Резервирование позволяет расширить область поиска доступных систем сайта на дополнительные группы границ.

Отношения настраиваются на вкладке **Отношения** в свойствах группы границ. Чтобы настроить отношение, вам нужно создать связь, указывающую на соседнюю группу границ. Для каждого поддерживаемого типа ролей систем сайта можно указать отдельные параметры резервного варианта для перехода в соседнюю группу границ. Дополнительные сведения см. в разделе [Настройки резервного поведения](boundary-group-procedures.md#bkmk_bg-fallback).

Например, настраивая отношение к определенной группе границ, установите откат для точек распространения через 20 минут. Значение по умолчанию — 120 минут. Для более обширного примера см. [Пример использования группы границ](#example-of-using-boundary-groups).

Если клиент не может найти доступную роль системы сайта в текущей группе границ, он ожидает в течение периода резервного перехода, указанного в минутах. Этот период определяет, когда клиент начнет искать доступную систему сайта, связанную с соседней группой границ.  

Когда клиент не может найти доступную систему сайта, он начинает искать местоположения из соседних пограничных групп. Эта реакция на событие увеличивает пул доступных систем сайта. Конфигурация групп границ и их отношений определяет использование клиентом этого пула доступных систем сайта.

- Группа границ может иметь несколько отношений. Наличие такой конфигурации позволяет настроить для каждого типа системы сайта резервирование в разные соседние группы с разными интервалами.  

- Клиенты переходят только к той группе границ, которая является непосредственным соседом текущей группы границ.  

- Если клиент входит в несколько групп границ, текущая группа границ определяется как объединение всех групп границ клиента. Тогда клиент может при отработке резервирования перейти к соседней группе любой из этих групп границ.  

> [!NOTE]
> Роль точки миграции состояния не использует резервные отношения. Если вы добавляете роли точки миграции состояния и точки распространения на один и тот же сервер системы сайта, не настраивайте резервную систему для группы границ. Если для точки распространения необходимо использовать откат группы границ, добавьте роль точки миграции состояния на другой сервер системы сайта.<!-- 2838807 -->

### <a name="the-default-site-boundary-group"></a>Группа границ по умолчанию для сайта

Можно создавать свои группы границ, и для каждого сайта определена группа границ по умолчанию, которую создает Configuration Manager. Имя этой группы — **Default-Site-Boundary-Group&lt;код_сайта>** . Например, группа для сайта с именем ABC по умолчанию будет называться **Default-Site-Boundary-Group&lt;ABC>** .

Для каждой создаваемой группы границ Configuration Manager автоматически создает неявные ссылки на каждую группу границ по умолчанию, существующую в иерархии сайтов.  

- Неявная ссылка представляет собой вариант отката по умолчанию от текущей группы границ до группы границ сайта по умолчанию. Время отката по умолчанию — 120 минут.  

- Клиенты, расположенные в границе, которая не связана ни с одной из групп границ, для определения допустимых ролей систем сайта используют группу границ сайта по умолчанию для назначенного им сайта.  

Управление резервированием для группы границ сайта по умолчанию.  

- Откройте свойства группы границ сайта по умолчанию и измените значения на вкладке **Поведение по умолчанию**. Внесенные здесь изменения применяются ко *всем* неявным ссылкам на эту группу границ. Эти параметры по умолчанию можно переопределить, указав явную ссылку на эту группу границ сайта по умолчанию из другой группы границ.  

- Откройте свойства пользовательской группы границ. Измените значения для явной ссылки на группу границ сайта по умолчанию. Когда вы указываете новое значение времени для отката или отката блока, такие изменения влияют только на одну конкретную ссылку. Конфигурация явной ссылки имеет более высокий приоритет, чем параметры на вкладке **Поведение по умолчанию** для группы границ сайта по умолчанию.  

## <a name="site-assignment"></a>Назначение сайта  

Каждую группу границ можно настроить, указав назначенный сайт для клиентов.  

- Все новые клиенты, использующие автоматическое назначение сайта, после установки присоединяются к назначенному сайту в группе границ, содержащей текущее сетевое расположение клиента.  

- После назначения на сайт при смене сетевого расположения клиент не изменяет назначение сайта. Например, клиент перемещается в новое расположение в сети. Это расположение является границей в группе границ с назначением другого сайта. Назначенный сайт клиента не меняется.  

- При обнаружении нового ресурса функцией обнаружения систем Active Directory сведения о сети для ресурса сопоставляются с границами, включенными в группы границ. Это процесс связывает новый ресурс с назначенным сайтом для использования при принудительной установке клиента.  

- Если граница принадлежит нескольким группам границ с разными назначенными сайтами, клиент выбирает один из сайтов случайным образом.  

- Изменения назначенного сайта групп границ применяются только к новым действиям назначения сайта. При изменении в конфигурации граничной группы (или в их собственной сети) клиенты, ранее назначенные на сайт, не переоценивают назначение своего сайта.  

Дополнительные сведения о назначении сайтов клиентам см. в разделе [Автоматическое назначение сайта компьютерам](../../../clients/deploy/assign-clients-to-a-site.md#BKMK_AutomaticAssignment).  

Дополнительные сведения о том, как настроить назначение сайта, см. в следующих разделах.

- [Настройка назначения сайта и выбор серверов системы сайта](boundary-group-procedures.md#bkmk_references)
- [Настройка резервного сайта для автоматического назначения сайта](boundary-group-procedures.md#bkmk_site-fallback)

## <a name="distribution-points"></a>Точки распространения

Когда клиент запрашивает расположение точки распространения, Configuration Manager отправляет клиенту список систем сайта. Эти системы сайта имеют соответствующий тип, связанный с каждой группой границ, которая включает в себя текущее сетевое расположение клиента:

- **Во время распространения программного обеспечения** клиенты запрашивают расположение для содержимого развертывания на допустимом источнике содержимого. Это расположение может быть точкой распространения или источником однорангового кэша.  

- **При развертывании операционной системы** клиент запрашивает расположение для отправки и получения информации о состоянии миграции.  

  - Клиенты получают содержимое с учетом поведения группы границ. Дополнительные сведения см. в разделе [Поддержка последовательности задач для групп границ](#bkmk_bgr-osd).  

Если во время развертывания содержимого клиент запрашивает контент, недоступный из источника в текущей группе границ, он продолжает запрашивать это содержимое. Клиент пытается подключиться к разным источникам содержимого в текущей группе границ, пока не наступит время резервного переключения на соседнюю группу границ или группу границ сайта по умолчанию. Если клиент все еще не нашел нужное содержимое, он расширит область поиска источников содержимого, включив в нее соседние группы границ.

Если содержимое распространяется по требованию, но недоступно в точке распространения на момент поступления запроса от клиента, начинается передача содержимого сайта в эту точку распространения. В качестве источника содержимого клиент может найти сервер, а затем вернуться на соседнюю группу границ.

### <a name="client-installation"></a><a name="bkmk_ccmsetup"></a> Установка клиента

Установщик клиента Configuration Manager (ccmsetup) может получать содержимое установки из локального источника или через точку управления. Его начальное поведение зависит от параметров командной строки, используемых для установки клиента:<!-- MEMDocs#286 -->

- Если вы не используете параметры **/mp** или **/source**, установщик попытается получить список точек управления из Active Directory или DNS.
- Если указан только параметр **/source**, установка будет выполнена из указанного пути. При этом обнаружение точек управления не выполняется. Если установщику не удается найти файл ccmsetup.cab по указанному пути, установка завершается сбоем.
- Если указать оба параметра, **/mp** и **/source**, установщик проверит указанные точки управления, а также другие, которые он обнаружит. Если ему не удастся найти допустимую точку управления, он продолжит установку из источника с указанным путем.

Дополнительную информацию см. в статье [Сведения о параметрах и свойствах установки клиента в Configuration Manager](../../../clients/deploy/about-client-installation-properties.md).

<!--1358840-->
Когда установщик обращается к точке управления, чтобы найти необходимое содержимое, она возвращает точки распространения в зависимости от конфигурации группы границ. Если вы определили отношения для группы границ, точка управления возвращает точки распространения в следующем порядке:

1. Текущая группа границ  
2. Соседние группы границ  
3. Группа границ по умолчанию для сайта  

> [!Note]  
> Процесс установки клиента не использует время отката. Для максимально быстрого поиска необходимого содержимого немедленно выполняется откат к следующей группе границ.
>
> В предыдущих версиях Configuration Manager в рамках этого процесса точка управления возвращала только точки распространения в текущей группе границ клиента. Если содержимое было недоступно, процесс установки откатывался к скачиванию содержимого из точки управления. При этом отсутствовала возможность выполнить откат до точек распространения в других группах границ, в которых могло присутствовать необходимое содержимое.

### <a name="task-sequence-support-for-boundary-groups"></a><a name="bkmk_bgr-osd"></a> Поддержка последовательности задач для групп границ

<!--1359025-->
Когда устройство выполняет последовательность задач и ему нужно получить содержимое, для него доступны режимы группы границ — так же, как и для клиента Configuration Manager.

Вы можете настроить этот режим, используя следующие параметры на странице **Точки распространения** развертывания последовательности задач:

- **Если нет доступных локальных точек распространения, использовать удаленную точку распространения**. Для этого развертывания последовательность задач может переключиться на точки распространения в соседней группе границ.  

- **Разрешить клиентам использовать точки распространения из группы границ сайта по умолчанию**. Для этого развертывания последовательность задач может переключиться на точки распространения в группе границ сайта по умолчанию.  

Чтобы использовать этот новый режим, не забудьте обновить клиенты до последней версии.

#### <a name="location-priority"></a>Приоритет расположения  

Последовательность задач пытается получить содержимое в следующем порядке.  

1. Источники однорангового кэша  

2. Точки распространения в *текущей* группе границ  

3. Точки распространения в *соседней* группе границ  

    > [!Important]  
    > Из-за особенностей обработки последовательности задач в режиме реального времени последовательность задач не дожидается истечения времени отработки отказа в соседней группе границ. Она использует значения времени отработки отказа для определения приоритета соседних групп границ. Например, если последовательности задач не удается получить содержимое из точки распространения в текущей группе границ, она немедленно пытается перейти на точку распространения из соседней группы границ с наименьшим временем отработки отказа. Если этот процесс завершается неудачно, выполняется отработка отказа в точку распространения из соседней группы границ со следующим по величине значением времени отработки отказа.  

4. Точки распространения в группе границ *сайта по умолчанию*  

В файле журнала **smsts.log** последовательности задач отображается приоритет источников расположения, которые используются согласно свойствам развертывания.

### <a name="boundary-group-options-for-peer-downloads"></a><a name="bkmk_bgoptions"></a> Параметры группы границ для одноранговой загрузки

<!--1356193, 1358749-->
Для групп границ реализованы дополнительные параметры, позволяющие более эффективно управлять распространением содержимого в среде.  

- [Разрешение загрузки с одноранговых узлов в этой группе границ](#bkmk_bgoptions1)  

- [Использование только узлов в той же подсети при загрузке с одноранговых узлов](#bkmk_bgoptions2)  

- [Предпочитать точки распространения одноранговым узлам в той же подсети](#bkmk_bgoptions3)  

- [Предпочитать облачные точки распространения обычным](#bkmk_bgoptions4)  

Дополнительные сведения о настройке этих параметров см. в разделе [Настройка группы границ](boundary-group-procedures.md#bkmk_config).

Если устройство входит в несколько групп границ, для этих параметров применяются следующие варианты поведения:

- **Разрешить загрузку с одноранговых узлов в этой группе границ**. Если этот параметр отключен в одной из групп границ, клиент не будет использовать оптимизацию доставки.
- **При загрузке с одноранговых узлов использовать только узлы в той же подсети**. Изменения этого параметра вступаю в силу, если он включен в одной из групп границ.
- **Предпочитать точки распространения одноранговым узлам в той же подсети**. Изменения этого параметра вступаю в силу, если он включен в одной из групп границ.
- **Предпочитать источники в облаке локальным источникам**. Изменения этого параметра вступаю в силу, если он включен в одной из групп границ.

#### <a name="allow-peer-downloads-in-this-boundary-group"></a><a name="bkmk_bgoptions1"></a> Разрешение загрузки с одноранговых узлов в этой группе границ

Этот параметр выбран по умолчанию. Точка управления предоставляет клиентам список расположений содержимого, содержащих одноранговые источники. Кроме того, этот параметр влияет на применение идентификаторов групп для [Оптимизации доставки](../../../plan-design/hierarchy/fundamental-concepts-for-content-management.md#delivery-optimization).  

Этот параметр следует отключать в следующих двух распространенных ситуациях:  

- Если у вас есть группа границ, включающая границы из географически разнесенных расположений, подключенных, например, через VPN. Два клиента могут находиться в одной группе границ, так как они подключены через VPN, но располагаться очень далеко друг от друга, что совершенно неприменимо для однорангового доступа к содержимому.  

- Если вы используете одну большую группу границ для назначения сайта, которая не ссылается ни на какие точки распространения.  

> [!IMPORTANT]
> Если устройство включено в несколько групп границ, обязательно включите этот параметр во всех группах границ для устройства. В противном случае клиент не будет использовать оптимизацию доставки. Например, раздел реестра DOGroupID не задается.

#### <a name="during-peer-downloads-only-use-peers-within-the-same-subnet"></a><a name="bkmk_bgoptions2"></a> Использование только узлов в той же подсети при загрузке с одноранговых узлов

Этот параметр зависит от приведенного выше. Если этот параметр включен, точка управления включает в список только те источники однорангового содержимого, которые находятся в одной подсети с клиентом.

Вот несколько распространенных примеров для использования этого варианта.

- Схема группы границ для распространения содержимого включает одну большую группу границ, которая перекрывается с несколькими группами границ меньшего размера. С этим новым параметром список источников содержимого, который точка управления предоставляет клиентам, будет включать только источники из той же подсети.

- У вас есть одна большая группа границ для всех удаленных офисов. Включите этот параметр, и клиенты смогут обмениваться содержимым только в пределах подсети удаленного офиса, но не между разными расположениями (что может быть рискованно).

Начиная с версии 2002, в зависимости от конфигурации сети можно исключить определенные подсети для сопоставления. Например, необходимо включить границу и одновременно исключить определенную подсеть VPN. По умолчанию Configuration Manager исключает подсеть по умолчанию Teredo (`2001:0000:%`).<!--3555777-->

> [!NOTE]
> В версии 2002 при [развертывании автономного первичного сайта](../install/prerequisites-for-installing-sites.md#bkmk_expand) для добавления сайта центра администрирования (CAS) список исключений подсети возвращается к значениям по умолчанию. Чтобы обойти эту проблему, после расширения сайта запустите сценарий PowerShell и настройте список исключений подсети для CAS.<!-- 6309068 -->

Импортируйте список исключений подсетей в виде строки подсети с разделителями-запятыми. В качестве подстановочного знака используйте символ процента (`%`). На сервере сайта верхнего уровня задайте или прочтите внедренное свойство **SubnetExclusionList** компонента **SMS_HIERARCHY_MANAGER** в классе **SMS_SCI_Component**. Дополнительные сведения см. в статье [Класс WMI сервера SMS_SCI_Component](../../../../develop/reference/core/servers/configure/sms_sci_component-server-wmi-class.md).

##### <a name="sample-powershell-script-to-update-the-subnet-exclusion-list"></a>Пример скрипта PowerShell для обновления списка исключений подсети

Следующий сценарий является примером способа изменения этого значения. Добавьте подсети в переменную **PropertyValue** после `2001:0000:%,172.16.16.0`. Это строка с разделителями-запятыми. Запустите этот скрипт на сервере сайта верхнего уровня в иерархии.

```PowerShell
$PropertyValue = "2001:0000:%,172.16.16.0"
$PropertyName = "SubnetExclusionList"

$providerMachine = Get-WmiObject -Class "SMS_ProviderLocation" -Namespace "root\sms"

if ($providerMachine -is [system.array])
{
    $providerMachine=$providerMachine[0]
}

$SiteCode = $providerMachine.SiteCode

$component = Get-WmiObject -Query 'select comp.* from sms_sci_component comp join SMS_SCI_SiteDefinition sdef on sdef.SiteCode=comp.SiteCode where sdef.ParentSiteCode="" and comp.componentname="SMS_HIERARCHY_MANAGER"' -ComputerName $providerMachine.Machine -Namespace root\sms\site_$SiteCode
$properties = $component.props

Write-host "Updating property for site " $SiteCode

foreach ($property in $properties)
{
  if ($property.propertyname -like $PropertyName)
  {
    Write-host "Current value for SubnetExclusionList is  " $property.value1
    $property.value1 = $PropertyValue
    Write-host "Updating value for SubnetExclusionList to " $property.value1
    break
  }
}

$component.props = $properties
$component.put()
```

> [!NOTE]
> По умолчанию Configuration Manager включает в этот список подсеть по умолчанию Teredo. При изменении списка всегда следует сначала считать существующее значение. Добавьте дополнительные подсети в список, а затем задайте новое значение.

#### <a name="prefer-distribution-points-over-peers-with-the-same-subnet"></a><a name="bkmk_bgoptions3"></a> Предпочитать точки распространения одноранговым узлам в той же подсети

По умолчанию точка управления помещает источники однорангового кэша в верхнюю часть списка расположений содержимого. Этот параметр обращает приоритет для клиентов, которые находятся в той же подсети, что и источник однорангового кэша.

> [!TIP]
> Это поведение применяется к клиенту Configuration Manager. Оно не применяется, если последовательность задач скачивает содержимое. При выполнении последовательности задач предпочтительно использовать источники однорангового кэша вместо точек распространения.<!-- SCCMDocs#1376 -->

#### <a name="prefer-cloud-distribution-points-over-distribution-points"></a><a name="bkmk_bgoptions4"></a> Предпочитать облачные точки распространения обычным

При наличии филиала с более быстрым интернет-каналом можно задать приоритет облачного содержимого.  

В версии 1902 этот параметр теперь называется **Предпочитать источники в облаке локальным источникам**. К облачным источникам относятся следующие:<!-- SCCMDocs#1529 -->

- облачные точки распространения;
- Центр обновления Майкрософт (добавлен в версии 1902).

## <a name="software-update-points"></a>Точки обновления программного обеспечения

Клиенты используют группы границ для поиска точки обновления программного обеспечения. Вы можете добавлять отдельные точки обновления программного обеспечения в разные группы границ, чтобы контролировать, какие серверы может найти каждый клиент.

При добавлении всех существующих точек обновления программного обеспечения в группу границ сайта по умолчанию клиент выбирает точку обновления программного обеспечения из пула доступных серверов. Это поведение аналогично более ранним версиям текущей ветви Configuration Manager. Добавьте отдельные точки обновления программного обеспечения в разные группы границ, чтобы реализовать контролируемый механизм выбора и резервирования.

Если вы устанавливаете новый сайт, точки обновления программного обеспечения не добавляются в группу границ сайта по умолчанию. Добавьте точки обновления программного обеспечения в группу границ, чтобы клиенты могли находить и использовать их.

### <a name="fallback-for-software-update-points"></a>Резервирование точек обновления программного обеспечения

Резервирование для точек обновления программного обеспечения настраивается так же, как и для других ролей системы сайта, но с учетом нескольких дополнительных аспектов.  

#### <a name="new-clients-use-boundary-groups-to-select-software-update-points"></a>Новые клиенты используют группы границ для выбора точки обновления программного обеспечения

Новые устанавливаемые клиенты выбирают точки обновления программного обеспечения из серверов, связанных с настраиваемой группой границ. Эта реакция заменяет предыдущее поведение, при котором клиент случайным образом выбирал точку обновления ПО из списка совместно используемых серверов в клиентском лесу.

#### <a name="clients-continue-to-use-a-last-known-good-software-update-point-until-they-fallback-to-find-a-new-one"></a>Клиенты продолжают использовать последнюю успешно использованную точку обновления программного обеспечения пока не выполнят резервирование для поиска новой резервной точки

Клиенты, у которых уже есть точка обновления программного обеспечения, продолжат использовать ее, пока она доступна. При этом клиент продолжит использовать точку обновления программного обеспечения, даже если она не связана с его текущей группой границ.

Этот режим работы заранее запланирован. Клиент продолжает использовать существующую точку обновления программного обеспечения, даже если она не находится в его текущей группе границ. Если точка обновления программного обеспечения меняется, клиент синхронизирует данные с новым сервером, что приводит к значительным нагрузкам на сеть. Такая задержка перехода предотвращает перегрузку сети, которая возникла бы при одновременном переключении всех клиентов на новые серверы.

#### <a name="a-client-always-tries-to-reach-its-last-known-good-software-update-point-for-120-minutes-before-starting-fallback"></a>Клиент всегда пытается связаться с последней успешно использованной точкой обновления программного обеспечения в течение 120 минут, прежде чем выполнять резервирование.

Если за 120 минут клиент не смог установить связь, начинается резервирование. При этом клиент получает список всех точек обновления программного обеспечения для своей текущей группы границ. В зависимости от настроек резервирования могут быть доступны дополнительные точки обновления из соседних групп границ или из группы границ сайта по умолчанию.

### <a name="fallback-configurations-for-software-update-points"></a>Конфигурации резервирования для точек обновления программного обеспечения

Вы можете настроить **время резервирования (в минутах)** , указав менее 120 минут для точек обновления программного обеспечения. Тем не менее клиент по-прежнему пытается подключиться к исходной точке обновления программного обеспечения в течение 120 минут. Затем он расширяет область поиска и ищет дополнительные серверы. Период перехода на соседнюю группу границ начинается после первой неудачной попытки соединения с исходным сервером. Когда клиент расширяет область поиска, сайт предоставляет группы границ, настроенные для перехода менее чем через 120 минут.

Вы можете выбрать вариант **Никогда не использовать резервирование**,чтобы отключить переход к точке обновления программного обеспечения в соседней группе границ.

Если в течение двух часов не удается подключиться к исходному серверу, клиент использует более короткий цикл обращений к новой точке обновления программного обеспечения. Это поведение позволяет клиенту быстро выполнить поиск по расширяющемся списку потенциально доступных точек обновления программного обеспечения.

#### <a name="example"></a>Пример

Точки обновления программного обеспечения в группе границ *A* настраиваются для отката после **10** минут. Для группы границ *B* тот же параметр настраивается на **130** минут. Клиенту в группе границ *Z* не удается подключиться к последней успешно использованной точке обновления программного обеспечения.

- В течение 120 минут клиент пытается подключиться к исходному серверу в группе границ Z. Через 10 минут Configuration Manager добавляет точки обновления программного обеспечения из группы границ A в пул доступных серверов. Тем не менее клиент не пытается обращаться к ним или к любому другому серверу до истечения начального периода 120 минут.  

- Когда все попытки связаться с исходной точкой обновления программного обеспечения в течение 120 минут окажутся безуспешными, клиент расширяет область поиска. Он добавляет серверы в доступный пул точек обновления программного обеспечения, которые находятся в его текущей и любых соседних пограничных группах, настроенных на 120 минут или меньше. Этот пул включает серверы из группы границ A, которые уже добавлены в пул доступных серверов.  

- Через 10 минут клиент расширяет поиск, добавляя точки обновления программного обеспечения из группы границ B. Этот период составляет 130 минут общего времени после того, как клиент не смог достичь своей последней успешно использованной точки обновления программного обеспечения.  

### <a name="manually-switch-to-a-new-software-update-point"></a>Переключение на новую точку обновления программного обеспечения вручную

Помимо резервирования используйте уведомление клиента, чтобы вручную принудительно переключить устройство на новую точку обновления программного обеспечения.

При переходе на новый сервер устройство использует механизм резервирования для поиска этого сервера. Клиенты переключаются на новую точку обновления программного обеспечения во время следующего цикла сканирования обновлений.<!-- SCCMDocs#1537 -->

Просмотр конфигураций группы границ. Прежде чем приступить к изменениям, убедитесь, что точки обновления программного обеспечения были включены в правильные группы границ.

См. дополнительные сведения о [планировании обновлений программного обеспечения в System Center Configuration Manager](../../../../sum/plan-design/plan-for-software-updates.md#BKMK_ManuallySwitchSUPs).

## <a name="management-points"></a>Точки управления

<!-- 1324594 -->
Настраивайте резервные отношения для точек управления между группами границ. Это поведение обеспечивает больший контроль точек управления, используемых клиентами. На вкладке **Отношения** в свойствах группы границ есть столбец для точки управления. Сейчас при добавлении новой группы границ время отката точки управления всегда равно нулю. Это поведение одинаково для **поведения по умолчанию** в группе границ по умолчанию на сайте.

Ранее возникала распространенная проблема при наличии защищенной точки управления в защищенной сети. Клиенты главной сети получали политику, которая включала эту защищенную точку управления, несмотря на то что не могли взаимодействовать с ней через брандмауэр. Для решения этой проблемы используйте параметр **Никогда не использовать резервирование**, чтобы убедиться, что клиенты резервируют только те точки управления, с которыми они могут взаимодействовать.

> [!Note]  
> Если точки распространения в группе границ сайта по умолчанию включены для резервирования, а точка управления совместно размещена на точке распространения, сайт также добавляет эту точку управления в группу границ сайта по умолчанию.<!--VSO 2841292-->  

Если клиент находится в группе границ, в которой нет назначенных точек управления, сайт дает клиенту весь список точек управления. Такая реакция гарантирует, что клиент всегда получает список точек управления.

Резервирование группы границ точек управления не изменяет поведение во время установки клиента (ccmsetup.exe). Если в командной строке не указать исходную точку управления с помощью параметра /MP, новый клиент получит полный список доступных точек управления. Во время процесса начальной загрузки клиент использует первую точку управления, к которой он может получить доступ. Как только клиент регистрируется на сайте, он получает соответствующе рассортированный список точек управления с новым поведением.

Дополнительные сведения о поведении клиента для получения содержимого во время установки см. в разделе [Установка клиента](#bkmk_ccmsetup).

Если во время обновления клиента вы не указываете параметр командной строки /MP, клиент запрашивает такие источники как Active Directory и WMI для любой доступной точки управления. Обновление клиента не поддерживает конфигурацию группы границ. <!--VSO 2841292-->  

Чтобы клиенты могли использовать эту возможность, включите параметр **Клиенты предпочитают использовать точки управления, указанные в группах границ** в разделе **Параметры иерархии**.

> [!Note]  
> Процессы развертывания операционной системы не осведомлены о группах границ для точек управления.  

### <a name="troubleshooting"></a>Устранение неполадок

Новые записи появляются в **LocationServices.log**. Атрибут **Locality** (Местонахождение) определяет одно из следующих состояний:

- **0**: Неизвестно  

- **1**: Указанная точка управления находится только в группе границ сайта для отката по умолчанию  

- **2**: Указанная точка управления находится в удаленной или соседней группе границ. Когда точка управления находится как в соседних, так и в группах границ по умолчанию сайта, местоположение имеет значение 2.  

- **3**: Указанная точка управления находится в локальной или текущей группе границ. Когда точка управления находится в текущей группе границ, а также в соседней или в группе границ сайта по умолчанию, тогда местоположение имеет значение 3. Если не включать параметры предпочтительных точек управления в параметрах иерархии, тогда местоположение всегда будет иметь значение 3, независимо от того, в какой группе границ находится точка управления.  

Клиенты сначала используют первую локальную точку (местоположение 3), удаленную вторую (местоположение 2), а затем выполняют откат (местоположение 1).

Когда клиент получает пять ошибок за десять минут и не может обмениваться данными с точкой управления в собственной группе границ, он пытается связаться с точкой управления в соседней группе границ или группе границ сайта по умолчанию. Если позже точка управления в текущей группе границ возвращается в сеть, клиент вернется в локальную точку управления при следующем цикле обновления. Цикл обновления составляет 24 часа. Помимо этого он выполняется при перезапуске службы агента Configuration Manager.

## <a name="preferred-management-points"></a><a name="bkmk_preferred"></a> Предпочтительные точки управления

> [!Note]
> Поведение параметра иерархии **Клиенты предпочитают использовать точки управления, указанные в группах границ** изменилось в версии 1802. При включении этого параметра Configuration Manager использует функциональные возможности группы границ для назначенной точки управления. Дополнительные сведения см. в статье [Точки управления](#management-points).

Предпочтительные точки управления позволяют клиенту определить точку управления, сопоставленную с текущим сетевым расположением (или границей).  

- Клиент пытается использовать предпочтительную точку управления из назначенного сайта прежде, чем использовать точку управления из назначенного сайта, которая не задана как предпочтительная.  

- Чтобы использовать этот вариант, включите параметр **Клиенты предпочитают использовать точки управления, указанные в группах границ** в разделе **Параметры иерархии**. Затем настройте группы границ на отдельных первичных сайтах. Включите точки управления, которые должны быть связаны со связанными границами этой группы границ. Подробнее см. раздел [Включение предпочтительных точек управления](boundary-group-procedures.md#bkmk_proc-prefer).  

- Когда вы настраиваете предпочтительные точки управления и клиент упорядочивает свой список точек управления, он размещает предпочтительные точки управления в верхней части своего списка. Этот список включает все точки управления из назначенного сайта клиента.  

> [!NOTE]  
> Роуминг клиента — это изменение его сетевого расположения. Например, когда ноутбук перемещается в удаленный филиал. Если клиент перемещается, он может использовать точку управления с локального сайта, прежде чем использовать сервер с назначенного сайта. Этот список серверов с назначенного сайта включает предпочтительные точки управления. Дополнительные сведения см. в статье [Пояснения о том, как клиенты находят ресурсы и службы сайта](../../../plan-design/hierarchy/understand-how-clients-find-site-resources-and-services.md).  

## <a name="overlapping-boundaries"></a>Перекрывающиеся границы  

Configuration Manager поддерживает конфигурации с перекрывающимися границами для расположения содержимого. Если сетевое расположение клиента входит в несколько групп границ, происходит следующее.

- Когда клиент запрашивает содержимое, Configuration Manager отправляет клиенту список всех точек распространения с этим содержимым.  

- Когда клиент запрашивает у сервера отправку или получение сведений о миграции состояния, Configuration Manager отправляет клиенту список всех точек миграции состояния, связанных с группой границ, в которой находится текущее сетевое расположение клиента.  

Такой механизм работы позволяет клиенту выбрать ближайший сервер для передачи содержимого или сведений о миграции состояния.  

## <a name="example-of-using-boundary-groups"></a>Пример использования группы границ

В следующем примере клиент выполняет поиск содержимого в точке распространения. Этот пример можно применить к любой роли систем сайта, которая использует группы границ.

Создайте три группы границ, не имеющих общих границ или общих серверов системы сайта:  

- Группа BG_A с точками распространения DP_A1 и DP_A2  

- Группа BG_B с точками распространения DP_B1 и DP_B2  

- Группа BG_C с точками распространения DP_C1 и DP_C2  

Добавьте сетевые расположения клиентов как границы только для группы границ BG_A. Затем настройте отношения между этой группой границ и двумя другими группами границ:  

- Настройте точки распространения для первой *соседней* группы (BG_B), которая будет использоваться через 10 минут. Эта группа содержит точки распространения DP_B1 и DP_B2. Они также подключены к расположениям границ первой группы.  

- Настройте вторую *соседнюю* группу (BG_C), которая будет использоваться через 20 минут. Эта группа содержит точки распространения DP_C1 и DP_C2. Они находятся в глобальной сети из двух других групп границ.  

- Добавьте еще одну точку распространения, расположенную на сервере сайта, в группу границ сайта по умолчанию. Этот сервер — наименее предпочтительное расположение источника содержимого, однако он расположен в центре относительно всех групп границ.

    Пример группы границ и времени отката:

    ![Пример группы границ и времени отката](media/BG_Fallback.png)  

В этой конфигурации происходит следующее.  

- Клиент начинает поиск содержимого от точек распространения в *текущей* группе границ (BG_A). Он ищет каждую точку распространения в течение двух минут, а затем переключается на следующую точку распространения в группе границ. В пул клиентов допустимых источников содержимого входят точки распространения DP_A1 и DP_A2.  

- Если клиенту не удается найти содержимое из его *текущей* группы границ после поиска в течение 10 минут, он добавляет в область поиска точки распространения из группы границ BG_B. Затем он продолжает поиск содержимого от точки распространения в объединенном пуле серверов. Теперь этот пул включает серверы из групп границ BG_A и BG_B. Клиент продолжает обращаться к каждой точке распространения в течение двух минут, а затем переходит к следующему серверу в пуле. В пул клиентов допустимых источников содержимого входят точки распространения DP_A1, DP_A2, DP_B1 и DP_B2.  

- Если еще через 10 минут (всего 20 минут) клиенту по-прежнему не удалось найти точку распространения с содержимым, он расширяет пул доступных серверов, включая серверы из второй *соседней* группы — группы границ BG_C. Теперь клиент может выполнять поиск в шести точках распространения: DP_A1, DP_A2, DP_B2, DP_B2, DP_C1 и DP_C2. Он продолжает переходить от одной точки распространения к другой каждые две минуты, пока не найдет содержимое.  

- Если клиент не нашел содержимое через 120 минут, он возвращается, чтобы включить *группу границ сайта по умолчанию* в состав дальнейшего поиска. Теперь в пул входят все точки распространения из трех настроенных групп границ, а также последняя точка распространения, расположенная на сервере сайта. Клиент продолжает поиск содержимого, каждые две минуты переходя на новые точки распространения, пока содержимое не будет найдено.  

Настраивая различные соседние группы, которые будут доступны в разное время, вы контролируете последовательность добавления точек распространения в качестве расположения источника содержимого. Клиент использует откат к группе границ сайта по умолчанию как подстраховку для содержимого, которое недоступно в других местах.

## <a name="changes-from-prior-versions"></a>Изменения по сравнению с предыдущими версиями

Ниже приведены основные изменения в группах границ и способах обнаружения содержимого клиентами в текущей ветви Configuration Manager. Многие из этих изменений и основных понятий работают вместе.

### <a name="configurations-for-fast-or-slow-are-removed"></a>Удалена настройка быстрых или медленных точек распространения.

Больше не требуется настраивать отдельные точки распространения как быстрые или медленные. Теперь каждая система сайта, связанная с группой границ, обрабатывается одинаково. В связи с этим изменением на вкладке **Ссылки** в окне свойств группы границ больше не поддерживается настройка быстрых или медленных точек распространения.  

### <a name="new-default-boundary-group-at-each-site"></a>Новая группа границ по умолчанию на каждом сайте.

На каждом первичном сайте есть новая группа границ по умолчанию с именем **Default-Site-Boundary-Group&lt;sitecode>** . Если клиент отсутствует в сетевом расположении, назначенном группе границ, он использует системы сайта, связанные с группой по умолчанию, с назначенного ему сайта. Запланируйте использовать эту группу границ в качестве замены понятия резервного источника содержимого.

#### <a name="allow-fallback-source-locations-for-content-is-removed"></a>Удален параметр **Разрешить резервные источники для содержимого**.

Вы больше не можете явным образом настраивать точку распространения в качестве резервного местоположения. Настройки этого параметра удалены из консоли.

Кроме того, изменен результат действия параметра **Разрешить клиентам использовать резервный источник содержимого** в типе развертывания приложений. Теперь этот параметр в типе развертывания позволяет клиенту использовать группу границ сайта по умолчанию в качестве источника содержимого.

#### <a name="boundary-groups-relationships"></a>Отношения групп границ.

Каждую группу границ можно привязать к одной или нескольким дополнительным группам границ. Эти связи формируют отношения, настраиваемые на новой вкладке свойств группы границ **Отношения**.  

- Каждая группа границ, с которой клиент связан напрямую, называется **текущей** группой границ.  

- Группа границ, которую клиент может использовать благодаря связи между *текущей* группой границ и другой группой, называется **соседней**.  

- На вкладке **Отношения** можно добавлять группы границ, которые будут использоваться в качестве *соседних*. Также вы можете настроить время в минутах для резервного перехода. Когда клиенту не удается найти содержимое в точке распространения в *текущей* группе, через указанное количество минут он начинает поиск источников содержимого в *соседних* группах границ.  

    При добавлении или изменении конфигурации группы границ у вас будет возможность заблокировать откат к определенной группе границ из текущей настраиваемой группы.  

Чтобы использовать новую конфигурацию, определите явные связи (ссылки) между двумя группами границ. Настройте все точки распространения в связанной группе, указав это же время в минутах. Настроенное время определяет, когда клиенту, которому не удалось найти источник содержимого в *текущей* группе границ, следует начать поиск источников содержимого в соседней группе границ.

Помимо явной настройки, каждая группа границ имеет неявную связь с группой границ сайта по умолчанию. Эта ссылка становится активной через 120 минут. Тогда соседней группой границ становится группа границ сайта по умолчанию. Это поведение позволяет клиентам использовать в качестве расположения источника содержимого точки распространения, связанные с этой группой границ.

Это поведение заменяет то, что ранее называлось откатом содержимого. Чтобы изменить установленный по умолчанию период 120 минут, необходимо явно привязать группу границ сайта по умолчанию к *текущей* группе. Задайте определенное время в минутах или блокируйте резервный переход полностью, чтобы предотвратить его использование.

### <a name="clients-try-to-get-content-from-each-distribution-point-for-up-to-two-minutes"></a>Клиенты пытаются получить содержимое из каждой точки распространения в течение двух минут.

Когда клиент выполняет поиск источника содержимого, он пытается получить доступ к каждой точке распространения в течение двух минут, а затем переходит к другой точке распространения. Это поведение отличается от предыдущих версий, когда клиенты пытались подключиться к точке распространения до двух часов.

- Клиент случайным образом выбирает первую точку распространения из пула доступных серверов в *текущей* группе (или группах) границ клиента.  

- Если клиенту не удалось найти содержимое, через две минуты он переключается на новую точку распространения и пытается получить содержимое с этого сервера. Этот процесс повторяется каждые две минуты, пока клиент не найдет содержимое или не перейдет к последнему серверу в пуле.  

- Если клиенту не удастся найти допустимый источник содержимого в *текущем* пуле раньше, чем наступит время перехода в *соседнюю* группу границ, он добавляет точки распространения из *соседней* группы в конец текущего списка. Затем он выполняет поиск по расширенной группе расположений источников, куда входят точки распространения из обеих групп границ.  

    > [!TIP]  
    > Если вы создаете явную связь между текущей группой границ и группой границ сайта по умолчанию и указываете время резервного перехода меньше времени перехода к соседней группе границ, клиенты начнут поиск источников из группы границ сайта по умолчанию до включения соседней группы.  

- Если клиенту не удастся получить содержимое из последнего сервера в пуле, он начнет процесс заново.  

## <a name="see-also"></a>См. также

- [Процедуры для групп границ](boundary-group-procedures.md)  

- [О границах](boundaries.md)  

- [Основные принципы управления содержимым](../../../plan-design/hierarchy/fundamental-concepts-for-content-management.md)  
