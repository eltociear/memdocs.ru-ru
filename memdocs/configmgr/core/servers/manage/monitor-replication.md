---
title: Мониторинг репликации базы данных
titleSuffix: Configuration Manager
description: Узнайте, как отслеживать репликацию SQL Server в иерархии Configuration Manager.
ms.date: 08/09/2019
ms.prod: configuration-manager
ms.technology: configmgr-core
ms.topic: conceptual
ms.assetid: 69550b35-bcdb-4b47-bbec-b3c8bc92bb7b
author: mestew
ms.author: mstewart
manager: dougeby
ms.openlocfilehash: 4a9ae791582911f91e5f76b841248ad5085d8170
ms.sourcegitcommit: a77ba49424803fddcaf23326f1befbc004e48ac9
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/27/2020
ms.locfileid: "83879820"
---
# <a name="monitor-database-replication"></a>Мониторинг репликации базы данных

*Область применения: Configuration Manager (Current Branch)*

Сведения об отслеживании репликации базы данных с помощью узла **Репликация базы данных** в рабочей области **Мониторинг** в консоли Configuration Manager. Вы можете отслеживать состояние каналов репликации между сайтами. Он также показывает инициализацию и репликацию групп репликации для сайта, к которому выполняется подключение.  

> [!TIP]  
> Хотя узел **Репликация базы данных** также появляется в узле **Настройка иерархии** в рабочей области **Администрирование**, из этого расположения невозможно просматривать состояние репликации для ссылок репликации базы данных.  

## <a name="replication-link-status"></a><a name="BKMK_MonitorReplicationLinks"></a> Состояние канала репликации  

Репликация базы данных между сайтами включает в себя репликацию нескольких наборов информации, называемых *группами репликации*. Каждая группа репликации отправляет и получает данные с разными приоритетами. По умолчанию, данные, которые содержатся в группе репликации, и частоту репликации нельзя изменить.  

Когда канал репликации активен, и его состояние не нарушено или ухудшено, все группы реплицируются быстро. Если одной или нескольким группам не удается завершить репликацию в течение ожидаемого периода времени, для связи устанавливается состояние *сниженной активности*. Каналы со сниженной работоспособностью по-прежнему могут работать, но их следует отслеживать, чтобы убедиться, что они возвращаются в активное состояние. Изучите их, чтобы убедиться в отсутствии дополнительных снижений активности или ошибок репликации.  

Для каждого канала репликации укажите число повторных попыток репликации групп после сбоя. После этого количества попыток сайт устанавливает состояние канала на "Сниженная активность" или "Сбой". Даже если все группы, кроме одной, реплицируются успешно, сайт устанавливает для канала статус "Сниженная активность" или "Сбой". Он устанавливает этот статус, потому что одной группе репликации не удается завершить репликацию в указанное количество попыток. Дополнительные сведения см. в разделе [Пороговые значения репликации базы данных](../../plan-design/hierarchy/database-replication.md#BKMK_DBRepThresholds)  

Используйте следующую информацию, чтобы понять состояние репликации каналов, которое может потребовать дальнейшего изучения:  

### <a name="link-is-active"></a>Связь активна

Проблемы не обнаружены, взаимодействие продолжается.

Если родительский сайт обновляется до новой версии, при просмотре состояния связи с дочернего сайта будет отображаться активное состояние. После обновления, пока дочерний сайт не будет иметь ту же версию, что и родительский, при просмотре с родительского сайта, для канала будет отображатся активное состояние. При просмотре с дочернего сайта он отображается как конфигурируемый.  

### <a name="link-is-degraded"></a>Активность связи снижена

Репликация работает, но наблюдается задержка по крайней мере одного объекта или группы. Следите за каналами, которые находятся в этом состоянии. Просмотрите информацию с обоих сайтов по каналам, чтобы убедиться, что канал не выйдет из строя.

Связь может перейти в состояние сниженной активности, если сайт, получающий реплицированные, не может быстро внести эти данные в базу данных. Это происходит, когда реплицируются большие объемы данных. Например, вы развертываете обновление программного обеспечения на большом количестве компьютеров. Родительский сайт по каналу может потребовать некоторое время для обработки этого объема реплицированных данных. Задержка обработки на родительском сайте приводит к тому, что он устанавливает состояние канала на сниженную активность до тех пор, пока не сможет успешно обработать резерв данных.

### <a name="link-has-failed"></a>Отказ связи

Репликация не работает. Возможно, канал репликации может восстановиться без дальнейших действий. Чтобы изучить проблему и помочь исправить репликацию по этому каналу, используйте анализатор ссылок репликации (RLA).

Это состояние может также указывать на неполадки в физической сети между родительским и дочерним сайтами.


## <a name="monitor-replication-status"></a><a name="BKMK_MonitorReplicationStatus"></a> Мониторинг состояния репликации

Используйте узел **Репликация базы данных** в рабочей области **Мониторинг**, чтобы просмотреть состояние канала репликации. Просмотрите сведения о базе данных на каждом сайте по каналу репликации. Кроме того, вы можете просматривать сведения о группах репликации. Для просмотра этих сведений выберите канал репликации, а затем соответствующую вкладку, чтобы просмотреть нужное состояние репликации.

В следующих разделах приведена подробная информация о различных вкладках состояния репликации:

### <a name="summary"></a>Сводка

Просмотр высокоуровневой информации о репликации данных сайта и глобальных данных между двумя сайтами по каналу.  

Выберите**Просмотр отчетов данных журнала трафика**, чтобы просмотреть отчет с подробными сведениями о полосе пропускания сети, используемой репликацией по этому каналу.  

### <a name="parent-site"></a>Родительский сайт

Для родительского узла связи репликации можно просмотреть сведения о базе данных:  

- Порты брандмауэра для SQL Server  

- Свободное пространство на диске  

- Расположение файлов базы данных  

- Сертификаты  

### <a name="child-site"></a>Дочерний сайт

Для дочернего сайта связи репликации, просмотреть сведения о базе данных, в том числе:  

- Порты брандмауэра для SQL Server  

- Свободное пространство на диске  

- Расположение файлов базы данных  

- Сертификаты  

### <a name="initialization-detail"></a>Подробности инициализации

Просмотр состояния инициализации для групп, которые реплицируются по каналу. Эти сведения помогут определить, когда инициализация репликация выполняется, а в каких случаях произошел сбой.  

Используйте эту информацию, чтобы определить, когда сайт может находиться в *режиме взаимодействия*. Режим взаимодействия возникает, когда версии Configuration Manager на дочернем и на родительском сайтах различаются.  

### <a name="replication-detail"></a>Сведения о репликации

Просмотрите состояние репликации для каждой группы, которая реплицируется по каналу. Используйте эту информацию, чтобы идентифицировать проблемы или задержки при репликации определенных данных. Это может помочь определить соответствующие пороговые значения репликации базы данных для этого канала. Дополнительные сведения см. в разделе [Пороговые значения репликации базы данных](../../plan-design/hierarchy/database-replication.md#BKMK_DBRepThresholds).  

> [!TIP]  
> Группы репликации данных для сайта отправляются только от дочернего к родительскому узлу. Группы репликации для глобальных данных реплицируются в обоих направлениях.  


## <a name="replication-link-analyzer"></a><a name="BKMK_RLA"></a> Replication Link Analyzer

В Configuration Manager входит инструмент **Replication Link Analyzer** (RLA), позволяющий анализировать и устранять неполадки репликации. Используйте RLA для исправления сбоев канала при сбое репликации. Это также полезно, когда репликация перестает работать, но сайт еще не сообщил о сбое.

Используйте RLA для устранения проблем репликации между следующими компьютерами в иерархии:  

- между сервером сайта и сервером базы данных сайта;  

- между сервером базы данных сайта и сервером базы данных другого сайта, также известным как межсайтовая репликация.  

> [!Note]  
> Направление сбоя репликации не имеет значения.

Запустите RLA либо в консоли Configuration Manager, либо в командной строке:  

- В консоли Configuration Manager Перейдите в рабочую область **Мониторинг** и выберите узел **Репликация базы данных**. Выберите канал репликации, который нужно проанализировать, а затем на ленте выберите **Replication Link Analyzer**.  

- Для запуска из командной строки введите следующую команду: `%ProgramFiles(x86)%\Microsoft Endpoint Manager\AdminConsole\bin\Microsoft.ConfigurationManager.ReplicationLinkAnalyzer.Wizard.exe <source site server FQDN> <destination site server FQDN>`  

    > [!IMPORTANT]
    > Начиная с версии 1910, этот путь изменился и ведет в папку `Microsoft Endpoint Manager`. Убедитесь, что вы не используете файл старой версии, расположенный в другой папке.

При запуске RLA обнаруживает проблемы, используя ряд правил диагностики и проверок. Вы просматриваете проблемы, которые идентифицирует инструмент. Если у анализатора есть инструкции по решению проблемы, он отображает их. Если RLA может автоматически устранить проблему, вы увидите этот параметр.

Завершив работу, RLA сохраняет результаты как отчет в формате XML и в файл журнала на рабочем столе пользователя, запустившего это средство:  

- ReplicationAnalysis.xml  

- ReplicationLinkAnalysis.log  

RLA останавливает следующие службы, устраняя некоторые проблемы. После завершения исправления он перезапускает следующие службы:  

- SMS_SITE_COMPONENT_MANAGER  

- SMS_EXECUTIVE  

Если RLA не удается выполнить исправление, перезапустите эти службы на сервере сайта, если это необходимо.  

RLA регистрирует все действия по анализированию и исправлению, чтобы предоставить дополнительные сведения, которые не отображаются в мастере.  

### <a name="rla-prerequisites"></a>Предварительные требования RLA

Учетная запись, используемая для запуска RLA, должна иметь следующие разрешения:

- Права локального администратора на каждом компьютере, участвующем в репликации.

- Права системного администратора на каждой базе данных SQL Server, которая участвует в репликации.  

> [!Note]  
> Учетная запись не требует особой роли безопасности администрирования на основе ролей Configuration Manager. Пользователь с правами доступа к узлу **Репликация базы данных** может запустить инструмент в консоли Configuration Manager. Системный администратор с достаточными правами на каждый компьютер может запустить средство из командной строки.  

### <a name="rla-known-issue"></a>RLA известная проблема

RLA генерирует ошибки сертификата SQL Server Service Broker (SSB) для основных сайтов, обновленных с помощью System Center 2012 Configuration Manager. Эта проблема возникает из-за изменений в именах сертификатов в текущем разделе Configuration Manager. Эти ошибки можно пропустить.  


## <a name="monitoring-database-replication"></a><a name="BKMK_ProcsforMonitoringReplication"></a> Мониторинг репликации базы данных  

### <a name="monitor-high-level-site-to-site-database-replication-status"></a>Мониторинг высокоуровневого состояния репликации базы данных

1. В консоли Configuration Manager перейдите в рабочую область **Мониторинг**.  

2. Выберите узел **Иерархия сайтов**, чтобы открыть представление **Схема иерархии**.  

3. Наведите указатель мыши на линию между двумя сайтами. Просмотрите состояние глобальных и реплицированных данных сайта для этих сайтов.  

### <a name="monitor-the-status-of-a-replication-link"></a>Отслеживание состояния канала репликации

1. В консоли Configuration Manager перейдите в рабочую область **Мониторинг**.  

2. Выберите узел **Репликация базы данных**, а затем канал репликации, который нужно отслеживать. Затем выберите соответствующую вкладку, чтобы просмотреть различные сведения о состоянии репликации для этого канала.  
