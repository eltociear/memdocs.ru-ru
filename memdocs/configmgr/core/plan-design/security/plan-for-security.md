---
title: Планирование безопасности
titleSuffix: Configuration Manager
description: Рекомендации и другие сведения по обеспечению безопасности в Configuration Manager.
ms.date: 11/27/2018
ms.prod: configuration-manager
ms.technology: configmgr-core
ms.topic: conceptual
ms.assetid: 2a216814-ca8c-4d2e-bcef-dc00966a3c9f
author: aczechowski
ms.author: aaroncz
manager: dougeby
ms.openlocfilehash: 4c10922bbe855bfbd89228d1887db06399c261ca
ms.sourcegitcommit: bbf820c35414bf2cba356f30fe047c1a34c5384d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/21/2020
ms.locfileid: "81695782"
---
# <a name="plan-for-security-in-configuration-manager"></a>Планирование безопасности в Configuration Manager

*Область применения: Configuration Manager (Current Branch)*

В этой статье описываются основные понятия, которые следует учитывать при планировании безопасности в реализации Configuration Manager. Она включает следующие разделы:  

- [Планирование сертификатов (самозаверяющего и PKI-сертификата)](#BKMK_PlanningForCertificates)  
  - [Сертификаты Cryptography: Next Generation (CNG)](#bkmk_plan-cng)  
  - [Улучшенный протокол HTTP](#bkmk_plan-ehttp)  
  - [Сертификаты для CMG и CDP](#bkmk_plan-cmgcdp)  
  - [Сертификат подписи сервера сайта (самозаверяющий)](#bkmk_plansitesign)  
  - [Отзыв PKI-сертификата](#BKMK_PlanningForCRLs)  
  - [Доверенные корневые PKI-сертификаты и список издателей сертификатов](#BKMK_PlanningForRootCAs)  
  - [Выбор PKI-сертификата клиента](#BKMK_PlanningForClientCertificateSelection)  
  - [Стратегия перехода для PKI-сертификатов и управления клиентами через Интернет](#BKMK_PlanningForPKITransition)  

- [Планирование корневого ключа доверия](#BKMK_PlanningForRTK)  

- [Планирование подписывания и шифрования](#BKMK_PlanningForSigningEncryption)  

- [Планирование ролевого администрирования](#BKMK_PlanningForRBA)  

- [Планирование Azure Active Directory](#bkmk_planazuread)  

- [Планирование проверки подлинности поставщика SMS](#bkmk_auth)



##  <a name="plan-for-certificates-self-signed-and-pki"></a><a name="BKMK_PlanningForCertificates"></a> Планирование сертификатов (самозаверяющего и PKI-сертификата)  

Configuration Manager использует сочетание самозаверяющих сертификатов и сертификатов инфраструктуры открытых ключей (PKI).  

Используйте PKI-сертификаты, когда это возможно. Дополнительные сведения см. в разделе [Требования к PKI-сертификатам](../network/pki-certificate-requirements.md). Если Configuration Manager запрашивает PKI-сертификаты во время регистрации мобильных устройств, необходимо использовать доменные службы Active Directory и центр сертификации предприятия. Развертывание всех остальных PKI-сертификатов и управление ими следует осуществлять независимо от Configuration Manager. 

PKI-сертификаты необходимы при подключении клиентских компьютеров к системам сайта на основе Интернета. В некоторых случаях при использовании шлюза облачного управления и облачной точки распространения также требуются PKI-сертификаты. Дополнительные сведения см. в разделе [Управление клиентами в Интернете](../../clients/manage/manage-clients-internet.md).

При использовании PKI вы также можете использовать протокол IPsec для защиты межсерверного обмена данными между системами сайта на сайте и между сайтами, а также в любом другом случае при передаче данных между компьютерами. Реализация IPsec не зависит от Configuration Manager.  

Если PKI-сертификаты недоступны, Configuration Manager автоматически создает самозаверяющие сертификаты. Некоторые сертификаты в Configuration Manager всегда являются самозаверяющими. В большинстве случаев Configuration Manager автоматически управляет самозаверяющими сертификатами, поэтому выполнять дополнительные действия не требуется. Пример — сертификат для подписи сервера сайта. Этот сертификат всегда является самозаверяющим. Он гарантирует, что политики, которые клиенты загружают из точки управления, отправлены с сервера сайта и не были изменены злоумышленником.  


### <a name="cryptography-next-generation-cng-certificates"></a><a name="bkmk_plan-cng"></a> Сертификаты Cryptography: Next Generation (CNG)  

Configuration Manager поддерживает сертификаты Cryptography: Next Generation (CNG). Клиенты Configuration Manager могут использовать PKI-сертификат для проверки подлинности клиента с закрытым ключом в поставщике хранилища ключей CNG (KSP). Благодаря поддержке поставщика хранилища ключей Configuration Manager поддерживает аппаратный закрытый ключ, например KSP доверенного платформенного модуля (TPM) для PKI-сертификатов проверки подлинности клиента. Дополнительные сведения см. в статье [Общие сведения о сертификатах CNG](../network/cng-certificates-overview.md).


### <a name="enhanced-http"></a><a name="bkmk_plan-ehttp"></a> Улучшенный протокол HTTP  

Подключение по протоколу HTTPS рекомендуется использовать для всех путей обмена данными Configuration Manager, но это может оказаться сложной задачей для некоторых клиентов из-за дополнительных расходов на управление сертификатами PKI. Интеграция с Azure Active Directory (Azure AD) устраняет некоторые, но не все требования к сертификатам. Начиная с версии 1806 вы можете включить на сайте использование **улучшенного протокола HTTP**. Эта конфигурация поддерживает HTTPS в системах сайта с помощью сочетания самозаверяющих сертификатов и Azure AD. Для этого не требуется PKI. Подробнее см. в разделе [Улучшенный протокол HTTP](../hierarchy/enhanced-http.md).  


### <a name="certificates-for-cmg-and-cdp"></a><a name="bkmk_plan-cmgcdp"></a> Сертификаты для CMG и CDP

Для управления клиентами в Интернете с помощью шлюза управления облачными клиентами (CMG) и облачной точки распространения (CDP) требуется использовать сертификаты. Число и тип сертификатов зависят от конкретных сценариев. Дополнительные сведения см. в следующих статьях:
- [Сертификаты для шлюза управления облачными клиентами](../../clients/manage/cmg/certificates-for-cloud-management-gateway.md)  
- [Сертификаты для облачной точки распространения](../hierarchy/use-a-cloud-based-distribution-point.md#bkmk_certs)  


### <a name="plan-for-the-site-server-signing-certificate-self-signed"></a><a name="bkmk_plansitesign"></a> Планирование сертификата подписи сервера сайта (самозаверяющего)  

Клиенты могут безопасно получить копию сертификата подписи сервера сайта из доменных служб Active Directory, а также во время принудительной установки клиента. Если клиенты не могут получить копию этого сертификата одним из этих способов, установите его при установке клиента. Это особенно важно, если первое взаимодействие клиента с сайтом происходит через точку управления в Интернете. Поскольку этот сервер подключается к ненадежной сети, он более уязвим для атак. Если это дополнительное действие не выполняется, клиенты автоматически загрузят копию сертификата подписи сервера сайта из точки управления.  

Клиенты не могут безопасно получить копию сертификата сервера сайта в следующих сценариях.  

- Вы не устанавливаете клиент с помощью принудительной установки, а также:  

  - Схема Active Directory не расширена для Configuration Manager.  

  - Сайт клиента не публикуется в доменных службах Active Directory.  

  - Клиент из ненадежного леса или рабочей группы.  

- Вы используете управление клиентами через Интернет и устанавливаете клиента, когда он находится в Интернете.  

#### <a name="to-install-clients-with-a-copy-of-the-site-server-signing-certificate"></a>Установка клиентов с копией сертификата подписи сервера сайта  

1.  На сервере первичного сайта найдите сертификат подписи сервера сайта. Сертификат хранится в хранилище сертификатов **SMS** Windows. Он имеет имя субъекта **Сервер сайта**, и понятное имя — **Сертификат подписи сервера сайта**.  

2.  Экспортируйте сертификат без закрытого ключа, сохраните файл в надежном месте и обращайтесь к нему только из защищенного канала.  

3.  Установите клиент с использованием следующего свойства client.msi: `SMSSIGNCERT=<full path and file name>`  


###  <a name="plan-for-pki-certificate-revocation"></a><a name="BKMK_PlanningForCRLs"></a> Планирование отзыва PKI-сертификата  

При использовании PKI-сертификатов с Configuration Manager спланируйте использование списка отзыва сертификатов (CRL). Устройства используют список отзыва сертификатов для проверки сертификата на подключаемом компьютере. Список отзыва сертификатов — это файл, который центр сертификации (ЦС) создает и подписывает. Он содержит список сертификатов, выданных ЦС, но отозванных. Когда администратор сертификатов отзывает сертификат, его отпечаток добавляется в список отзыва сертификатов. Например, если известно или предполагается, что выданный сертификат взломан.

> [!IMPORTANT]  
> Так как расположение списка отзыва сертификатов добавляется к сертификату во время выдачи центром сертификации, этот список необходимо спланировать до развертывания PKI-сертификатов, которые будет использовать Configuration Manager.  

Службы IIS всегда проверяют список CRL для клиентских сертификатов. Изменить эту настройку в Configuration Manager нельзя. По умолчанию клиенты Configuration Manager всегда проверяют список отзыва сертификатов для систем сайта. Чтобы отключить этот параметр, нужно указать свойство сайта и свойство CCMSetup.  

Если компьютеры проверяют отзыв сертификатов, но не могут найти список отзыва сертификатов, они действуют так, как будто все сертификаты в цепочке отозваны. Это связано с тем, что их отсутствие в списке отзыва сертификатов проверить нельзя. В этом случае все подключения, для которых требуются сертификаты и которые предусматривают проверку по списку CRL, завершатся ошибкой. Важно отметить, что когда вы проверяете доступность списка CRL путем перехода к его расположению HTTP, клиент Configuration Manager работает как локальная система. Поэтому проверка доступности списка CRL с помощью веб-браузера, запущенного в контексте пользователя, может завершиться успешно. Но учетная запись компьютера, возможно, будет заблокирована при попытке HTTP-подключения к тому же адресу списка CRL из-за внутреннего решения веб-фильтра. В таком случае потребуется внести в список разрешенных URL-адрес списка CRL во всех внутренних решениях веб-фильтра.

Проверка списка отзыва сертификатов при каждом использовании сертификата обеспечивает повышенную безопасность и предотвращает использование отозванных сертификатов, несмотря на то, что это приводит к задержке подключений и дополнительной обработке на стороне клиента. Вашей организации потребуется эта дополнительная проверка безопасности, если клиенты находятся в Интернете или в ненадежной сети.  

Проконсультируйтесь с администраторами PKI, прежде чем решить, должны ли клиенты Configuration Manager проверять список отзыва сертификатов. Включите этот параметр в Configuration Manager, если выполняются оба условия:  

- Инфраструктура PKI поддерживает список CRL, который публикуется в расположении, доступном для всех клиентов Configuration Manager. Этими клиентами могут быть устройства в Интернете и ненадежных лесах.  

- Требование к проверке списка отзыва сертификатов для каждого подключения к системе сайта, который настроен на использование PKI-сертификата, важнее, чем следующие требования:  
  - Быстрые подключения.  
  - Эффективная обработка на стороне клиента.  
  - Риск неудачного подключения клиентов к серверу, если не удается обнаружить список отзыва сертификатов.  


###  <a name="plan-for-the-pki-trusted-root-certificates-and-the-certificate-issuers-list"></a><a name="BKMK_PlanningForRootCAs"></a> Планирование доверенных корневых PKI-сертификатов и списка издателей сертификатов  

Если системы сайта IIS используют клиентские PKI-сертификаты для проверки подлинности клиента по протоколу HTTP или для проверки подлинности и шифрования клиента по протоколу HTTPS, может потребоваться импортировать сертификаты корневого ЦС в качестве свойства сайта. Ниже приведены два сценария.  

- Вы развертываете операционные системы с помощью Configuration Manager, а точки управления принимают подключения клиентов только по протоколу HTTPS.  

- Вы используете клиентские PKI-сертификаты, не связанные с корневым сертификатом, которому доверяют точки управления.  

  > [!NOTE]  
  > Если клиентские PKI-сертификаты выдаются из той же иерархии ЦС, которая выдает сертификаты сервера, используемые для точек управления, указывать этот сертификат корневого ЦС не нужно. Однако если вы используете несколько иерархий ЦС и не уверены в существовании между ними отношения доверия, импортируйте корневой ЦС для иерархии ЦС клиентов.  

Если требуется импортировать сертификаты корневого ЦС для Configuration Manager, экспортируйте их из выдающего ЦС или с клиентского компьютера. При экспорте сертификата из выдающего ЦС, являющегося также корневым ЦС, убедитесь, что закрытый ключ не экспортируется. Чтобы исключить незаконное изменение экспортированного файла сертификата, сохраните его в надежном месте. Во время настройки сайта требуется доступ к этому файлу. При обращении к файлу по сети убедитесь в том, что подключение защищено от вмешательства с помощью протокола IPsec.  

Если срок действия импортируемых сертификатов корневого ЦС продлен, необходимо импортировать продленные сертификаты.  

Эти импортированные сертификаты корневого ЦС и сертификат корневого ЦС каждой точки управления образуют список издателей сертификатов, используемый компьютерами Configuration Manager следующими способами.  

- Когда клиенты подключаются к точкам управления, точка управления проверяет связь сертификата клиента с доверенным корневым сертификатом из списка издателей сертификатов сайта. Если связь отсутствует, сертификат отклоняется и подключение PKI завершается неудачей.  

- Если у клиентов есть список издателей сертификата, при выборе PKI-сертификата они останавливаются на сертификате, который связан с доверенным корневым сертификатом в списке. Если такой сертификат отсутствует, клиент не выбирает PKI-сертификат. Дополнительные сведения см. в разделе [Планирование выбора PKI-сертификатов клиентов](#BKMK_PlanningForClientCertificateSelection).  


###  <a name="plan-for-pki-client-certificate-selection"></a><a name="BKMK_PlanningForClientCertificateSelection"></a> Планирование выбора PKI-сертификата клиента  

Если системы сайта IIS используют клиентские PKI-сертификаты для проверки подлинности клиента по протоколу HTTP или для проверки подлинности и шифрования клиента по протоколу HTTPS, спланируйте, каким образом клиенты Windows будут выбирать сертификат для применения в Configuration Manager.  

> [!NOTE]  
> Некоторые устройства не поддерживают метод выбора сертификата. Вместо этого они автоматически выбирают первый сертификат, соответствующий требованиям к сертификатам. Например, выбор сертификата не поддерживают клиенты на компьютерах Mac и мобильных устройствах.  

В большинстве случаев достаточно конфигурации и поведения по умолчанию. Клиент Configuration Manager на компьютерах Windows фильтрует несколько сертификатов, используя критерии в указанном ниже порядке.  

1.  Список издателей сертификатов. Сертификат связан с корневым ЦС, доверенным для точки управления.  

2.  Сертификат находится в хранилище сертификатов по умолчанию **Личные**.  

3.  Сертификат действителен, не отозван, срок его действия не истек. Проверка допустимости также гарантирует, что закрытый ключ доступен.  

4.  Сертификат может выполнять проверку подлинности клиента или выдается по имени компьютера.  

5.  Сертификат имеет наибольший срок действия.  

Настройте клиентов для использования списка издателей сертификатов следующими способами.  

- Опубликуйте его со сведениями о сайте Configuration Manager в доменных службах Active Directory.  

- Используйте принудительную установку клиента.  

- Клиенты загружают список из точки управления после своего успешного назначения сайту.  

- Во время установки клиента список указывается как свойство CCMSetup client.msi для CCMCERTISSUERS.  

Клиенты, которые установлены впервые, пока не назначены сайту и не имеют списка издателей сертификатов, пропускают эту проверку. Если у клиентов есть список издателей сертификата и нет PKI-сертификата, который связан с доверенным корневым сертификатом в списке, происходит сбой выбора сертификата. Клиенты не будут проверять другие условия выбора сертификата.  

Как правило, клиент Configuration Manager правильно определяет уникальный и подходящий PKI-сертификат. В противном случае вместо выбора сертификата на основе возможности проверки подлинности клиента можно настроить два альтернативных метода выбора.  

- Частичное совпадение строки с именем субъекта сертификата клиента. В этом методе не учитывается регистр. Этот метод подходит, если в поле субъекта используется полное доменное имя (FQDN) компьютера и требуется выбирать сертификат на основе суффикса домена, например **contoso.com**. Однако этот способ выбора можно использовать для идентификации любой цепочки последовательных символов в имени субъекта сертификата, которая отличает сертификат от других сертификатов в хранилище сертификатов клиента.  

  > [!NOTE]
  > Частичное совпадение строки с альтернативным именем субъекта (SAN) нельзя использовать в качестве параметра сайта. Несмотря на то, что частичное совпадение строки для SAN можно указать с помощью CCMSetup, оно будет перезаписано свойствами сайта в следующих случаях.  
  > 
  > - Клиенты получают данные сайта, которые опубликованы в доменных службах Active Directory.  
  >   - Клиенты устанавливаются с помощью принудительной установки клиента.  
  > 
  >   Частичное совпадение строки с SAN следует использовать только при установке клиентов вручную или если они не получают данные сайта из доменных служб Active Directory. Например, эти условия применимы только к интернет-клиентам.  

- Совпадение значений атрибута имени субъекта или значений атрибута альтернативного имени субъекта сертификата клиента. В этом методе учитывается регистр. Этот метод подходит, если в поле субъекта используется различающееся имя X500 или эквивалентные идентификаторы объектов (OID) в соответствии со стандартом RFC 3280 и требуется выбирать сертификат на основе значений этих атрибутов. Можно задать только те атрибуты и значения, которые требуются для уникальной идентификации или проверки сертификата и для отличия этого сертификата от других сертификатов в хранилище сертификатов.  

В следующей таблице приведены значения атрибутов, поддерживаемые Configuration Manager в качестве условия выбора сертификата клиента.  

|Атрибут OID|Атрибут различающегося имени|Определение атрибута|  
|-------------------|----------------------------------|--------------------------|  
|0.9.2342.19200300.100.1.25|DC|Компонент домена|  
|1.2.840.113549.1.9.1|E или E-mail|Адрес электронной почты|  
|2.5.4.3|CN|Общее имя|  
|2.5.4.4|SN|Имя субъекта|  
|2.5.4.5|SERIALNUMBER|Серийный номер|  
|2.5.4.6|В|Код страны|  
|2.5.4.7|L|Местонахождение|  
|2.5.4.8|S или ST|Название штата или провинции|  
|2.5.4.9|STREET|Адрес по улице|  
|2.5.4.10|O|Название организации|  
|2.5.4.11|OU|Подразделение|  
|2.5.4.12|T или Title|Название|  
|2.5.4.42|G или GN или GivenName|Имя|  
|2.5.4.43|I или Initials|Инициалы|  
|2.5.29.17|(без значения)|Альтернативное имя субъекта|  

Если после применения условия выбора сертификата найдено несколько подходящих сертификатов, можно переопределить конфигурацию по умолчанию для выбора сертификата с наибольшим сроком действия, указав, что сертификат не выбран. В этом случае клиент не сможет связываться с системами сайта IIS, используя PKI-сертификат. Клиент передает назначенной ему резервной точке состояния сообщение об ошибке для предупреждения о сбое выбора сертификата, чтобы вы могли изменить или уточнить критерии выбора сертификата. Затем действия клиента зависят от используемого при неудавшемся подключении протокола (HTTPS или HTTP).  

- Если не удалось подключиться по протоколу HTTPS: клиент пытается подключиться по протоколу HTTP и использует самозаверяющий сертификат клиента.  

- Если не удалось подключиться по протоколу HTTP: клиент еще раз пытается подключиться по протоколу HTTP, используя самозаверяющий сертификат клиента.  

Чтобы идентифицировать уникальный PKI-сертификат клиента, можно указать настраиваемое хранилище, отличное от используемого по умолчанию хранилища **Личное** в хранилище **Компьютер**. Тем не менее необходимо создать это хранилище независимо от Configuration Manager. У вас должна быть возможность разворачивать сертификаты в это настраиваемое хранилище и обновлять их до истечения срока действия.  

Дополнительные сведения см. в разделе [Настройка параметров для клиентских PKI-сертификатов](configure-security.md#BKMK_ConfigureClientPKI).  


###  <a name="plan-a-transition-strategy-for-pki-certificates-and-internet-based-client-management"></a><a name="BKMK_PlanningForPKITransition"></a> Планирование стратегии перехода для PKI-сертификатов и управления клиентами через Интернет  

Гибкие возможности настройки в Configuration Manager позволяют постепенно переводить клиентов и сайт на использование PKI-сертификатов для обеспечения безопасности клиентских конечных точек. PKI-сертификаты обеспечивают более высокий уровень безопасности и позволяют управлять клиентами в Интернете.  

Из-за большого числа возможностей и вариантов настройки Configuration Manager нельзя выделить единый способ переключения сайта на подключение всех клиентов по протоколу HTTPS. Тем не менее, в качестве общего руководства можно использовать следующие действия.  

1. Установите сайт Configuration Manager и настройте его для приема подключений клиентов по протоколам HTTPS и HTTP.  

2. В свойствах сайта на вкладке **Взаимодействие с клиентскими компьютерами** для параметра **Параметры системы сайта** выберите значение **HTTP или HTTPS**, а также установите флажок **Использовать сертификат PKI клиента (функция проверки подлинности клиента) при его наличии**.  Дополнительные сведения см. в разделе [Настройка параметров для клиентских PKI-сертификатов](configure-security.md#BKMK_ConfigureClientPKI).  

    > [!Note]
    > Начиная с версии 1906, эта вкладка называется **Communication Security** (Безопасность обмена данными).<!-- SCCMDocs#1645 -->  

3. Выполните пробное внедрение сертификатов PKI клиента. Пример развертывания см. в статье [Развертывание сертификата клиента для компьютеров Windows](../network/example-deployment-of-pki-certificates.md#BKMK_client2008_cm2012).  

4. Установите клиенты с помощью принудительной установки. Дополнительные сведения см. в разделе [Принудительная установка клиентов Configuration Manager](../../clients/deploy/deploy-clients-to-windows-computers.md#BKMK_ClientPush).  

5. Контролируйте развертывание и состояние клиентов с помощью отчетов и данных в консоли Configuration Manager.  

6. Отслеживайте, сколько клиентов используют сертификаты PKI, с помощью столбца **Сертификат клиента** рабочей области **Активы и соответствие** в узле **Устройства** .  

    Вы также можете развернуть на компьютерах средство Configuration Manager HTTPS Readiness Assessment Tool (**cmHttpsReadiness.exe**). Затем просматривайте в отчетах, сколько компьютеров могут использовать PKI-сертификат клиента с помощью Configuration Manager.  

   > [!NOTE]
   >  При установке клиента Configuration Manager средство **CMHttpsReadiness.exe** устанавливается в папке `%windir%\CCM`. При запуске этого средства доступны следующие параметры командной строки:  
   > 
   > - `/Store:<name>`: этот параметр аналогичен свойству **CCMCERTSTORE** client.msi.  
   > - `/Issuers:<list>`: этот параметр аналогичен свойству **CCMCERTISSUERS** client.msi.    
   > - `/Criteria:<criteria>`: этот параметр аналогичен свойству **CCMCERTSEL** client.msi.    
   > - `/SelectFirstCert`: этот параметр аналогичен свойству **CCMFIRSTCERT** client.msi.    
   > 
   >   Дополнительные сведения см. в разделе [о свойствах установки клиентов](../../clients/deploy/about-client-installation-properties.md).  

7. Когда вы уверены, что достаточное количество клиентов успешно использует PKI-сертификаты клиентов для проверки подлинности по протоколу HTTP, выполните указанные ниже действия.  

   1.  Разверните PKI-сертификат веб-сервера на рядовом сервере, который будет использоваться как дополнительная точка управления для сайта, и настройте этот сертификат в службах IIS. Дополнительные сведения см. в разделе [Развертывание сертификата веб-сервера для систем сайта с запущенными службами IIS](../network/example-deployment-of-pki-certificates.md#BKMK_webserver2008_cm2012).  

   2.  Установите роль точки управления на этот сервер и настройте параметр **Подключения клиента** в свойствах точки управления для использования протокола **HTTPS**.  

8. Проверьте и убедитесь, что клиенты, имеющие PKI-сертификат, используют эту новую точку управления, подключаясь по протоколу HTTPS. Для контроля можно использовать журналы служб IIS или счетчики производительности.  

9. Настройте другие роли системы сайта для подключения клиентов по протоколу HTTPS. Если вы хотите управлять клиентами в Интернете, убедитесь, что системы сайта имеют полное доменное имя Интернета. Настройте отдельные точки управления и точки распространения для приема подключений клиентов из Интернета.  

    > [!IMPORTANT]  
    > Перед настройкой ролей системы сайта для приема подключений через Интернет ознакомьтесь со сведениями о планировании и необходимых компонентах для управления клиентами через Интернет. Дополнительные сведения см. в статье [Взаимодействие между конечными точками](../hierarchy/communications-between-endpoints.md).  

10. Расширьте зону развертывания PKI-сертификатов для клиентов, а также для систем сайта с запущенными службами IIS. Настройте роли системы сайта для клиентских подключений по HTTPS и подключений к Интернету по необходимости.  

11. Меры для повышения безопасности. Когда вы будете уверены, что все клиенты используют PKI-сертификаты клиента для проверки подлинности и подключения и шифрования, измените свойства сайта, чтобы использовать только протокол HTTPS.  

    Этот план сначала вводит PKI-сертификаты для проверки подлинности только по протоколу HTTP, а затем для проверки подлинности и шифрования по протоколу HTTPS. Если следовать этому плану для постепенного внедрения этих сертификатов, снижается риск потери управления клиентами. Вы также получите более высокий уровень безопасности, поддерживаемый в Configuration Manager.  

##  <a name="plan-for-the-trusted-root-key"></a><a name="BKMK_PlanningForRTK"></a> Планирование корневого ключа доверия  

Корневой ключ доверия Configuration Manager обеспечивает для клиентов Configuration Manager возможность проверки принадлежности систем сайта к той же иерархии, что и клиент. Каждый сервер сайта создает ключ межсайтового обмена для связи с другими сайтами. Ключ межсайтового обмена самого верхнего сайта в иерархии называется корневым ключом доверия.  

Корневой ключ доверия в Configuration Manager по функции напоминает корневой сертификат инфраструктуры открытых ключей. Все данные, подписанные закрытым ключом корневого ключа доверия, являются доверенными ниже по иерархии. Клиенты хранят копию корневого ключа доверия сайта в пространстве имен WMI **root\ccm\locationservices**. 

Например, сайт выдает точке управления сертификат, который подписывается с помощью закрытого ключа корневого ключа доверия. Сайт предоставляет клиентам открытый ключ доверенного корневого ключа. Затем клиенты могут различать точки управления, которые находятся в их иерархии и за ее пределами.   

Клиенты автоматически получают открытую копию корневого ключа доверия двумя способами.  

- Вы расширяете схему Active Directory для Configuration Manager и публикуете сайт в доменных службах Active Directory. Затем клиенты получают данные этого сайта с сервера глобального каталога. Дополнительные сведения см. в разделе [Подготовка Active Directory к публикации сайта](../network/extend-the-active-directory-schema.md).  

- Вы устанавливаете клиенты с помощью принудительной установки. Дополнительные сведения см. в разделе [Принудительная установка клиента](../../clients/deploy/plan/client-installation-methods.md#client-push-installation).  

Если клиенты не могут получить корневой ключ доверия с помощью одного из этих способов, они считают доверенным корневой ключ доверия, предоставленный первой точкой управления, к которой они подключились. В этом случае клиент может быть перенаправлен на точку управления, созданную злоумышленниками, где он получит политику от фальшивой точки управления. Это требует от злоумышленника глубоких знаний. Эта атака направлена на ограниченный период до того, как клиент получит корневой ключ доверия от допустимой точки управления. Чтобы сократить риск преднамеренного направления клиентов к фальшивой точке управления, клиентам можно заранее предоставить корневой ключ доверия.  

Чтобы заранее предоставить и проверить корневой ключ доверия клиенту Configuration Manager, используйте следующую процедуру.  

- [Предоставление корневого ключа доверия клиенту в виде файла](#bkmk_trk-provision-file)  

- [Предоставление корневого ключа доверия клиенту без использования файла](#bkmk_trk-provision-nofile)  

- [Проверка корневого ключа доверия на клиенте](#bkmk_trk-verify)  

- [Удаление или замена корневого ключа доверия](#bkmk_trk-reset)  

  > [!NOTE]  
  > Если клиенты могут получить корневой ключ доверия из доменных служб Active Directory или принудительной установки клиента, вам не нужно предоставлять его заранее. 
  > 
  > Когда клиенты подключаются к точкам управления по протоколу HTTPS, вам не нужно заранее предоставлять корневой ключ доверия. Они устанавливают отношение доверия с помощью PKI-сертификатов.  


### <a name="pre-provision-a-client-with-the-trusted-root-key-by-using-a-file"></a><a name="bkmk_trk-provision-file"></a> Предоставление корневого ключа доверия клиенту в виде файла  

1.  На сервере сайта откройте следующий файл в текстовом редакторе: `<Configuration Manager install directory>\bin\mobileclient.tcf`  

2.  Найдите запись **SMSPublicRootKey =** . Скопируйте ключ из этой строки и закройте файл, не сохраняя изменения.  

3.  Создайте текстовый файл и вставьте данные ключа, скопированные из файла mobileclient.tcf.  

4.  Сохраните файл в расположении, где все компьютеры смогут получить к нему доступ. Это расположение должно быть защищено от манипуляций с файлом.  

5.  Установите клиент одним из способов, поддерживающих свойства client.msi. Укажите следующее свойство: `SMSROOTKEYPATH=<full path and file name>`  

    > [!IMPORTANT]  
    > При указании корневого ключа доверия во время установки клиента также укажите код сайта. Используйте следующее свойство client.msi: `SMSSITECODE=<site code>`   


### <a name="pre-provision-a-client-with-the-trusted-root-key-without-using-a-file"></a><a name="bkmk_trk-provision-nofile"></a> Предоставление корневого ключа доверия клиенту без использования файла  

1.  На сервере сайта откройте следующий файл в текстовом редакторе: `<Configuration Manager install directory>\bin\mobileclient.tcf`  

2.  Найдите запись **SMSPublicRootKey =** . Скопируйте ключ из этой строки и закройте файл, не сохраняя изменения.  

3.  Установите клиент одним из способов, поддерживающих свойства client.msi. Укажите следующее свойство client.msi: `SMSPublicRootKey=<key>`, где `<key>` — это строка, скопированная из файла mobileclient.tcf.  

    > [!IMPORTANT]  
    >  При указании корневого ключа доверия во время установки клиента также укажите код сайта. Используйте следующее свойство client.msi: `SMSSITECODE=<site code>`   


### <a name="verify-the-trusted-root-key-on-a-client"></a><a name="bkmk_trk-verify"></a> Проверьте корневой ключ доверия на клиенте  

1. Откройте консоль Windows PowerShell с правами администратора.  

2. Выполните следующую команду:  

    ``` PowerShell
    (Get-WmiObject -Namespace root\ccm\locationservices -Class TrustedRootKey).TrustedRootKey
    ```

Возвращенная строка будет корневым ключом доверия. Убедитесь в том, что он совпадает со значением **SMSPublicRootKey** в файле mobileclient.tcf на сайте сервера.  


### <a name="remove-or-replace-the-trusted-root-key"></a><a name="bkmk_trk-reset"></a> Удаление или замена корневого ключа доверия  

Для удаления корневого ключа доверия с клиента используйте свойство client.msi **RESETKEYINFORMATION = TRUE**. 

Для замены корневого ключа доверия переустановите клиент вместе с новым корневым ключом доверия. Например, принудительно установите клиента или укажите свойство client.msi **SMSPublicRootKey**.  

Дополнительные сведения об этих свойствах установки см. в разделе [Сведения о параметрах и свойствах установки клиента](../../clients/deploy/about-client-installation-properties.md).



##  <a name="plan-for-signing-and-encryption"></a><a name="BKMK_PlanningForSigningEncryption"></a> Планирование подписывания и шифрования  
 
Если для всех подключений клиентов используются PKI-сертификаты, нет необходимости планировать подписывание и шифрование для защиты подключений клиентов. Если какие-то системы сайта со службами IIS используют подключение по протоколу HTTP, необходимо решить, как защитить подключения клиентов к сайту.  

Для защиты данных, отправляемых клиентами точкам управления, можно включить их обязательное подписывание. Можно также требовать алгоритм SHA-256 для подписи. Эта конфигурация более защищенная, но не требуйте SHA-256, если не все клиенты его поддерживают. Многие операционные системы изначально поддерживают этот алгоритм, однако для более старых операционных систем может потребоваться установка обновления или исправления. 

Подписывание защищает передаваемые данные от манипуляций, а шифрование позволяет защитить эти данные от раскрытия. Для данных инвентаризации и сообщений о состоянии, передаваемых клиентами на точки управления, можно включить шифрование 3DES. Вам не нужно устанавливать на клиенте обновления для использования этого варианта. Клиенты и точки управления расходуют дополнительные ресурсы ЦП для шифрования и расшифровки.  

Дополнительные сведения о настройке параметров подписывания и шифрования см. в разделе [Настройка подписывания и шифрования](configure-security.md#BKMK_ConfigureSigningEncryption).  



##  <a name="plan-for-role-based-administration"></a><a name="BKMK_PlanningForRBA"></a> Планирование ролевого администрирования  

Дополнительные сведения см. в разделе [Основы ролевого администрирования](../../understand/fundamentals-of-role-based-administration.md).  



## <a name="plan-for-azure-active-directory"></a><a name="bkmk_planazuread"></a> Планирование Azure Active Directory

Configuration Manager интегрируется с Azure Active Directory (Azure AD), чтобы сайт и клиенты могли использовать современную проверку подлинности. Использование сайта с Azure AD поддерживает следующие сценарии Configuration Manager:

**Клиент**  

- [Управление клиентами в Интернете через шлюз управления облаком](../../clients/manage/cmg/plan-cloud-management-gateway.md#scenarios)  

- [Управление устройствами, присоединенными к облачному домену](../../clients/deploy/deploy-clients-cmg-azure.md)  

- [Совместное управление](../../../comanage/overview.md)  

- [Развертывание приложений, доступных для пользователя](../../../apps/deploy-use/deploy-applications.md#deploy-user-available-applications-on-azure-ad-joined-devices)  

- [Онлайн-приложения из Microsoft Store для бизнеса](../../../apps/deploy-use/manage-apps-from-the-windows-store-for-business.md)  

- Укажите менее строгие требования к инфраструктуре. Например, [центр программного обеспечения с точкой управления](../../../apps/plan-design/plan-for-software-center.md#bkmk_userex) вместо каталога приложений  

- [Управление приложениями Office 365](../../../sum/deploy-use/manage-office-365-proplus-updates.md)  


**Сервер**  

- [Аналитика компьютеров](../../../desktop-analytics/overview.md)  

- [Azure Log Analytics](https://docs.microsoft.com/azure/azure-monitor/platform/collect-sccm)  

- [Центр сообщества](../../get-started/capabilities-in-technical-preview-1807.md#bkmk_hub)  

- [Облачная точка распространения](../hierarchy/use-a-cloud-based-distribution-point.md)  

- [Обнаружение пользователей](../../servers/deploy/configure/configure-discovery-methods.md#azureaadisc)  


Дополнительные сведения о подключении вашего сайта к Azure AD см. в разделе [Настройка служб Azure](../../servers/deploy/configure/azure-services-wizard.md).


Дополнительные сведения об Azure см. в [документации по Azure Active Directory](https://docs.microsoft.com/azure/active-directory/).



## <a name="plan-for-sms-provider-authentication"></a><a name="bkmk_auth"></a> Планирование проверки подлинности поставщика SMS
<!--1357013--> 

С версии 1810 вы можете указать минимально необходимый уровень аутентификации для доступа администраторов к сайтам Configuration Manager. Эта функция позволяет настроить для администраторов требование входить в Windows с определенным уровнем. Он применяется ко всем компонентам, которые обращаются к поставщику SMS. Сюда относятся консоль Configuration Manager, методы пакета SDK и командлеты Windows PowerShell. 

Эта конфигурация применяется для всей иерархии. Прежде чем изменять его значение, убедитесь, что все администраторы Configuration Manager могут выполнить вход в Windows с нужным уровнем проверки подлинности. 

Доступны следующие уровни:

- **Аутентификация Windows**. Требуется аутентификация с доменными учетными данными Active Directory.   

- **Аутентификация на основе сертификата**. Требуется аутентификация с действительным сертификатом, выданным доверенным центром сертификации PKI.  

- **Аутентификация Windows Hello для бизнеса**. Требуется строгая двухфакторная аутентификация с привязкой к устройству и использованием биометрических данных или ПИН-кода.  

Дополнительные сведения см. в разделе [Планирование использования поставщика SMS](../hierarchy/plan-for-the-sms-provider.md#bkmk_auth). 



## <a name="see-also"></a>См. также
- [Безопасность и конфиденциальность клиентов Configuration Manager](../../clients/deploy/plan/security-and-privacy-for-clients.md)  

- [Настройка безопасности](configure-security.md)  

- [Связь между конечными точками](../hierarchy/communications-between-endpoints.md)  

- [Технический справочник по элементам управления шифрования](cryptographic-controls-technical-reference.md)  

- [Требования к сертификатам PKI](../network/pki-certificate-requirements.md)  

