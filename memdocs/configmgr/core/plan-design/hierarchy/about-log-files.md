---
title: Сведения о файлах журнала
titleSuffix: Configuration Manager
description: Используйте файлы журналов для устранения неполадок с клиентами и системами сайта Configuration Manager.
ms.date: 11/29/2019
ms.prod: configuration-manager
ms.technology: configmgr-core
ms.topic: conceptual
ms.assetid: b1751e3c-a60c-4ab7-a943-2595df1eb612
author: aczechowski
ms.author: aaroncz
manager: dougeby
ms.openlocfilehash: d6be23adc7ac082545bffeef59ed52d3455d9931
ms.sourcegitcommit: bbf820c35414bf2cba356f30fe047c1a34c5384d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/21/2020
ms.locfileid: "81703752"
---
# <a name="about-log-files-in-configuration-manager"></a>Сведения о файлах журналов в Configuration Manager

*Область применения: Configuration Manager (Current Branch)*

Клиентские компоненты и компоненты сервера сайта в Configuration Manager записывают сведения о процессах в отдельные файлы журналов. Информацию в этих файлах журнала можно использовать для устранения неполадок. По умолчанию в Configuration Manager включено ведение журналов клиентских и серверных компонентов.

В этой статье содержатся общие сведения о файлах журналов Configuration Manager, в том числе используемые средства, способы настройки журналов и их поиска. Дополнительные сведения о конкретных файлах журналов см. в [справочнике по файлам журналов](log-files.md).


## <a name="how-it-works"></a><a name="BKMK_AboutLogs"></a> Принцип работы

Большая часть процессов в Configuration Manager записывает сведения о функционировании в файл журнала, связанный только с определенным процессом. Эти файлы журнала определяются по расширениям **LOG** или **LO_** . Configuration Manager ведет запись в файл с расширением LOG до тех пор, пока этот журнал не достигает максимального размера. По достижении максимального размера LOG-файл журнала копируется в файл с таким же именем, но с расширением LO_, и процесс или компонент продолжает запись данных в LOG-файл. Когда LOG-файл снова достигает максимального размера, LO_-файл перезаписывается, и процесс повторяется. Некоторые компоненты ведут историю файлов журнала, присоединяя метку даты и времени к имени файла журнала и сохраняя расширение LOG.


## <a name="log-viewer-tools"></a><a name="bkmk_tools"></a> Средства просмотра журналов

Все файлы журналов Configuration Manager содержат обычный текст, поэтому их можно просматривать с помощью любого средства чтения текста, например Блокнота. В журналах используется уникальное форматирование, которое хорошо видно в одном из следующих специализированных инструментов:

- [CMTrace](#cmtrace)
- [OneTrace](#onetrace);
- [средство просмотра журналов центра поддержки](#support-center-log-viewer).

### <a name="cmtrace"></a>CMTrace

Журналы можно просмотреть в средстве просмотра журналов Configuration Manager **CMTrace**. Оно находится в папке `\SMSSetup\Tools` исходного носителя Configuration Manager. Средство CMTrace добавляется во все загрузочные образы, размещаемые в библиотеке программного обеспечения. Средство просмотра журналов CMTrace автоматически устанавливается вместе с клиентом Configuration Manager.<!--1357971--> Дополнительные сведения см. в статье [CMTrace](../../support/cmtrace.md).

### <a name="onetrace"></a>OneTrace

Начиная с версии 1906, **OneTrace** является новым средством просмотра журналов для центра поддержки. Оно работает аналогично CMTrace, но обладает некоторыми усовершенствованиями. Дополнительные сведения о средстве OneTrace для центра поддержки см. [здесь](../../support/support-center-onetrace.md).

### <a name="support-center-log-viewer"></a>Средство просмотра журналов центра поддержки

**Центр поддержки** содержит современное средство просмотра журнала. Это средство заменяет CMTrace и предоставляет настраиваемый интерфейс с поддержкой для закрепляемых окон и вкладок. В нем быстро работает уровень представления данных; для загрузки больших файлов журнала нужны секунды. Дополнительные сведения см. в [справочнике по средству просмотра журналов центра поддержки](../../support/support-center-ui-reference.md#bkmk_log-viewer).

> [!Note]  
> Центр технической поддержки и OneTrace используют Windows Presentation Foundation (WPF). Этот компонент недоступен в среде предустановки Windows. Продолжайте использовать CMTrace в загрузочных образах при развертывании через последовательность задач.


## <a name="configure-logging-options"></a><a name="bkmk_logoptions"></a> Настройка параметров ведения журнала

Можно изменить конфигурацию файлов журнала, например уровень детализации, размер и период, охватываемый в журнале. Существует несколько способов изменить эти параметры:

- [во время установки клиента](#bkmk_logoptions-clientprop);
- [с помощью Configuration Manager Service Manager](#bkmk_logoptions-sm);
- [с помощью реестра Windows](#bkmk_logoptions-registry).
- [в консоли Configuration Manager](#bkmk_logoptions-console).

### <a name="configure-logging-options-during-client-installation"></a><a name="bkmk_logoptions-clientprop"></a> Настройка параметров ведения журнала во время установки клиента

Вы можете задать конфигурацию файлов журнала клиента во время установки. Используйте для этого следующие свойства:

- CCMENABLELOGGING
- CCMDEBUGLOGGING
- CCMLOGLEVEL
- CCMLOGMAXHISTORY
- CCMLOGMAXSIZE

Дополнительные сведения см. в статье [Свойства установки клиента](../../clients/deploy/about-client-installation-properties.md#clientMsiProps).

### <a name="configure-logging-options-by-using-configuration-manager-service-manager"></a><a name="bkmk_logoptions-sm"></a> Настройка параметров ведения журналов с помощью Configuration Manager Service Manager

Можно изменить место хранения и размер файлов журнала в Configuration Manager.  

Чтобы изменить размер файлов журнала, имя и расположение файла журнала, а также настроить для нескольких компонентов запись данных в один и тот же файл журнала, выполните приведенные далее действия.  

#### <a name="modify-logging-for-a-component"></a>Настройка ведения журнала для компонента  

1. В консоли Configuration Manager перейдите в рабочую область **Мониторинг**, разверните раздел **Состояние системы**, а затем выберите узел **Состояние сайта** или **Состояние компонента**.  

2. На ленте нажмите кнопку **Пуск**, а затем выберите **Диспетчер служб Configuration Manager**.  

3. После открытия Configuration Manager Service Manager подключитесь к сайту, который требует управления. Если нужный сайт не отображается, щелкните **Сайт**, выберите команду **Подключить**, а затем введите имя сервера сайта требуемого сайта.  

4. Разверните сайт и в зависимости от расположения компонентов для управления перейдите к элементу **Компоненты** или **Серверы** .  

5. В правой области выберите один или несколько компонентов.  

6. В меню **Компонент** выберите **Ведение журнала**.  

7. В диалоговом окне **Ведение журналов компонентов Configuration Manager** настройте доступные параметры конфигурации для выбранного элемента.  

8. Нажмите кнопку **ОК** , чтобы сохранить настройки.  

### <a name="configure-logging-options-by-using-the-windows-registry"></a><a name="bkmk_logoptions-registry"></a> Настройка параметров ведения журнала с помощью реестра Windows

<!-- SCCMDocs#992 -->
В реестре Windows для серверов или клиентов можно изменить следующие параметры ведения журнала:

- уровень детализации;
- максимальный период, охватываемый в журнале;
- Максимальный объем

При устранении неполадок можно включить подробное ведение журнала. В таком случае программа Configuration Manager будет записывать дополнительные сведения в файлы журнала.

> [!Warning]
> Неправильная настройка этих параметров может привести к тому, что Configuration Manager будет записывать очень большие объемы информации или вообще ничего. Хотя эти данные могут оказаться полезными для устранения неполадок, следует соблюдать осторожность при изменении этих значений на рабочих сайтах. Сначала всегда проверяйте эти изменения в лабораторной среде. Оно может привести к избыточному ведению журналов, затрудняющему поиск нужных сведений в файлах журнала.

После внесения изменений в эти параметры реестра перезапустите компонент:

- При изменении параметров клиента перезапустите службу **SMS Agent Host** (CcmExec).
- При изменении параметров сервера перезапустите службу **SMS Executive**.

Параметры реестра зависят от компонента:

- [клиент и точка управления](#bkmk_reg-client);
- [сервер сайта](#bkmk_reg-site);
- [Роль системы сайта](#bkmk_reg-role)
- [Консоль Configuration Manager](#bkmk_reg-console)

#### <a name="client-and-management-point-logging-options"></a><a name="bkmk_reg-client"></a> Параметры ведения журнала для клиента и точки управления

Чтобы настроить параметры ведения журнала для всех компонентов в клиенте или в системе сайта клиента точки управления, настройте приведенные ниже значения **REG_DWORD** в следующем разделе реестра Windows:

`HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\CCM\Logging\@Global`

|Имя  |Значения  |Описание:  |
|---------|---------|---------|
|LogLevel|`0`: Подробные сведения<br>`1`: По умолчанию<br>`2`: предупреждения и ошибки<br>`3`: только ошибки|Уровень детализации данных, записываемых в файлы журнала.|
|LogMaxHistory|Любое целое число, которое больше нуля или равно ему, например:<br>`0`: версии журнала не сохраняются<br>`1`: По умолчанию|Когда файл журнала достигает максимального размера, клиент переименовывает его в резервную копию и создает другой файл журнала. Укажите, сколько предыдущих версий следует хранить.|
|LogMaxSize|Любое целое число, которое больше 10 000 или равно этому числу, например:<br>250 000|Максимальный размер файла журнала в байтах. Если размер журнала увеличивается до заданного значения, клиент переименовывает его в архивный файл и создает новый файл. Значение по умолчанию — 250 000 байт.|

> [!Note]  
> Не изменяйте другие значения, которые могут присутствовать в этом разделе реестра.

Для расширенной отладки можно также добавить приведенное ниже значение **REG_SZ** в следующий раздел реестра Windows:

`HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\CCM\Logging\DebugLogging`

|Имя  |Значения  |Описание:  |
|---------|---------|---------|
|Включено | `True`: включение журналов отладки<br>`False`: отключение журналов отладки |Включает ведение журнала отладки для устранения неполадок.|

Если включить этот параметр, клиент записывает в журнал сведения низкого уровня для устранения неполадок. Избегайте использования этого параметра на рабочих сайтах. Оно может привести к избыточному ведению журналов, затрудняющему поиск нужных сведений в файлах журнала. Не забудьте отключить этот параметр после устранения проблемы.

#### <a name="site-server-logging-options"></a><a name="bkmk_reg-site"></a> Параметры ведения журнала для сервера сайта

Параметры можно настроить глобально или для конкретного компонента на сервере сайта Configuration Manager.

Настройте приведенные ниже значения в следующем разделе реестра Windows:

`HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\SMS\Tracing`

|Имя  |Значения  |Type  |Описание:
|---------|---------|---------|---------|
|SqlEnabled| `1`: включение трассировки SQL<br> `0`: отключение трассировки SQL |REG_DWORD|Добавление ведения журнала трассировки SQL во все журналы сервера сайта.|
|ArchiveEnabled| `1`: включение архивов журналов<br> `0`: отключение архивов журналов | REG_DWORD |Архивирование журналов сервера сайта в отдельное расположение для ведения истории.|
|ArchivePath| Допустимый путь к папке, например `C:\Logs\Archive` | REG_SZ |Путь к расположению хранения архивов журналов сервера сайта.|

Включайте трассировку SQL только в целях устранения неполадок. Старайтесь не использовать ее на рабочих сайтах. Оно может привести к избыточному ведению журналов, затрудняющему поиск нужных сведений в файлах журнала. Не забудьте отключить этот параметр после устранения проблемы.

> [!Note]  
> Не изменяйте другие значения, которые могут присутствовать в этом разделе реестра.

Чтобы настроить параметры ведения журнала для определенного компонента сервера, настройте приведенные ниже значения **REG_DWORD** в следующем разделе реестра Windows:

`HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\SMS\Tracing\<ComponentName>`

|Имя  |Значения  |Описание:  |
|---------|---------|---------|
|LoggingLevel|`0`: Подробные сведения<br>`1`: По умолчанию<br>`2`: предупреждения и ошибки<br>`3`: только ошибки|Уровень детализации данных, записываемых в файлы журнала.|
|LogMaxHistory|Любое целое число, которое больше нуля или равно ему, например:<br>`0`: версии журнала не сохраняются<br>`1`: По умолчанию|Когда файл журнала достигает максимального размера, сервер переименовывает его в резервную копию и создает новый файл журнала. Укажите, сколько предыдущих версий следует хранить.|
|MaxFileSize|Любое целое число, которое больше 10 000 или равно этому числу, например:<br>250 000|Максимальный размер файла журнала в байтах. Если размер журнала увеличивается до заданного значения, клиент переименовывает его в архивный файл и создает новый файл. Значение по умолчанию — 250 000 байт.|
|DebugLogging| `1`: включение журналов отладки<br>`0`: отключение журналов отладки |Включает ведение журнала отладки для устранения неполадок.|

Если включить параметр DebugLogging, сервер записывает в журнал сведения низкого уровня для устранения неполадок. Избегайте использования этого параметра на рабочих сайтах. Оно может привести к избыточному ведению журналов, затрудняющему поиск нужных сведений в файлах журнала. Не забудьте отключить этот параметр после устранения проблемы.

> [!Note]  
> Не изменяйте другие значения, которые могут присутствовать в этом разделе реестра.

#### <a name="site-system-role-logging-options"></a><a name="bkmk_reg-role"></a> Параметры ведения журнала для роли системы сайта

Параметры можно настроить глобально или для конкретного компонента в системе сайта, где размещена роль сервера Configuration Manager.

Чтобы настроить параметры ведения журнала для определенного компонента сервера, настройте приведенные ниже значения **REG_DWORD** в следующем разделе реестра Windows:

`HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\SMS\<ComponentName>\Logging`

Например, для роли точки распространения:

`HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\SMS\DP\Logging`

|Имя  |Значения  |Описание:  |
|---------|---------|---------|
|LogLevel|`0`: Подробные сведения<br>`1`: По умолчанию<br>`2`: предупреждения и ошибки<br>`3`: только ошибки|Уровень детализации данных, записываемых в файлы журнала.|
|LogMaxHistory|Любое целое число, которое больше нуля или равно ему, например:<br>`0`: версии журнала не сохраняются<br>`1`: По умолчанию|Когда файл журнала достигает максимального размера, сервер переименовывает его в резервную копию и создает новый файл журнала. Укажите, сколько предыдущих версий следует хранить.|
|LogMaxSize|Любое целое число, которое больше 10 000 или равно этому числу, например:<br>250 000|Максимальный размер файла журнала в байтах. Если размер журнала достигает заданного значения, сервер переименовывает его в архивный файл и создает другой файл. Значение по умолчанию — 250 000 байт.|

> [!Note]  
> Не изменяйте другие значения, которые могут присутствовать в этом разделе реестра.

#### <a name="configuration-manager-console-logging-options"></a><a name="bkmk_reg-console"></a> Параметры ведения журнала консоли Configuration Manager

Чтобы изменить уровень детализации журнала AdminUI.log для консоли Configuration Manager, выполните следующую процедуру:

1. Откройте файл конфигурации консоли **Microsoft.ConfigurationManagement.exe.config** в редакторе XML, например в Блокноте. Файл конфигурации по умолчанию находится в следующем расположении: `C:\Program Files (x86)\Microsoft Configuration Manager\AdminConsole\bin\Microsoft.ConfigurationManagement.exe.config`

1. В элементе **system.diagnostics** > **sources** > **source** измените атрибут **switchValue** с `Error` на `Verbose`. Пример.

    Исходный вариант: `<source name="SmsAdminUISnapIn" switchValue="Error">` Новый вариант: `<source name="SmsAdminUISnapIn" switchValue="Verbose" >`

1. Сохраните файл и перезапустите консоль.

### <a name="configure-logging-options-in-the-configuration-manager-console"></a><a name="bkmk_logoptions-console"></a> Настройка параметров ведения журнала в консоли Configuration Manager

<!-- 4433455 -->

Начиная с версии 1910 вы можете включить или отключить ведение подробного журнала в клиенте или коллекции из консоли:

1. В консоли Configuration Manager перейдите в рабочую область **Активы и соответствие**, выберите узел **Устройства** и укажите целевое устройство.

1. На вкладке **Главная** ленты в группе **Устройство** выберите **Client Diagnostics** (Диагностика клиента). Выберите одно из доступных действий.

Дополнительные сведения см. в разделе [Диагностика клиента](../../clients/manage/client-notification.md#client-diagnostics).

## <a name="locating-log-files"></a><a name="BKMK_LogLocation"></a> Поиск файлов журнала

Configuration Manager и зависимые компоненты хранят файлы журналов в различных местах. Эти расположения зависят от процесса, который создает файл журнала, и настройки среды.

По умолчанию используются приведенные ниже расположения. Если вы настроили каталоги установки в вашей среде, фактические пути могут отличаться.

- Клиент: `C:\Windows\CCM\logs`
- Сервер: `C:\Program Files\Microsoft Configuration Manager\Logs`
- Точка управления: `C:\SMS_CCM\Logs`
- Консоль Configuration Manager: `C:\Program Files (x86)\Microsoft Configuration Manager\AdminConsole\AdminUILog`
- IIS: `C:\inetpub\logs\logfiles\w3svc1`

### <a name="task-sequence-log-locations"></a>Расположения журналов последовательностей задач

Расположение файла журнала последовательностей задач **smsts.log** зависит от этапа последовательности задач:

- В Windows PE перед шагом [форматирования диска и создания разделов](../../../osd/understand/task-sequence-steps.md#BKMK_FormatandPartitionDisk): `X:\Windows\temp\smstslog\smsts.log` (X является диском RAM для Windows PE).
- В Windows PE после шага **форматирования диска и создания разделов**: файл хранится в `X:\smstslog\smsts.log`, а затем, когда диск готов, копируется в `C:\_SMSTaskSequence\Logs\smstslog\smsts.log`.
- В новой ОС Windows перед установкой клиента: `C:\_SMSTaskSequence\Logs\smstslog\smsts.log`.
- В Windows после установки клиента: `C:\Windows\CCM\Logs\smstslog\smsts.log`.
- В Windows после завершения последовательности задач: `C:\Windows\CCM\Logs\smsts.log`.

> [!Tip]  
> Переменная последовательности задач, доступная только для чтения, [_SMSTSLogPath](../../../osd/understand/task-sequence-variables.md#SMSTSLogPath) всегда содержит путь к текущему файлу журнала.


## <a name="see-also"></a>См. также

- [Справочник по файлам журналов](log-files.md)

- [Средство OneTrace для центра поддержки](../../support/support-center-onetrace.md)

- [Средство просмотра файлов журнала центра поддержки](../../support/support-center.md#support-center-log-file-viewer)

- [CMTrace](../../support/cmtrace.md)
