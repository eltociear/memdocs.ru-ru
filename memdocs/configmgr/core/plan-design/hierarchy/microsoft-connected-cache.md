---
title: Microsoft Connected Cache
titleSuffix: Configuration Manager
description: Используйте точку распространения Configuration Manager в качестве локального сервера кэширования для оптимизации доставки
ms.date: 05/05/2020
ms.prod: configuration-manager
ms.technology: configmgr-core
ms.topic: conceptual
ms.assetid: c5cb5753-5728-4f81-b830-a6fd1a3e105c
author: aczechowski
ms.author: aaroncz
manager: dougeby
ms.openlocfilehash: 4dead573e1744a5c8b84ff954e85be43af644486
ms.sourcegitcommit: a77ba49424803fddcaf23326f1befbc004e48ac9
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/27/2020
ms.locfileid: "83878498"
---
# <a name="microsoft-connected-cache-in-configuration-manager"></a>Подключенный кэш Майкрософт в Configuration Manager

*Область применения: Configuration Manager (Current Branch)*

<!--3555764-->

Начиная с версии 1906 вы можете установить сервер подключенного кэша Майкрософт на своих точках распространения. Благодаря кэшированию содержимого в локальной среде клиенты могут использовать преимущества оптимизации доставки, а вы можете защитить каналы связи глобальной сети.

> [!NOTE]
> Начиная с версии 1910 эта функция теперь называется **подключенным кэшем Майкрософт**. Ранее она называлась оптимизацией доставки с помощью сетевого кэша.

Сервер кэша выступает в роли прозрачного кэша по запросу для содержимого, скачиваемого службой оптимизации доставки. Чтобы этот сервер был доступен только членам локальной группы границ Configuration Manager, настройте параметры клиента.

Этот кэш не связан с содержимым точки распространения Configuration Manager. Если для роли точки распространения выбран тот же диск, ее содержимое хранится отдельно.

> [!Note]  
> Сервер подключенного кэша — это приложение Windows Server. Оно пока находится на этапе разработки.

## <a name="how-it-works"></a>Принцип работы

Когда вы настраиваете клиенты для использования сервера подключенного кэша, они больше не запрашивают управляемое облаком Майкрософт содержимое из Интернета. Клиенты запрашивают это содержимое с сервера кэша, установленного на точке распространения. Локальный сервер кэширует это содержимое, используя функцию IIS для маршрутизации запросов приложений (ARR). Тогда кэширующий сервер сможет быстро отвечать на любые будущие запросы на одно и то же содержимое. Если сервер подключенного кэша недоступен или содержимое еще не кэшировано, клиенты скачивают содержимое из Интернета. Клиенты также используют оптимизацию доставки, поэтому загружайте части содержимого с узлов в их сеть.

![Схема работы подключенного кэша](media/3555764-microsoft-connected-cache.png)

1. Клиент проверяет наличие обновлений и получает адрес сети доставки содержимого (CDN).

2. Configuration Manager настраивает параметры оптимизации доставки на клиенте, включая имя кэширующего сервера.

3. Клиент A запрашивает содержимое с сервера кэширования оптимизации доставки.

4. Если в кэше содержимого нет, то сервер кэша оптимизации доставки получает содержимое из CDN.

5. Если кэширующий сервер не отвечает, клиент загружает содержимое из CDN.

6. Клиенты используют оптимизацию доставки для получения части содержимого из узлов.

## <a name="prerequisites-and-limitations"></a>Предварительные условия и ограничения

- *Локальная* точка распространения со следующими настройками.

  - Работает под управлением ОС Windows Server 2012, Windows Server 2012 R2, Windows Server 2016 или Windows Server 2019

  - Веб-сайт по умолчанию доступен на порту 80

  - Не устанавливайте предварительно функцию [Маршрутизация запросов приложений](https://docs.microsoft.com/iis/extensions/planning-for-arr/application-request-routing-version-2-overview) (ARR) IIS. Подключенный кэш устанавливает ARR и настраивает его параметры. Корпорация Майкрософт не может гарантировать, что настройки ARR подключенного кэша не будут конфликтовать с другими приложениями на сервере, которые также используют эту функцию.

  - Точке распространения требуется доступ к Microsoft Cloud через Интернет. URL-адреса зависят от облачного содержимого. Дополнительные сведения о требованиях для доступа к Интернету см. в [этой статье](../network/internet-endpoints.md).

  - Начиная с версии 2002, приложение "Подключенный кэш" может использовать прокси-сервер без проверки подлинности для доступа к Интернету. Дополнительные сведения см. в разделе [Настройки прокси-сервера для сервера системы сайта](../network/proxy-server-support.md#configure-the-proxy-for-a-site-system-server).<!-- 5856396 -->

- Клиенты с ОС Windows 10 версии 1709 или более поздней

## <a name="enable-connected-cache"></a>Включение подключенного кэша

1. В консоли Configuration Manager перейдите в рабочую область **Администрирование** и выберите узел **Точки распространения**.

1. Выберите *локальную* точку распространения, а затем в ленте выберите команду **Свойства**.

1. В свойствах роли точки распространения на вкладке **Общие** настройте указанные ниже параметры.  

    1. Включение параметра **Включить использование этой точки распространения в качестве сервера подключенного кэша Майкрософт**.  

        Просмотрите и примите условия лицензии.

    2. **Используемый локальный диск**: выберите диск, который следует использовать для кэша. Значение по умолчанию — **Автоматически**, то есть используется диск с наибольшим объемом свободного пространства.<sup>[Примечание 1](#bkmk_note1)</sup>.  

        > [!Note]  
        > Вы можете изменить этот диск позже. Любое кэшированное содержимое теряется, если его не скопировать на новый диск.

    3. **Место на диске**: выберите размер резервируемого места на диске в ГБ или процентах от общего места на диске. По умолчанию это значение равно 100 ГБ.

        > [!Note]  
        > Размер кэша по умолчанию должен быть достаточным для большинства пользователей. Размер кэша можно изменить позже.
        >
        > Если размер кэша на диске превышает выделенное пространство, то ARR очищает пространство, удаляя содержимое на основе его встроенных эвристик.<!-- SCCMDocs#2045 -->

    4. **Сохранить кэш при отключении сервера подключенного кэша**: если этот параметр включен, при удалении сервера кэша содержимое кэша сохраняется на диске.  

1. В параметрах клиента в группе **Оптимизация доставки** настройте параметр **Включите для устройств под управлением Configuration Manager возможность скачивать содержимое с использованием серверов подключенного кэша Майкрософт**.  

### <a name="note-1-about-drive-selection"></a><a name="bkmk_note1"></a> Примечание 1. Сведения о выборе диска

Если выбрано значение **Автоматически**, то при установке компонента подключенного кэша в Configuration Manager будет учитываться файл **no_sms_on_drive.sms**. Например, в точке распространения есть файл `C:\no_sms_on_drive.sms`. Даже если на диске C: больше всего свободного места, Configuration Manager настраивает подключенный кэш для использования другого диска для кэша.

Если выбрать конкретный диск, который уже содержит файл **no_sms_on_drive.sms**, Configuration Manager игнорирует файл. Настройка использования этого диска для подключенного кэша будет явной. Например, в точке распространения есть файл `F:\no_sms_on_drive.sms`. При явной настройке свойств точки распространения для использования диска **F:** Configuration Manager настраивает в подключенном кэше использование диска F: для кэша.

Чтобы изменить диск после установки подключенного кэша, сделайте следующее:

- Вручную настройте свойства точки распространения для использования определенной буквы диска.

- Если задано значение автоматической настройки, создайте файл **no_sms_on_drive.sms**. Затем внесите изменения в свойства точки распространения, чтобы активировать изменение конфигурации.

### <a name="automation"></a>Автоматизация

<!-- SCCMDocs#1911 -->

С помощью пакета SDK для Configuration Manager можно автоматизировать настройку параметров Подключенного кэша (Майкрософт) в точке распространения. Как и в случае с ролями сайта, используйте [класс WMI SMS_SCI_SysResUse](../../../develop/reference/core/servers/configure/sms_sci_sysresuse-server-wmi-class.md). Дополнительные сведения см. в разделе [Программирование ролей сайта](../../../develop/osd/about-operating-system-deployment-site-role-configuration.md#programming-the-site-roles).

При обновлении экземпляра **SMS_SCI_SysResUse** для точки распространения задайте следующие свойства:

- **AgreeDOINCLicense**: задайте значение `1`, чтобы принять условия лицензионного соглашения.
- **Flags**: Включить — `|= 4`, отключить — `&= ~4`.
- **DiskSpaceDOINC**: задайте значение `Percentage` или `GB`.
- **RetainDOINCCache**: задайте значение `0` или `1`.
- **LocalDriveDOINC**: задайте значение `Automatic` либо конкретную букву диска, например `C:` или `D:`.

## <a name="verify"></a>Проверка

Когда клиенты скачивают облачное содержимое, они используют оптимизацию доставки посредством сервера кэша, установленного в точке распространения. К облачному относится следующее содержимое:

- приложения из Microsoft Store;
- компоненты Windows по требованию, например языки;
- если включены [политики Центра обновления Windows для бизнеса](../../../sum/deploy-use/integrate-windows-update-for-business-windows-10.md): обновления компонентов и исправления Windows 10;
- для [рабочих нагрузок совместного управления](../../../comanage/workloads.md):
  - Центр обновления Windows для бизнеса: обновления компонентов и исправления Windows 10;
  - приложения Office "нажми и работай": приложения Office и обновления для них;
  - клиентские приложения: приложения Microsoft Store и обновления для них;
  - Endpoint Protection обновления определений Защитника Windows.

В Windows 10 версии 1809 или более поздней выполните проверку с помощью командлета **Get-DeliveryOptimizationStatus** оболочки Windows PowerShell. В выходных данных командлета проверьте значение **BytesFromCacheServer**. Дополнительную информацию см. в разделе [Мониторинг оптимизации доставки](https://docs.microsoft.com/windows/deployment/update/waas-delivery-optimization-setup#monitor-delivery-optimization).

Если сервер кэша возвращает ошибки HTTP, клиент оптимизации доставки переключается на исходный облачный источник.

Подробные дополнительные сведения см. в разделе [Устранение неполадок с подключенным кэшем Майкрософт в Configuration Manager](../../servers/deploy/configure/troubleshoot-microsoft-connected-cache.md).

## <a name="support-for-intune-win32-apps"></a><a name="bkmk_intune"></a> Поддержка для приложений Win32 Intune

<!--5032900-->

Начиная с версии 1910 при включении подключенного кэша в точках распространения Configuration Manager они могут обслуживать приложения Win32 Microsoft Intune для совместно управляемых клиентов.

### <a name="prerequisites"></a>Предварительные условия

#### <a name="client"></a>Клиент

- Обновите клиент до последней версии.

- Клиентское устройство должно иметь не менее 4 ГБ памяти.

    > [!TIP]
    > Используйте следующий параметр групповой политики: "Конфигурация компьютера > Административные шаблоны > Компоненты Windows > Оптимизация доставки > **Минимальная емкость ОЗУ (включительно), требуемая, чтобы обеспечить использование однорангового кэширования (в ГБ)** ".

#### <a name="site"></a>Сайт

- Включите подключенный кэш в точке распространения. Дополнительные сведения см. в статье [Подключенный кэш Майкрософт](microsoft-connected-cache.md).

- Клиент и точка распространения с подключенным кэшем должны находиться в одной группе границ.

- Включите следующие параметры клиента в группе [**Оптимизация доставки**](../../clients/deploy/about-client-settings.md#delivery-optimization):

  - **Use Configuration Manager Boundary Groups for Delivery Optimization Group ID** (Использовать группы границ Configuration Manager для идентификатора группы оптимизации доставки)
  - **Enable devices managed by Configuration Manger to use Microsoft Connected Cache servers for content download** (Разрешить устройствам, управляемым Configuration Manager, использовать серверы подключенного кэша Майкрософт для скачивания содержимого)

- Включите функцию предварительной версии **Client apps for co-managed devices** (Клиентские приложения для совместно управляемых устройств). Дополнительные сведения см. в статье [Функции предварительной версии в Configuration Manager](../../servers/manage/pre-release-features.md).

- Включите совместное управление и переключите рабочую нагрузку **Клиентские приложения** на **Pilot Intune** (Пилотная версия Intune) или **Intune**. Дополнительные сведения см. в следующих статьях:

  - [Клиентские приложения](../../../comanage/workloads.md#client-apps)
  - [Включение совместного управления в Configuration Manager](../../../comanage/how-to-enable.md)
  - [Переключение рабочих нагрузок Configuration Manager на Intune](../../../comanage/how-to-switch-workloads.md)

    При использовании пилотной версии добавьте клиент в пилотную коллекцию для клиентских приложений.

#### <a name="intune"></a>Intune

- Эта функция поддерживает только тип приложения Intune Win32.

  - Поэтому необходимо создать и назначить (развернуть) новое приложение в Intune. (Приложения, созданные до использования Intune версии 1811, не работают.) Дополнительные сведения см. в статье [Изолированная среда Intune — управление приложениями Win32](https://docs.microsoft.com/intune/apps/apps-win32-app-management).

  - Размер приложения должен составлять не менее 100 МБ.
  
    > [!TIP]
    > Используйте следующий параметр групповой политики: "Конфигурация компьютера > Административные шаблоны > Компоненты Windows > Оптимизация доставки > **Минимальный размер файла содержимого однорангового кэширования (в МБ)** ".

## <a name="see-also"></a>См. также

[Оптимизация обновления Windows 10 с помощью функции оптимизации доставки](../../../sum/deploy-use/optimize-windows-10-update-delivery.md)

[Устранение неполадок с подключенным кэшем Майкрософт в Configuration Manager](../../servers/deploy/configure/troubleshoot-microsoft-connected-cache.md)
