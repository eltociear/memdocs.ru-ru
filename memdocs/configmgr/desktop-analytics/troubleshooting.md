---
title: Устранение проблем с Аналитикой компьютера
titleSuffix: Configuration Manager
description: Технические сведения, помогающие устранять проблемы с Аналитикой компьютеров.
ms.date: 04/01/2020
ms.prod: configuration-manager
ms.technology: configmgr-analytics
ms.topic: conceptual
ms.assetid: 63e08f3f-9558-4ed7-9bf3-3a185ddaac5c
author: aczechowski
ms.author: aaroncz
manager: dougeby
ms.openlocfilehash: 96e9f7523ae8946b7756a8a39d1757e652eb3c8c
ms.sourcegitcommit: bbf820c35414bf2cba356f30fe047c1a34c5384d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/21/2020
ms.locfileid: "81696902"
---
# <a name="troubleshoot-desktop-analytics"></a>Устранение проблем с Аналитикой компьютера

Используйте сведения в этой статье для устранения неполадок, связанных с Аналитикой компьютеров, интегрированной с Configuration Manager.

## <a name="confirm-prerequisites"></a>Проверка необходимых компонентов

Многие распространенные проблемы вызваны отсутствием необходимых компонентов. Сначала подтвердите следующие конфигурации:

- [Предварительные требования](overview.md#prerequisites)  

- [Обновления компонентов Windows](enroll-devices.md#update-devices).  

- [Как включить общий доступ к данным](enable-data-sharing.md), что включает следующие темы:  

  - Конечные точки Интернета, к которым должны подключаться клиенты.  

  - Проверка подлинности прокси-сервера.  

  - Уровни диагностических данных.  

## <a name="monitor-connection-health"></a>Мониторинг работоспособности подключения

Используйте панель мониторинга **Работоспособность подключения** в Configuration Manager, чтобы перейти к подробным сведениям о категориях по работоспособности устройств. В консоли Configuration Manager перейдите в рабочую область **Библиотека программного обеспечения**, разверните узел **Обслуживание Аналитики компьютеров** и выберите панель мониторинга **Работоспособность подключения**.  

Дополнительные сведения см. в разделе [Мониторинг работоспособности подключения](monitor-connection-health.md).

> [!NOTE]
> При подключении Configuration Manager к Аналитике компьютеров используется точка подключения службы. Любые изменения этой роли системы сайта могут повлиять на синхронизацию с облачной службой. Дополнительные сведения см. в статье [Точки подключения службы](../core/servers/deploy/configure/about-the-service-connection-point.md#bkmk_move).

Начиная с версии 2002, если серверу сайта Configuration Manager не удается подключиться к необходимым конечным точкам для облачной службы, создается сообщение о критическом состоянии с идентификатором 11488. Если ему не удается подключиться к службе, состояние компонента SMS_SERVICE_CONNECTOR изменяется на критическое. Более подробные сведения о состоянии см.в узле [Состояние компонента](../core/servers/manage/use-alerts-and-the-status-system.md#BKMK_MonitorSystemStatus) консоли Configuration Manager.<!-- 5566763 -->

## <a name="log-files"></a>Файлы журнала

Дополнительные сведения см. в разделе [Аналитика компьютеров](../core/plan-design/hierarchy/log-files.md#desktop-analytics).

Начиная с версии 1906 Configuration Manager, средство **DesktopAnalyticsLogsCollector.ps1** из каталога установки Configuration Manager позволяет устранить неполадки на портале "Аналитика компьютеров". Оно выполняет некоторые основные действия по устранению неполадок и собирает соответствующие данные журналов в одну рабочую папку. Дополнительные сведения см. в статье [Desktop Analytics log collector](log-collector.md) (Сборщик данных журналов Аналитики компьютеров).

### <a name="enable-verbose-logging"></a>Включить подробное ведение журнала

1. В точке подключения службы перейдите к следующему разделу реестра: `HKLM\Software\Microsoft\SMS\Tracing\SMS_SERVICE_CONNECTOR`  
2. Задайте для параметра **LoggingLevel** значение `0`  

## <a name="azure-ad-applications"></a><a name="bkmk_AzureADApps"></a> Приложения Azure AD

Аналитика компьютеров добавляет в Azure AD следующие приложения:

- **Микрослужба Configuration Manager**: подключает Configuration Manager с помощью Аналитики компьютеров. Это приложение не имеет требований к доступу.  

- **MALogAnalyticsReader**: Отслеживание рабочей области Azure Log Analytics для успешного ежедневного копирования моментального снимка. Дополнительные сведения см. в разделе о [роли приложения MALogAnalyticsReader](#bkmk_MALogAnalyticsReader).  

- **Администратор клиента Office 365**: позволяет Configuration Manager получать сведения о плане развертывания и состоянии готовности устройства из Аналитики компьютеров.

Если вам необходимо подготовить эти приложения к работе после установки, перейдите в область **Подключенные службы**. Выберите **Настройка доступа пользователей и приложений** и подготовьте приложения.  

- **Приложение Azure AD для Configuration Manager**. Сведения о подготовке или устранении проблем с подключением после установки см. в разделе о [создании и импорте приложений для Configuration Manager](#create-and-import-app-for-configuration-manager). Для этого приложения требуются разрешения **Запись данных коллекции CM** и **Чтение данных коллекции CM** в API **службы Configuration Manager**.  

### <a name="create-and-import-app-for-configuration-manager"></a>Создание и импорт приложения для Configuration Manager

Если вы не можете создать приложение Azure AD для Configuration Manager с помощью мастера настройки служб Azure или хотите повторно использовать имеющееся приложение, необходимо создать и импортировать его вручную. После [начального подключения](set-up.md#initial-onboarding) на портале Аналитики компьютеров сделайте следующее:

#### <a name="create-app-in-azure-ad"></a>Создание приложения в Azure AD

1. Откройте [портал Azure](https://portal.azure.com) в качестве пользователя с правами доступа *Глобальный администратор*, перейдите в **Azure Active Directory** и выберите **Регистрация приложений**. Затем выберите **Новая регистрация**.  

2. На панели **Создать** настройте следующие параметры:  

    - **Имя**: уникальное имя, идентифицирующее приложение, например: `Desktop-Analytics-Connection`  

    - **Поддерживаемые типы учетных записей**: **Accounts in this organizational directory only (Contoso)** (Учетные записи только в этом каталоге организации (Contoso)).

    - **URI перенаправления (необязательно)** : **Интернет**.  

    <!--     - **Sign-on URL**: this value isn't used by Configuration Manager, but required by Azure AD. Enter a unique and valid URL, for example: `https://configmgrapp`   -->
  
    Выберите **Зарегистрировать**.  

3. Выберите приложение, запишите **идентификатор приложения (клиента)** и **идентификатор каталога (клиента)** . Это идентификаторы GUID, которые используются для настройки подключения Configuration Manager.  

4. В меню **Управление** выберите **Certificates & secrets** (Сертификаты и секреты). Выберите **Новый секрет клиента**. Введите **описание**, укажите срок действия, а затем выберите **Добавить**. Скопируйте **значение** ключа, которое используется для настройки соединения Configuration Manager.

    > [!Important]  
    > Это единственная возможность скопировать значение ключа. Если вы не копируете его сейчас, вам понадобится создать еще один ключ.  
    >
    > Сохраните значение ключа в безопасном месте.  

5. В меню **Управление** выберите **Разрешения API**.  

    1. На панели **Разрешения API** выберите **Добавить разрешение**.  

    2. На панели **Запрос разрешений API** переключитесь на **Интерфейсы API, используемые моей организацией**.  

    3. Найдите и выберите API **микрослужбы Configuration Manager**.  

    4. Выберите группу **Разрешения приложения**. Разверните **CmCollectionData** и выберите оба следующих разрешения: **Write CM Collection Data** (Запись данных коллекции CM) и **Read CM Collection Data** (Чтение данных коллекции CM).  

    5. Выберите **Добавить разрешения**.  

6. На панели **Разрешения API** выберите **Grant admin consent...** (Предоставить согласие администратора...). Выберите **Да**.  

#### <a name="import-app-in-configuration-manager"></a>Импорт приложений в Configuration Manager

1. В консоли Configuration Manager перейдите в рабочую область **Администрирование**, разверните узел **Облачные службы** и выберите узел **Службы Azure**. Выберите **Настройка служб Azure** на ленте.  

2. На странице **Службы Azure** мастера служб Azure настройте приведенные ниже параметры.  

    - Укажите **Имя** объекта в Configuration Manager.  

    - При желании укажите **Описание**, которое поможет идентифицировать службу.  

    - Выберите **Аналитика компьютеров** из списка доступных служб.  
  
   Выберите **Далее**.  

3. На странице **Приложение** выберите соответствующую **среду Azure**. Затем выберите **Импортировать** для веб-приложения. Настройте следующие параметры в окне **Импорт приложений**:  

    - **Имя клиента Azure AD**: это имя используется в Configuration Manager.  

    - **Идентификатор клиента Azure AD**: **идентификатор каталога**, скопированный с Azure AD.  

    - **Идентификатор клиента**. **Идентификатор приложения**, скопированный из приложения Azure AD.  

    - **Секретный ключ**: **значение** ключа, скопированное из приложения Azure AD.  

    - **Срок действия секретного ключа**: та же дата истечения срока действия ключа.  

    - **Универсальный код ресурса идентификатора приложения**: этот параметр должен автоматически заполняться следующим значением: `https://cmmicrosvc.manage.microsoft.com/`  
  
   Выберите **Проверить**, а затем нажмите кнопку **ОК**, чтобы закрыть окно импорта приложений. На странице приложение мастера служб Azure выберите **Далее**.  

Чтобы продолжить работу мастера на странице **диагностических данных**, ознакомьтесь с разделом о [подключении к службе](connect-configmgr.md#bkmk_connect).

#### <a name="troubleshoot-app-in-configuration-manager"></a>Устранение неполадок приложения в Configuration Manager

Если возникли проблемы при создании или импорте приложения, сначала проверьте **SMSAdminUI.log** для выявления конкретной ошибки. Затем проверьте следующие конфигурации:

- Вы успешно зарегистрировали клиент в службе Аналитики компьютеров. Дополнительные сведения см. в статье [Настройка Аналитики компьютеров](set-up.md).

- Все необходимые конечные точки доступны. Дополнительные сведения см. в разделе о [конечных точках](enable-data-sharing.md#endpoints).

- Убедитесь, что пользователь, выполнивший вход, имеет правильные разрешения. Дополнительные сведения см. в разделе [Необходимые условия](overview.md#prerequisites).

- Убедитесь, что пользователь может войти в Azure. При этом определяется, есть ли какие-либо общие проблемы с проверкой подлинности Azure AD.

- Проверьте сообщения о состоянии для компонента **SMS_SERVICE_CONNECTOR** в отношении *рабочей роли Аналитики компьютеров*.

### <a name="maloganalyticsreader-application-role"></a><a name="bkmk_MALogAnalyticsReader"></a> Роль приложения MALogAnalyticsReader

При настройке Аналитики компьютеров вы даете согласие от имени организации. Это согласие заключается в назначении приложению MALogAnalyticsReader роли читателя Log Analytics для рабочей области. Эта роль приложения необходима для Аналитики компьютеров.

Если во время установки возникла проблема с этим процессом, используйте следующую процедуру, чтобы вручную добавить это разрешение:

1. Перейдите на [портал Azure](https://portal.azure.com) и выберите **Все ресурсы**. Выберите рабочую область типа **Log Analytics**.  

2. В меню рабочей области выберите **Управление доступом (IAM)** , а затем **Добавить**.  

3. На панели **Добавить разрешения** настройте следующие параметры:  

    - **Роль**: **Читатель**  

    - **Назначение доступа к**: **Пользователь, группа или приложение Azure AD**  

    - **Выбор**: **MALogAnalyticsReader**  

4. Нажмите кнопку **Сохранить**.

На портале отобразится уведомление о добавлении назначения ролей.

## <a name="data-latency"></a>Задержка данных

<!-- 3846531 -->
При первой настройке Аналитики компьютеров, регистрации новых клиентов или настройке новых планов развертывания отчеты в Configuration Manager и на портале Аналитики компьютеров могут не показывать полные данные сразу. Выполнение следующих шагов может занять 2–3 дня:

- Активные устройства отправляют диагностические данные в службу Аналитики компьютеров.
- Служба обрабатывает данные.
- Служба синхронизируется с сайтом Configuration Manager.

При синхронизации коллекций устройств из иерархии Configuration Manager с Аналитикой компьютеров эти коллекции могут появиться на портале Аналитики компьютеров в течение часа. Аналогичным образом при создании плана развертывания в Аналитике компьютеров новые коллекции, связанные с планом развертывания, могут появиться в иерархии Configuration Manager в течение часа. На первичных сайтах создаются коллекции, а сайт центра администрирования синхронизируется с Аналитикой компьютеров. Configuration Manager может понадобиться до 24 часов, чтобы оценить и обновить членство в коллекции. Чтобы ускорить этот процесс, обновите членство в коллекции вручную.<!-- 4984639 -->

> [!Note]
> Чтобы в обновлениях коллекции, выполняемых вручную, отражались изменения, компонент SMS_SERVICE_CONNECTOR_M365ADeploymentPlanWorker сначала необходимо синхронизировать. Выполнение этого процесса может занять до одного часа. Дополнительные сведения см. в разделе о **M365ADeploymentPlanWorker.log**.

Существует два типа данных на портале Аналитики компьютеров: **данные администратора** и **диагностические данные**.

- **Данные администратора** относятся к любым изменениям, которые вы вносите в конфигурацию своего рабочего пространства. Например, при изменении **решения по обновлению** ресурса или **важности** вы изменяете данные администратора. Эти изменения часто являются накопительными, так как они могут изменить состояние готовности устройства из-за установки требуемого ресурса.

- **Диагностические данные** относятся к системным метаданным, отправленным с клиентских устройств в корпорацию Майкрософт. Эти данные используются в Аналитике компьютеров. Они включают такие атрибуты, как инвентаризация устройств, а также состояние безопасности и обновления компонентов.

По умолчанию все данные на портале Аналитики компьютеров автоматически обновляются ежедневно. Это обновление включает изменения в диагностических данных и любые изменения, внесенные в конфигурацию (данные администратора). Они должны отображаться на портале Аналитики компьютеров в 08:00 (время в формате UTC) каждый день.

При внесении изменений в данные администратора можно активировать обновление данных администратора в рабочей области по требованию. На портале Аналитики компьютеров откройте всплывающий элемент актуальности данных:

![Снимок экрана: вкладка с всплывающим элементом актуальности данных на портале Аналитики компьютеров](media/data-currency-flyout.png)

Затем выберите **Применить изменения**:

![Снимок экрана: расширенный всплывающий элемент актуальности данных на портале Аналитики компьютеров](media/data-currency-flyout-expand.png)

Обычно этот процесс занимает 15–60 минут. Время зависит от размера рабочей области и объема изменений, требующих выполнения процессов. При запросе обновления данных по требованию диагностические данные не изменяются.  Дополнительные сведения см. в разделе [Можно ли сократить время, затрачиваемое на обновление данных на портале Аналитики компьютеров?](faq.md#can-i-reduce-the-amount-of-time-it-takes-for-data-to-refresh-in-my-desktop-analytics-portal).

Если вы не видите изменения, внесенные в указанные выше интервалы времени, подождите около 24 часов до следующего ежедневного обновления. Если задержки больше, проверьте панель мониторинга работоспособности служб. Если служба работоспособна, обратитесь в службу поддержки Майкрософт.<!-- 3896921 -->
