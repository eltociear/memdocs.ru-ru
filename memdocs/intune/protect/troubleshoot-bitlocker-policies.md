---
title: Советы по устранению неполадок с политиками BitLocker в Microsoft Intune
titleSuffix: Microsoft Intune
description: Описание включения шифрования BitLocker на устройстве с помощью политики Intune и порядка проверки успешного развертывания политики на устройстве.
author: brenduns
ms.author: brenduns
manager: dougeby
ms.date: 01/29/2020
ms.topic: troubleshooting
ms.service: microsoft-intune
ms.subservice: protect
ms.localizationpriority: medium
ms.technology: ''
ms.assetid: ''
ms.suite: ems
search.appverid: MET150
ms.custom: intune-azure
ms.collection: M365-identity-device-management
ms.openlocfilehash: ac6650f06abddd2633e73f39a6bf72d54e344a61
ms.sourcegitcommit: 1442a4717ca362d38101785851cd45b2687b64e5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2020
ms.locfileid: "82079201"
---
# <a name="troubleshoot-bitlocker-policies-in-microsoft-intune"></a>Устранение неполадок с политиками BitLocker в Microsoft Intune

В данной статье содержатся сведения, которые помогут администраторам Intune понять, как устройства Windows 10 настраивают BitLocker на основе политики Intune. В этой статье также приводятся рекомендации по устранению проблем с настройкой BitLocker на устройствах, управляемых с помощью Intune.  

## <a name="understanding-bitlocker"></a>Основные сведения о BitLocker

Шифрование диска BitLocker — это служба в операционных системах Microsoft Windows, которая позволяет пользователям шифровать данные на жестких дисках. BitLocker поддерживает шифрование дисков операционной системы, съемных носителей и несъемных дисков с данными. BitLocker также поддерживает использование 256-разрядного шифрования для лучшей защиты конфиденциальных данных.  

Ниже перечислены способы, с помощью которых Microsoft Intune можно использовать для управления BitLocker на устройствах под управлением ОС Windows 10.

- **Политики конфигурации устройств** — при создании профиля конфигурации устройства для управления защитой конечных точек доступны некоторые встроенные параметры политики Intune. Чтобы перейти к этим параметрам, [создайте профиль устройства для защиты конечных точек](endpoint-protection-configure.md#create-a-device-profile-containing-endpoint-protection-settings), выберите **Windows 10 и более поздней версии** для параметра *Платформа*, а затем выберите категорию **Шифрование Windows** в разделе *Настройки*. 

   Дополнительные сведения о доступных параметрах и функциях см. в этом разделе: [Windows Encryption](https://docs.microsoft.com/intune/endpoint-protection-windows-10#windows-encryption) (Шифрование Windows).

- **Базовые конфигурации безопасности**. - [Базовые конфигурации безопасности](security-baselines.md) — это известные группы параметров и значений по умолчанию, рекомендуемые специалистами по вопросам безопасности, которые помогают защитить устройства Windows. Различные базовые источники, такие как *Базовая конфигурация безопасности MDM* или *Базовые показатели ATP в Защитнике Windows*, могут управлять теми же параметрами, а также другими. С их помощью также можно управлять теми параметрами, для управления которыми используются политики конфигурации устройств. 

Помимо Intune, для оборудования, совместимого с Modern Standby (текущим режимом ожидания) и HSTI, при использовании любой из этих функций шифрование устройства BitLocker автоматически включается при присоединении каждого устройства к Azure AD. Azure AD предоставляет портал, в котором также создается резервная копия ключей восстановления, поэтому при необходимости пользователи могут получить собственные ключи восстановления для самообслуживания.

Для управления параметрами BitLocker также можно применять и другие способы, например использовать групповую политику или настройку устройства вручную его пользователем.

Независимо от того, каким образом параметры применяются к устройству, для настройки шифрования на устройстве политики BitLocker используют [BitLocker CSP](https://docs.microsoft.com/windows/client-management/mdm/bitlocker-csp). Поставщик служб шифрования BitLocker CSP встроен в Windows, и когда Intune развертывает политику BitLocker на назначенном устройстве, BitLocker CSP на устройстве записывает соответствующие значения в реестр Windows, чтобы параметры политики вступили в силу.

Подробнее о BitLocker см. в следующих ресурсах:

- [BitLocker](https://docs.microsoft.com/windows/security/information-protection/bitlocker/bitlocker-overview)
- [Общие сведения о BitLocker и часто задаваемые вопросы о требованиях](https://docs.microsoft.com/windows/security/information-protection/bitlocker/bitlocker-overview-and-requirements-faq)

Теперь, когда у вас есть общее понимание того, что делают эти политики и как они работают, ознакомьтесь с примером того, как можно проверить, успешно ли параметры BitLocker применены к клиенту Windows.

## <a name="verify-the-source-of-bitlocker-settings"></a>Проверка источника параметров BitLocker

При исследовании проблемы BitLocker на устройстве под управлением ОС Windows 10 важно сначала определить, связана ли эта ошибка с Intune или Windows. После того как вероятный источник ошибки будет известен, можно сосредоточиться на действиях по устранению неполадок в требуемом месте,а также, если необходимо, получить поддержку от соответствующих специалистов.  

Для начала определите, успешно ли развернута политика Intune на целевом устройстве. В следующем примере имеется политика конфигурации устройства, которая развертывает параметры шифрования Windows (BitLocker), как показано ниже.

![Политика конфигурации устройств "Шифрование Windows" с параметрами](./media/troubleshooting-bitlocker-policies/settings.png)

Как проверить, применены ли параметры на целевом устройстве? Ниже приведено несколько способов сделать это.

### <a name="device-configuration-policy-device-status"></a>Состояние устройства политики конфигурации устройств  

Если для настройки BitLocker используется политика конфигурации устройств, можно проверить состояние политики на портале Intune.

1. Войдите в [Центр администрирования Microsoft Endpoint Manager](https://go.microsoft.com/fwlink/?linkid=2109431).

2. Выберите **Устройства** > **Профили конфигурации**, а затем профиль, содержащий параметры BitLocker.

3. Выбрав профиль, который нужно просмотреть, выберите **Состояние устройства**. В списке отображаются устройства, назначенные профилю, а в столбце *Состояние устройства* указывается, успешно ли развернут профиль на устройстве.

Обратите внимание, что получение политики BitLocker устройством может осуществляться с задержкой, а диск полностью зашифрован.  

### <a name="use-control-panel-on-the-client"></a>Использование панели управления на клиенте  

На устройстве, где включены BitLocker и шифрование диска, просмотреть состояние BitLocker можно с помощью панели управления. На устройстве выберите **Панель управления** > **Система и безопасность** > **Шифрование диска BitLocker**. Отобразится подтверждение, как показано ниже.  

![BitLocker включен в панели управления](./media/troubleshooting-bitlocker-policies/control-panel.png)

### <a name="use-a-command-prompt"></a>С использованием командной строки  

На устройстве, где включены BitLocker и шифрование диска, запустите командную строку от имени администратора, а затем выполните команду `manage-bde -status`. Результат должен быть примерно таким:  
![Результат выполнения команды status](./media/troubleshooting-bitlocker-policies/command.png)

В данном примере:

- **Защита BitLocker** — **Включено**
- **Зашифровано (процентов)**  — **100 %**
- **Метод шифрования** — **XTS-AES 256**

Также можно проверить **предохранители ключа**, выполнив следующую команду:

```cmd
Manage-bde -protectors -get c:
```

Или с помощью PowerShell:

```powershell
Confirm-SecureBootUEFI
```

### <a name="review-the-devices-registry-key-configuration"></a>Проверка конфигурации раздела реестра на устройстве

После успешного развертывания политики BitLocker на устройстве перейдите в следующий раздел реестра, где можно просмотреть конфигурацию параметров BitLocker:  *HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\PolicyManager\current\device\BitLocker*. Пример:

![Раздел реестра BitLocker](./media/troubleshooting-bitlocker-policies/registry.png)

Для настройки этих значений используется BitLocker CSP. Убедитесь, что значения параметров соответствуют параметрам, указанным в источнике политики шифрования Windows Intune. Дополнительные сведения о каждом из этих параметров см. в разделе [BitLocker CSP](https://docs.microsoft.com/windows/client-management/mdm/bitlocker-csp).

> [!NOTE]
> В средстве просмотра событий Windows также будут содержаться различные сведения, связанные с BitLocker. Параметров достаточно много для перечисления, поэтому рекомендуется воспользоваться поиском по запросу **API BitLocker**.

### <a name="check-the-mdm-diagnostics-report"></a>Просмотр диагностического отчета MDM

На устройстве, на котором включен BitLocker, можно создать и просмотреть диагностический отчет MDM о целевом устройстве. Сведения в нем позволяют убедиться в наличии политики BitLocker. Если в отчете имеются сведения о параметрах политики, это служит еще одним доказательством того, что политика успешно развернута. В видеоролике *Майкрософт* по этой ссылке показано, как записать диагностический отчет MDM с устройства Windows.

> [!VIDEO https://www.youtube.com/embed/WKxlcjV4TNE]

При анализе диагностического отчета MDM его содержимое может показаться немного запутанным. Ниже приведен пример, в котором показано, как сопоставить содержимое отчета с параметрами политики.

![Пример диагностического отчета MDM](./media/troubleshooting-bitlocker-policies/report.png)

В результатах вывода отображаются значения, соответствующие значениям из политики BitLocker:

![Результат вывода со значениями ](./media/troubleshooting-bitlocker-policies/output.png)

Результаты диагностики MDM:

```asciidoc
EncryptionMethodWithXtsOsDropDown: 7 (The value 7 refers to the 256 bit encryption)
EncryptionMethodWithXtsFdvDropDown: 6 (The value 6 refers to the 128 bit encryption)
EncryptionMethodWithXtsRdvDropDown: 6 (The value 6 refers to the 128 bit encryption)
```

Чтобы узнать, что означает каждое значение, обратитесь к [документации по BitLocker CSP](https://docs.microsoft.com/windows/client-management/mdm/bitlocker-csp). В этом примере фрагмент кода выше относится к следующему рисунку.

![Назначение значений](./media/troubleshooting-bitlocker-policies/shared-example.png)

Аналогичным образом можно просмотреть все значения и проверить их с помощью ссылки BitLocker CSP.

> [!TIP]
> Основной целью диагностического отчета MDM является помощь специалистам службы поддержки Майкрософт в устранении неполадок. Если создать обращение в службу поддержки Intune, а проблема касается клиентов Windows, всегда рекомендуется предоставить этот отчет и вложить его в обращение.

## <a name="troubleshooting-bitlocker-policy"></a>Устранение неполадок политики BitLocker

Теперь у вас должно сложиться представление о том, как убедиться, что политика BitLocker успешно развернута с помощью службы Intune, которая передает конфигурацию BitLocker в BitLocker CSP в WIndows.

**Не удается передать политику на устройство** — если политика Intune отсутствует в емкости:

- **Правильно ли устройство зарегистрировано в Microsoft Intune?** Если нет, решите эту проблему, прежде чем устранять неполадки, связанные с политикой. Справочные сведения по устранению неполадок, связанных с регистрацией Windows, представлены [здесь](../enrollment/troubleshoot-windows-enrollment-errors.md).

- **Нормально ли на устройстве работает сетевое подключение?** Если устройство выключено, находится в режиме "в самолете" или подключение к сети недоступно, политика не будет применена до восстановления сетевого подключения.

- **Была ли политика BitLocker развернута для требуемой группы пользователей или устройств?** Убедитесь, что пользователь или устройство входят в целевую группу.

**Политика установлена, но не все параметры настроены** — если политика Intune достигает устройства, однако применить удается не все конфигурации:

- **Завершилось ли сбоем развертывание всей политики или не удалось применить только некоторые параметры?** Если вы столкнулись с ситуацией, когда не удалось применить только некоторые параметры политики, ознакомьтесь со следующими пунктами.

  1. **Не все параметры BitLocker поддерживаются во всех версиях Windows**.
     Политика поступает на устройство как единое целое, поэтому, если некоторые параметры применяются, а другие нет, можете быть уверены, что сама политика получена. В этом случае вполне вероятно, что версия Windows, установленная на устройстве, не поддерживает проблемные параметры. Дополнительные сведения о требованиях к версии для каждого параметра см. в разделе [BitLocker CSP](https://docs.microsoft.com/windows/client-management/mdm/bitlocker-csp) документации Windows.

  2. **BitLocker не поддерживается всем оборудованием**.
     Даже если у вас установлена правильная версия Windows, возможно, оборудование устройства не соответствует требованиям к шифрованию BitLocker. [Системные требования для BitLocker](https://docs.microsoft.com/windows/security/information-protection/bitlocker/bitlocker-overview#system-requirements) представлены в документации Windows, однако сначала следует убедиться в том, что устройство имеет совместимую микросхему TPM (1.2 или более поздней версии) и встроенное ПО или BIOS, соответствующие требованиям Trusted Computing Group (TCG).
     
**Шифрование BitLocker не выполняется автоматически**. В политике Endpoint Protection для параметра "Предупреждение при шифровании других дисков" вы настроили блокировку, но мастер шифрования по-прежнему отображается:

- **Убедитесь, что версия Windows поддерживает автоматическое шифрование** Для этого требуется версия не ранее 1803. Если пользователь не является администратором на устройстве, требуется версия не ранее 1809. В версии 1809 введена поддержка устройств, которые не поддерживают текущий режим ожидания.

**Устройство, зашифрованное с помощью BitLocker, отображается как несоответствующее для политик соответствия Intune**. Эта проблема возникает, если шифрование BitLocker не завершено. В зависимости от таких факторов, как размер диска, количество файлов и параметры BitLocker, шифрование BitLocker может занимать много времени. После завершения шифрования устройство будет учитываться как соответствующее. Кроме того, сразу после установки обновлений Windows устройства могут стать временно несоответствующими.

**Устройства шифруются с использованием 128-разрядного алгоритма, но для политики используется 256-разрядный**. По умолчанию Windows 10 шифрует диск с использованием 128-разрядного алгоритма XTS-AES. В этом руководстве приведены сведения о [настройке 256-разрядного шифрования для BitLocker во время сборки Autopilot](https://techcommunity.microsoft.com/t5/intune-customer-success/setting-256-bit-encryption-for-bitlocker-during-autopilot-with/ba-p/323791#).


**Пример анализа**

- Вы развертываете политику BitLocker на устройстве Windows 10, а для параметра **Шифрование устройств** на портале отображается состояние **Ошибка**.

- Как видно из названия, этот параметр позволяет администратору требовать включения шифрования с помощью параметра *BitLocker > Шифрование устройств*. Руководствуясь советами по устранению неполадок выше, сначала необходимо обратиться к диагностическому отчету MDM. Сведения в отчете подтверждают, что на устройстве была развернута правильная политика:

  ![Сведения в отчете, подтверждающие, что на устройстве развернута правильная политика](./media/troubleshooting-bitlocker-policies/mdm-report.png)

- Успешное развертывание политики также можно проверить в реестре:

  ![Для параметра RequiredDeviceEncryption указано значение 1](./media/troubleshooting-bitlocker-policies/registry-confirm.png)

- Затем вы проверяете состояние TPM с помощью PowerShell и обнаруживаете, что на устройстве недоступен TPM:

  ![Состояние проверенного TPM с помощью PowerShell](./media/troubleshooting-bitlocker-policies/tpm-command.png)

- Поскольку BitLocker полагается на TPM, можно сделать вывод, что причиной сбоя BitLocker является не проблема с Intune или политикой, а то, что само устройство не оснащено микросхемой TPM или модуль TPM отключен в BIOS.

  Чтобы убедиться в этом, можно обратиться к средству просмотра событий Windows в разделе **Журналы приложений и служб** > **Microsoft** > **Windows** > **API BitLocker**. В журнале событий **API BitLocker** вы найдете событие с идентификатором 853, которое означает, что TPM недоступен:

  ![Событие с идентификатором 853](./media/troubleshooting-bitlocker-policies/event-error.png)

  > [!NOTE]
  > Для проверки состояния TPM также можно выполнить на устройстве команду **tpm.msc**.

## <a name="summary"></a>Сводка

При устранении неполадок политики BitLocker в Intune и подтверждении того, что политика передана на требуемое устройство, можно считать, что проблема не связана напрямую с Intune. Скорее всего, проблема связана с операционной системой Windows или оборудованием устройства. В этом случае рекомендуется начать поиск проблемы в других областях, таких как конфигурация TPM или UEFI и безопасная загрузка.

## <a name="next-steps"></a>Дальнейшие шаги  

Ниже приведены дополнительные ресурсы, которые могут помочь при работе с BitLocker.

- [Документация по BitLocker](https://docs.microsoft.com/windows/security/information-protection/bitlocker/bitlocker-overview)
- [Требования к системе для BitLocker](https://docs.microsoft.com/windows/security/information-protection/bitlocker/bitlocker-overview#system-requirements)
- [Часто задаваемые вопросы о BitLocker](https://docs.microsoft.com/windows/security/information-protection/bitlocker/bitlocker-frequently-asked-questions)
- [Документация по BitLocker CSP](https://docs.microsoft.com/windows/client-management/mdm/bitlocker-csp)
- [Параметры политики шифрования Windows Intune](https://docs.microsoft.com/intune/endpoint-protection-windows-10#windows-encryption)
- [Аппаратно-независимое шифрование BitLocker с помощью AAD/MDM](https://blogs.technet.microsoft.com/home_is_where_i_lay_my_head/2017/06/07/hardware-independent-automatic-bitlocker-encryption-using-aadmdm/)
- [Политика CSP для шифрования BitLocker на устройствах с автопилотом](https://techcommunity.microsoft.com/t5/Windows-10-security/CSP-policy-for-bitLocker-encryption-on-autopilot-devices/m-p/284537)
- [Пошаговое руководство по созданию и развертыванию политики BitLocker с помощью Intune](https://blogs.technet.microsoft.com/cbernier/2017/07/11/windows-10-intune-windows-bitlocker-management-yes/)
