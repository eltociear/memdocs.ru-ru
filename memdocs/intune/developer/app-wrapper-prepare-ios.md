---
title: Создание программы-оболочки Intune для приложений iOS с помощью соответствующего инструмента
description: Узнайте, как создать программу-оболочку для приложений iOS, не меняя код самого приложения, а также подготовить приложения для применения политики управления мобильными приложениями.
keywords: ''
author: Erikre
ms.author: erikre
manager: dougeby
ms.date: 05/27/2020
ms.topic: reference
ms.service: microsoft-intune
ms.subservice: developer
ms.localizationpriority: medium
ms.technology: ''
ms.assetid: 99ab0369-5115-4dc8-83ea-db7239b0de97
ms.reviewer: aanavath
ms.suite: ems
search.appverid: MET150
ms.custom: intune-classic
ms.collection: M365-identity-device-management
ms.openlocfilehash: 424778a86ebf3bac750e17359204ef6be3aaa71c
ms.sourcegitcommit: 118587ddb31ce26b27801839db9b3b59f1177f0f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/29/2020
ms.locfileid: "84166048"
---
# <a name="prepare-ios-apps-for-app-protection-policies-with-the-intune-app-wrapping-tool"></a>Подготовка приложений iOS для применения политик защиты приложений с помощью инструмента упаковки приложений

Инструмент упаковки приложений Microsoft Intune для iOS позволяет применять политики защиты приложений для приложений iOS, используемых внутри организации, не изменяя при этом код самого приложения.

Инструмент является приложением командной строки Mac OS, которое создает "оболочку" вокруг приложения. После обработки приложения можно изменить его функциональность, развернув на нем [политики защиты приложений](../apps/app-protection-policies.md).

Чтобы скачать этот инструмент, см. статью [Microsoft Intune App Wrapping Tool for iOS](https://github.com/msintuneappsdk/intune-app-wrapping-tool-ios) (Инструмент упаковки приложений Microsoft Intune для iOS) в GitHub.

## <a name="general-prerequisites-for-the-app-wrapping-tool"></a>Общие предварительные требования для использования инструмента упаковки приложений

Перед запуском инструмента упаковки приложений нужно выполнить некоторые общие предварительные требования:

* Скачайте [инструмент упаковки приложений Microsoft Intune для iOS](https://github.com/msintuneappsdk/intune-app-wrapping-tool-ios) из GitHub.

* Используйте компьютер под управлением OS X 10.8.5 или более поздней версии с установленным набором инструментов Xcode версии 9 или более поздней.

* Входное приложение iOS должно быть разработано и подписано специалистами вашей компании или независимым поставщиком программного обеспечения (ISV).

  * Файл входного приложения должен иметь расширение **IPA** или **APP**.

  * Входное приложение должно быть скомпилировано для использования в iOS 11 или более поздней версии.

  * Входное приложение не может быть зашифровано.

  * Входное приложение не может иметь расширенные атрибуты файла.

  * Перед обработкой инструментом упаковки Intune для входного приложения нужно задать права. Эти [права](https://developer.apple.com/library/content/documentation/Miscellaneous/Reference/EntitlementKeyReference/Chapters/AboutEntitlements.html) предоставляют приложению дополнительные разрешения и возможности, отсутствующие в приложении по умолчанию. Инструкции см. в статье [Установка прав приложения](#setting-app-entitlements).

## <a name="apple-developer-prerequisites-for-the-app-wrapping-tool"></a>Предварительные требований к разработчику Apple для использования инструмента упаковки приложений

Чтобы распределить упакованные приложения эксклюзивно среди пользователей организации, вам нужно использовать учетную запись, участвующую в программе [Apple Developer Enterprise Program](https://developer.apple.com/programs/enterprise/), и несколько сущностей для подписывания приложений, связанных с вашей учетной записью разработчика Apple.

Для получения дополнительных сведений о распространении приложений iOS пользователям внутри организации см. официальное руководство по [распространению приложений в рамках программы Apple Developer Enterprise Program](https://developer.apple.com/library/content/documentation/IDEs/Conceptual/AppDistributionGuide/DistributingEnterpriseProgramApps/DistributingEnterpriseProgramApps.html#//apple_ref/doc/uid/TP40012582-CH33-SW1).

Для распространения приложений, упакованных Intune, вам потребуется следующее:

* Учетная запись, участвующая в программе Apple Developer Enterprise Program.

* Специальный сертификат для подписи распространения, используемый внутри организации и имеющий допустимый идентификатор группы.

  * В качестве параметра для инструмента упаковки приложений потребуется хэш SHA1 сертификата для подписи.


* Профиль подготовки распространения внутри организации.

### <a name="steps-to-create-an-apple-developer-enterprise-account"></a>Шаги по созданию учетной записи Apple Developer Enterprise

1. Перейдите на [сайт программы Apple Developer Enterprise Program](https://developer.apple.com/programs/enterprise/).

2. Щелкните **Enroll** (Регистрация) в верхней правой части страницы.

3. Ознакомьтесь с контрольным списком того, что нужно для регистрации. Щелкните **Start Your Enrollment** (Начать регистрацию) в нижней части страницы.

4. **Войдите**, используя идентификатор Apple ID своей организации. Если у вас его нет, щелкните **Create Apple ID** (Создать идентификатор Apple ID).

5. Выберите **Entity Type** (Тип сущности) и нажмите кнопку **Continue** (Продолжить).

6. Внесите сведения об организации в форму. Нажмите кнопку **Continue**(Продолжить). На этом этапе компания Apple свяжется с вами, чтобы убедиться, что вы имеете право зарегистрировать свою организацию.

7. По завершении проверки нажмите кнопку **Agree to License** (Принять условия лицензии).

8. После принятия условий лицензии завершите процедуру, **приобретя и активировав программу**.

9. Если вы являетесь агентом группы (тем, кто присоединяется к программе Apple Developer Enterprise Program от имени вашей организации), сначала сформируйте группу, пригласив участников и назначив роли. Чтобы научиться управлять группой, ознакомьтесь с документацией Apple на странице [Managing Your Developer Account Team](https://developer.apple.com/library/content/documentation/IDEs/Conceptual/AppDistributionGuide/ManagingYourTeam/ManagingYourTeam.html#//apple_ref/doc/uid/TP40012582-CH16-SW1) (Управление рабочей группой разработчика).

### <a name="steps-to-create-an-apple-signing-certificate"></a>Шаги по созданию сертификата для подписи Apple

1. Перейдите на [портал разработчиков Apple](https://developer.apple.com/).

2. Щелкните **Account** (Учетная запись) в верхней правой части страницы.

3. **Войдите**, используя идентификатор Apple ID своей организации.

4. Щелкните **Certificates, IDs & Profiles** (Сертификаты, идентификаторы и профили).

   ![Портал разработчиков Apple — сертификаты, идентификаторы и профили](./media/app-wrapper-prepare-ios/iOS-signing-cert-1.png)

5. Нажмите кнопку !["плюс" на портале разработчиков Apple](./media/app-wrapper-prepare-ios/iOS-signing-cert-2.png) в верхнем правом углу, чтобы добавить сертификат iOS.

6. Выберите создание сертификата **In-House and Ad Hoc** (Специальный внутренний) в группе **Production** (Рабочая).

   ![Выбор специального внутреннего сертификата](./media/app-wrapper-prepare-ios/iOS-signing-cert-3.png)

   >[!NOTE]
   >Если вы не планируете распространять приложение, а хотите использовать его только для внутреннего тестирования, вместо рабочего сертификата вы можете воспользоваться сертификатом разработки приложений iOS. При использовании сертификата разработки убедитесь, что профиль подготовки мобильных приложений ссылается на устройства, на которых будет установлено приложение.

7. Нажмите кнопку **Далее** в нижней части страницы.

8. Ознакомьтесь с инструкциями по созданию **запроса подписи сертификата (CSR)** с помощью приложения Keychain Access на компьютере macOS.

   ![Инструкции по созданию CSR](./media/app-wrapper-prepare-ios/iOS-signing-cert-4.png)

9. Выполните приведенные выше инструкции, чтобы создать запрос подписи сертификата. Запустите приложение **Keychain Access** на своем компьютере macOS.

10. В меню macOS, расположенном в верхней части экрана, выберите к **Keychain Access > Certificate Assistant (Помощник по сертификатам) > Request a Certificate From a Certificate Authority (Запросить сертификат из ЦС)** .  

    ![Запрос сертификата из ЦС в Keychain Access](./media/app-wrapper-prepare-ios/iOS-signing-cert-5.png)

11. Следуйте указанным выше инструкциям на сайте разработчиков Apple для создания CSR-файла. Сохраните этот файл на компьютере macOS.

    ![Ввод данных для сертификата, который запрашивается](./media/app-wrapper-prepare-ios/iOS-signing-cert-6.png)

12. Вернитесь на сайт разработчиков Apple. Нажмите кнопку **Continue**(Продолжить). Отправьте CSR-файл.

13. Apple создает ваш сертификат для подписи. Скачайте его и сохраните на компьютере macOS, запомнив это расположение.

    ![Скачивание сертификата для подписи](./media/app-wrapper-prepare-ios/iOS-signing-cert-7.png)

14. Дважды щелкните скачанный файл сертификата, чтобы добавить сертификат в цепочку ключей.

15. Откройте приложение **Keychain Access** еще раз. Найдите сертификат, используя поиск по имени в панели поиска справа вверху. Щелкните правой кнопкой мыши элемент, чтобы открыть меню, и выберите пункт **Get Info** (Получить сведения). На экранах в примере вместо рабочего сертификата используется сертификат разработки.

    ![Добавление сертификата цепочке ключей](./media/app-wrapper-prepare-ios/iOS-signing-cert-8.png)

16. Появляется информационное сообщение. Прокрутите его вниз и найдите метку **Fingerprints** (Отпечатки пальцев). Скопируйте строку **SHA1** (размыта) для использования в качестве аргумента параметра "-c" для инструмента упаковки приложений.

    ![Сведения об iPhone — строка отпечатков пальцев SHA1](./media/app-wrapper-prepare-ios/iOS-signing-cert-9.png)

### <a name="steps-to-create-an-in-house-distribution-provisioning-profile"></a>Шаги по созданию профиля подготовки распространения внутри организации

1. Вернитесь на [портал учетных записей разработчиков Apple](https://developer.apple.com/account/) и **войдите**, используя идентификатор Apple ID своей организации.

2. Щелкните **Certificates, IDs & Profiles** (Сертификаты, идентификаторы и профили).

3. Нажмите кнопку !["плюс" на портале разработчиков Apple](./media/app-wrapper-prepare-ios/iOS-signing-cert-2.png) в верхнем правом углу, чтобы добавить профиль подготовки iOS.

4. Выберите создание профиля подготовки **In House** (Внутренний) в разделе **Distribution** (Распространение).

   ![Выбор внутреннего профиля подготовки](./media/app-wrapper-prepare-ios/iOS-provisioning-profile-1.png)

5. Нажмите кнопку **Continue**(Продолжить). Не забудьте связать ранее созданный сертификат для подписи с профилем подготовки.

6. Следуйте инструкциям, чтобы скачать профиль (с расширением MOBILEPROVISION) на компьютер macOS.

7. Сохраните файл в запоминающемся расположении. Этот файл будет использоваться для параметра -p при использовании инструмента упаковки приложений.

## <a name="download-the-app-wrapping-tool"></a>Скачивание инструмента упаковки приложений

1. Скачайте файлы инструмента упаковки приложений на компьютер Mac OS из репозитория [GitHub](https://github.com/msintuneappsdk/intune-app-wrapping-tool-ios).

2. Дважды щелкните файл **Microsoft Intune App Wrapping Tool for iOS.dmg**. Появится окно лицензионного соглашения (EULA). Внимательно прочитайте документ.

3. Нажмите кнопку **Принимаю**, чтобы принять лицензионное соглашение, в результате чего пакет будет установлен на компьютере.

## <a name="run-the-app-wrapping-tool"></a>Запуск инструмента упаковки для приложений

### <a name="use-terminal"></a>Использование терминала

Откройте приложение Terminal в macOS и выполните следующую команду:

```bash
/Volumes/IntuneMAMPackager/Contents/MacOS/IntuneMAMPackager -i /<path of input app>/<app filename> -o /<path to output folder>/<app filename> -p /<path to provisioning profile> -c <SHA1 hash of the certificate> [-b [<output app build string>]] [-v] [-e] [-x /<array of extension provisioning profile paths>]
```

> [!NOTE]
> Некоторые параметры являются необязательными, как показано в следующей таблице.

**Пример.** Следующий пример команды запускает инструмент упаковки приложений для приложения MyApp.ipa. Для подписи упакованного приложения указывается профиль подготовки и хэш SHA-1 сертификата для подписи. Выходное приложение (MyApp_Wrapped.ipa) создается и хранится в папке вашего рабочего стола.

```bash
./IntuneMAMPackager/Contents/MacOS/IntuneMAMPackager -i ~/Desktop/MyApp.ipa -o ~/Desktop/MyApp_Wrapped.ipa -p ~/Desktop/My_Provisioning_Profile_.mobileprovision -c "12 A3 BC 45 D6 7E F8 90 1A 2B 3C DE F4 AB C5 D6 E7 89 0F AB"  -v true
```

### <a name="command-line-parameters"></a>Параметры командной строки

Инструмент упаковки приложений поддерживает использование следующих параметров командной строки:

|Свойство|Способ использования|
|---------------|--------------------------------|
|**-i**|`<Path of the input native iOS application file>`. Файл должен иметь расширение APP или IPA. |
|**-o**|`<Path of the wrapped output application>` |
|**-p**|`<Path of your provisioning profile for iOS apps>`|
|**-c**|`<SHA1 hash of the signing certificate>`|
|**-h**| Отображает подробные сведения об использовании доступных свойств командной строки для инструмента упаковки приложений. |
|**-aa**|(Необязательно) `<Authority URI of the input app if the app uses the Azure Active Directory Authentication Library>`, т. е. `login.windows.net/common` |
|**-ac**|(Необязательно) `<Client ID of the input app if the app uses the Azure Active Directory Authentication Library>` Это идентификатор GUID в поле "Идентификатор клиента" из списка приложения в колонке "Регистрация приложения". |
|**-ar**|(Необязательно) `<Redirect/Reply URI of the input app if the app uses the Azure Active Directory Authentication Library>` Это универсальный код ресурса (URI) перенаправления, настроенный в регистрации приложения. Обычно это будет протокол URL-адреса приложения, по которому приложение Microsoft Authenticator будет возвращаться после проверки подлинности через посредника. |
|**-v**| Вывод подробных сообщений в консоль (необязательно). Рекомендуется использовать этот флаг для отладки ошибок. |
|**-e**| Используйте этот флаг, чтобы инструмент упаковки приложений удалял отсутствующие права при обработке приложения (необязательно). Дополнительные сведения см. в статье [Установка прав приложения](#setting-app-entitlements).|
|**-xe**| Вывод сведений о расширениях iOS в приложении и необходимых правах для их использования (необязательно). Дополнительные сведения см. в статье [Установка прав приложения](#setting-app-entitlements). |
|**-x**| (Необязательно.) `<An array of paths to extension provisioning profiles>`. Используйте этот параметр, если приложению необходимы профили подготовки расширения.|
|**-b**|(Необязательно.) Используйте -b без аргумента, если необходимо, чтобы упакованное выходное приложение имело ту же версию пакета, что и входное приложение (не рекомендуется). <br/><br/> Используйте `-b <custom bundle version>`, если необходимо, чтобы упакованное приложение имело настраиваемую версию CFBundleVersion. Если нужно указать настраиваемую версию CFBundleVersion, рекомендуется увеличить номер версии CFBundleVersion нативного приложения на наименьшую величину, например 1.0.0 -> 1.0.1. |
|**-citrix**|(Необязательно) Включите пакет SDK для приложений Citrix XenMobile (вариант только для сети). Для использования этого параметра необходимо установить [Набор средств Citrix MDX](https://docs.citrix.com/en-us/mdx-toolkit/about-mdx-toolkit.html). |
|**-f**|`<Path to a plist file specifying arguments.>` Укажите этот флаг перед [PLIST](https://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/PropertyLists/Introduction/Introduction.html)-файлом, если шаблон plist используется для указания остальных свойств IntuneMAMPackager: -i, -o и -p (необязательно). См. статью "Использование plist для входных аргументов". |

### <a name="use-a-plist-to-input-arguments"></a>Использование plist для входных аргументов

Инструмент упаковки для приложений можно легко запустить, поместив все аргументы команды в [PLIST](https://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/PropertyLists/Introduction/Introduction.html)-файл. Plist — это формат файла, аналогичный XML, который можно использовать для ввода аргументов командной строки через форму.

В папке IntuneMAMPackager/Contents/MacOS откройте `Parameters.plist` (пустой шаблон plist) с помощью текстового редактора или Xcode. Укажите аргументы для следующих ключей.

| Ключ Plist | Type |  Значение по умолчанию | Примечания |
|------------------|-----|--------------|-----|
| Путь к входному пакету приложения |Строка|пустых| Равнозначно -i|
| Путь к выходному пакету приложения |Строка|пустых| Равнозначно -o|
| Путь к профилю подготовки |Строка|пустых| Равнозначно -p|
| Хэш сертификата SHA-1 |Строка|пустых| Равнозначно -с|
| Центр ADAL |Строка|пустых| То же, что и -aa|
| Идентификатор клиента ADAL |Строка|пустых| То же, что и -ac|
| URI ответа ADAL |Строка|пустых| То же, что и -ar|
| Подробные сведения включены |Логическое значение|false| Равнозначно -v|
| Удаление отсутствующих прав |Логическое значение|false| Равнозначно -с|
| Предотвращение обновления сборки по умолчанию |Логическое значение|false| Равнозначно использованию -b без аргументов|
| Переопределение строки сборки |Строка|пустых| Настраиваемая версия CFBundleVersion упакованного выходного приложения|
| Включите пакет SDK для приложений Citrix XenMobile (вариант только для сети)|Логическое значение|false| Равнозначно -citrix|
| Пути к профилю подготовки расширения |Массив строк|пустых| Массив из профилей подготовки расширения для приложения.

Запустите IntuneMAMPackager, используя plist как единственный аргумент:

```bash
./IntuneMAMPackager –f Parameters.plist
```

### <a name="post-wrapping"></a>После завершения упаковки

После завершения процесса упаковки появится сообщение The application was successfully wrapped (Приложение успешно упаковано). При возникновении ошибки см. справочные сведения в разделе [Сообщения об ошибках](#error-messages-and-log-files).

Изолированное приложение сохраняется в указанной ранее целевой папке. Теперь приложение можно отправить в консоль администрирования Intune и связать его с политикой управления мобильными приложениями.

> [!IMPORTANT]
> При отправке упакованного приложения можно попробовать обновить старую версию приложения, если она (упакованная или собственная) уже развернута в Intune. При возникновении ошибки отправьте приложение в качестве нового и удалите старую версию.

Теперь приложение можно развернуть в своих пользовательских группах, а также назначить ему политики защиты приложения, которые будут использоваться на устройствах, где запущено приложение.

## <a name="how-often-should-i-rewrap-my-ios-application-with-the-intune-app-wrapping-tool"></a>Как часто следует повторно упаковывать приложение для iOS с помощью инструмента упаковки для приложений Intune?

Ниже приводятся основные сценарии, в которых потребуется повторная упаковка приложений.

* Вышла новая версия приложения. Предыдущая версия приложения была упакована и отправлена в консоль Intune.
* Вышла новая версия инструмента упаковки для приложений iOS Intune, в которой исправлены ключевые ошибки или добавлены новые функции политики защиты приложений Intune. Это происходит каждые 6–8 недель в репозитории GitHub [инструмента упаковки приложений для iOS Microsoft Intune](https://github.com/msintuneappsdk/intune-app-wrapping-tool-ios).

Упаковывать приложения для iOS/iPadOS можно с помощью сертификата или профиля подготовки, отличного от того, который использовался для подписания приложения, но если права, указанные в приложении, не включены в новый профиль подготовки, упаковку выполнить не удастся. Если использовать в такой ситуации параметр командной строки -e (удаляющий из приложения отсутствующие права), чтобы не происходил сбой упаковки, это может привести к нарушению нормальной работы приложения.

Далее приводятся некоторые рекомендации по повторной упаковке.

* Убедитесь в том, что другой профиль подготовки включает в себя все те же права, что и предыдущий профиль подготовки. 

## <a name="error-messages-and-log-files"></a>Сообщения об ошибках и файлы журналов

Используйте следующие сведения для устранения неполадок со средством упаковки приложений.

### <a name="error-messages"></a>Сообщения об ошибках

Если инструмент упаковки приложений не сможет успешно завершить работу, в консоли появится одно из следующих сообщений об ошибке:

|Сообщение об ошибке|Дополнительные сведения|
|-----------------|--------------------|
|Необходимо указать действительный подготовительный профиль iOS.|Возможно, ваш подготовительный профиль недействителен. Убедитесь, что у вас есть необходимые разрешения для устройств и профиль правильно настроен либо для разработки, либо для распространения. Также возможно, что срок действия подготовительного профиля истек.|
|Укажите допустимое имя входного приложения.|Убедитесь, что имя входного приложения указано правильно.|
|Укажите допустимый путь к выходному приложению.|Убедитесь, что путь к выходному приложению существует и указан правильно.|
|Укажите допустимый входной подготовительный профиль.|Убедитесь, что указано допустимое имя и расширение подготовительного профиля. В подготовительном профиле могут отсутствовать права или может быть не включен параметр командной строки –p.|
|Указанное входное приложение не найдено. Укажите допустимое имя входного приложения и путь к нему.|Убедитесь, что путь к входному приложению является допустимым и существует. Убедитесь, что входное приложение существует в этом расположении.|
|Указанный файл входного подготовительного профиля не найден. Укажите допустимый файл входного подготовительного профиля.|Убедитесь, что путь к файлу входного подготовительного профиля является допустимым и что указанный файл существует.|
|Указанная выходная папка приложения не найдена. Укажите допустимый путь к выходному приложению.|Убедитесь, что указанный выходной путь является допустимым и существует.|
|Расширение выходного приложения отлично от **IPA**.|Инструмент упаковки приложений поддерживает только приложения с расширениями **APP** и **IPA**. Убедитесь, что выходной файл имеет допустимое расширение.|
|Указан недопустимый сертификат для подписи. Укажите допустимый сертификат для подписи Apple.|Убедитесь, что с портала разработчиков Apple вы скачали правильный сертификат для подписи. Возможно, истек срок действия сертификата или отсутствует открытый либо закрытый ключ. Если сертификат и подготовительный профиль Apple можно использовать для корректной подписи приложения в Xcode, они допустимы для инструмента упаковки приложений.|
|Указанное входное приложение является недопустимым. Укажите допустимое приложение.|Убедитесь, что имеется допустимое приложение iOS, скомпилированное в виде файла APP или IPA.|
|Указанное входное приложение зашифровано. Укажите допустимое незашифрованное приложение.|Инструмент упаковки приложений не поддерживает зашифрованные приложения. Укажите незашифрованное приложение.|
|Указанное входное приложение не является приложением в формате PIE. Укажите допустимое приложение в формате PIE.|При запуске приложений PIE адреса их загрузки в памяти определяются случайным образом. Это является преимуществом с точки зрения безопасности. Дополнительные сведения о преимуществах с точки зрения безопасности см. в документации для разработчиков Apple.|
|Указанное входное приложение уже изолировано. Укажите допустимое неизолированное приложение.|Не удается обработать приложение, которое уже было обработано средством. Если необходимо повторно обработать приложение, запустите средство, используя исходную версию приложения.|
|Указанное входное приложение не подписано. Укажите допустимое подписанное приложение.|Для средства изоляции приложения требуется подписанное приложение. Сведения о подписи изолированного приложения см. в документации для разработчиков.|
|Указанное входное приложение должно иметь формат IPA или APP.|Средство изоляции приложений поддерживает только расширения APP и IPA. Убедитесь, что входной файл имеет допустимое расширение и скомпилирован как файл APP или IPA.|
|Указанное входное приложение уже было изолировано и имеет самую последнюю версию шаблона политики.|Инструмент упаковки приложений не выполняет повторную упаковку существующего приложения с последней версией шаблона политики.|
|WARNING: Хэш SHA1 сертификата не указан. Убедитесь, что изолированное приложение подписано перед развертыванием.|Укажите допустимый хэш SHA1 после флага –c в командной строке. |

### <a name="collecting-logs-for-your-wrapped-applications-from-the-device"></a>Сбор журналов для упакованных приложений с устройства
Чтобы получить журналы для упакованных приложений при устранении неполадок, сделайте следующее:

1. Перейдите в приложение для настройки параметров iOS на своем устройстве и выберите бизнес-приложение.
2. **Включите** **консоль диагностики**.
3. Запустите бизнес-приложение.
4. Щелкните ссылку для начала работы.
5. Теперь вы можете отправить журналы по электронной почте или скопировать их в папку OneDrive.

> [!NOTE]
> Функция ведения журнала включена для приложений, которые упакованы с помощью соответствующего средства, входящего в Intune версии 7.1.13 и выше.

### <a name="collecting-crash-logs-from-the-system"></a>Сбор журналов аварийного завершения системы

Приложение может регистрировать полезную информацию в консоли клиентского устройства iOS. Используйте эти сведения, когда возникают проблемы с приложением и нужно определить, не связана ли неполадка с инструментом упаковки приложений или самим приложением. Чтобы получить эти данные, необходимо выполнить следующие действия.

1. Воспроизвести проблему путем запуска приложения.

2. Собрать выходные данные консоли, следуя инструкциям Apple по [отладке развернутых приложений iOS](https://developer.apple.com/library/ios/qa/qa1747/_index.html).

Изолированные приложения в случае сбоя дают возможность отправлять журналы по электронной почте непосредственно с устройства. Пользователи могут отправлять журналы вам для анализа и (при необходимости) последующей пересылки в корпорацию Майкрософт.

### <a name="certificate-provisioning-profile-and-authentication-requirements"></a>Сертификат, подготовительный профиль и требования проверки подлинности

Инструмент упаковки приложений для iOS имеет некоторые требования, которые необходимо выполнить для обеспечения полной функциональности.

|Требование|Сведения|
|---------------|-----------|
|Профиль подготовки iOS|Убедитесь, что профиль подготовки действителен, прежде чем его включать. При обработке приложения iOS инструмент упаковки приложений не проверяет срок действия профиля подготовки. Если указан подготовительный профиль с истекшим сроком действия, средство изоляции приложений включит этот профиль, и о проблеме станет известно только после того, как установка приложения на устройстве iOS завершится неудачей.|
|Сертификат для подписи iOS|Прежде чем указывать сертификат для подписи, убедитесь, что он действителен. При обработке приложения iOS инструмент упаковки приложений не проверяет срок действия сертификата. Если указан хэш для сертификата с истекшим сроком действия, средство обработает и подпишет приложение, но его не удастся установить на устройства.<br /><br />Убедитесь, что сертификат, предоставленный для подписи упакованного приложения, имеет соответствие в профиле подготовки. Инструмент не проверяет соответствие профиля подготовки и сертификата, предоставленного для подписи упакованного приложения.|
|Проверка подлинности|Для поддержки шифрования на устройстве должен быть задан ПИН-код. При касании строки состояния на устройствах, на которых развернуто упакованное приложение, пользователю понадобится повторно войти в систему, используя рабочую или учебную учетную запись. Политика по умолчанию в упакованном приложении — *проверка подлинности при повторном запуске*. В iOS все внешние уведомления (например, телефонный звонок) обрабатываются как выход из приложения и его повторный запуск.

## <a name="setting-app-entitlements"></a>Установка прав приложения

Перед упаковкой приложения можно назначить *права* для предоставления приложению дополнительных разрешений и возможностей, которые отсутствуют в приложении по умолчанию. *Файл прав* используется во время подписи кода для задания специальных разрешений в приложении (например, доступа к общей цепочке ключей). Определенные службы приложения, которые называют *возможностями*, включаются в Xcode во время разработки приложения. После включения возможности отражаются в файле прав. Дополнительные сведения о правах и возможностях см. в статье [Добавление возможностей](https://developer.apple.com/library/ios/documentation/IDEs/Conceptual/AppDistributionGuide/AddingCapabilities/AddingCapabilities.html) в библиотеке разработчика iOS. Полный список поддерживаемых возможностей см. [в этой статье](https://developer.apple.com/library/ios/documentation/IDEs/Conceptual/AppDistributionGuide/SupportedCapabilities/SupportedCapabilities.html).

### <a name="supported-capabilities-for-the-app-wrapping-tool-for-ios"></a>Поддерживаемые возможности для средства упаковки приложений для iOS

|Функция|Описание:|Рекомендации по использованию|
|--------------|---------------|------------------------|
|Группы приложений|Используйте группы приложений, чтобы позволить нескольким приложениям осуществлять доступ к общим контейнерам и разрешить дополнительное межпроцессное взаимодействие между приложениями.<br /><br />Чтобы включить группы приложений, откройте панель **Возможности** и щелкните параметр **Включить** в разделе **Группы приложений**. Вы можете добавить группы приложений или выбрать уже существующие.|При использовании групп приложений применяйте обратную нотацию DNS:<br /><br />*группа.com.название_компании.группа_приложений*|
|Фоновые режимы|Включение фоновых режимов позволяет вашему приложению iOS продолжать выполнение в фоновом режиме.||
|Защита данных|Функция защиты данных добавляет уровень защиты для файлов, сохраняемых приложением iOS на диск. Функция защиты данных использует встроенные аппаратные средства шифрования, присутствующие на определенном устройстве, для хранения файлов в зашифрованном виде на диске. Приложение должно быть подготовлено для использования защиты данных.||
|Покупка из приложения|Покупка из приложения внедряет магазин непосредственно в код приложения, давая вам возможность подключаться к магазину и безопасно обрабатывать платежи от пользователя. Покупку из приложения можно использовать для сбора оплаты за расширенную функциональность или дополнительное содержимое, которое может использоваться приложением.||
|Общий доступ к цепочке ключей|Включение общего доступа к цепочке ключей позволяет приложениям использовать пароли в цепочке ключей совместно с другими приложениями, разработанными вашей группой.|При использовании общего доступа к цепочке ключей применяйте обратную нотацию DNS:<br /><br />*com.название_компании.группа_цепочки_ключей*|
|Личный VPN|Включите личный VPN, чтобы разрешить приложению создать настраиваемую конфигурацию VPN системы и управлять ей, используя платформу сетевого расширения.||
|Push-уведомления|Служба push-уведомлений Apple (APN) позволяет приложению, которое выполняется в фоновом режиме, уведомлять пользователя о наличии информации для него.|Для работы push-уведомлений необходимо использовать подготовительный профиль для конкретного приложения.<br /><br />Следуйте указаниям в [документации для разработчика Apple](https://developer.apple.com/library/ios/documentation/IDEs/Conceptual/AppDistributionGuide/AddingCapabilities/AddingCapabilities.html).|
|Конфигурация беспроводных периферийных устройств|Включение конфигурации беспроводных периферийных устройств добавляет в проект платформу внешних периферийных устройств и позволяет приложению настраивать периферийные устройства Wi-Fi MFi.||

### <a name="steps-to-enable-entitlements"></a>Шаги для включения прав

1. Включите возможности в приложении:

    a.  В Xcode перейдите к целевой платформе приложения и щелкните **Capabilities** (Возможности).

    b.  Включите соответствующие возможности. Подробные сведения о каждой возможности и том, как определить правильные значения, см. в статье [Добавление возможностей](https://developer.apple.com/library/ios/documentation/IDEs/Conceptual/AppDistributionGuide/AddingCapabilities/AddingCapabilities.html) в библиотеке разработчика iOS.

    c.  Запишите все идентификаторы, созданные во время данного процесса. Они также могут называться значениями `AppIdentifierPrefix`.

    d.  Выполните сборку и подпись приложения, которое планируется упаковать.

2. Включите права в подготовительном профиле:

    a.  Войдите в центр разработчиков Apple.

    b.  Создайте подготовительный профиль для приложения. Инструкции см. в статье [How to Obtain the Prerequisites for the Intune App Wrapping Tool for iOS](https://blogs.technet.microsoft.com/enterprisemobility/2015/02/25/how-to-obtain-the-prerequisites-for-the-intune-app-wrapping-tool-for-ios/) (Получение необходимых компонентов для инструмента создания программы-оболочки для приложений Intune для iOS).

    c.  В подготовительном профиле включите те же права, что и в приложении. Потребуется указать те же идентификаторы (значения `AppIdentifierPrefix`), которые вы задали во время разработки приложения. 

    d.  Завершите работу мастера подготовительного профиля и скачайте файл.

3. Убедитесь, что выполнены все необходимые условия, а затем упакуйте приложение.

### <a name="troubleshoot-common-errors-with-entitlements"></a>Устранение распространенных неполадок с правами

Если средство упаковки приложений для iOS отображает ошибку права, попробуйте выполнить следующие действия.

|Проблема|Причина|Решение|
|---------|---------|--------------|
|Не удалось проанализировать права, созданные из входного приложения.|Средству упаковки приложений не удается прочитать файл прав, который был извлечен из приложения. Возможно, файл прав имеет неправильный формат.|Проверьте файл прав для своего приложения. Ниже описано, как это сделать. При проверке файла прав убедитесь в отсутствии любого неправильного синтаксиса. Файл должен иметь формат XML.|
|Права отсутствуют в подготовительном профиле (с перечислением отсутствующих прав). Переупакуйте приложение с использованием подготовительного профиля, имеющего данные права.|Существует несоответствие между правами, которые включены в подготовительном профиле, и возможностями, включенными в приложении. Это несоответствие также касается и идентификаторов, связанных с отдельными возможностями (например, групп приложений и доступа к цепочкам ключей).|Как правило, можно создать новый подготовительный профиль, который включает в себя те же возможности, что и приложение. Если идентификаторы профиля и приложения не совпадают, средство упаковки приложений по возможности заменяет эти идентификаторы. Если эта ошибка сохраняется после создания профиля подготовки, можно попробовать удалить права из приложения с помощью параметра –e параметр (см. раздел "Использование параметра –e для удаления прав из приложения").|

### <a name="find-the-existing-entitlements-of-a-signed-app"></a>Поиск имеющихся прав подписанного приложения

Чтобы просмотреть существующие права подписанного приложения и подготовительного профиля, выполните следующие действия:

1. Найдите IPA-файл и измените его расширение на ZIP.

2. Разверните этот ZIP-файл. В результате создается папка Payload, содержащая ваш пакет APP.

3. Используйте средство разработки для проверки прав в пакете APP, где `YourApp.app` — это реальное имя вашего пакета APP.

    ```bash
    codesign -d --entitlements :- "Payload/YourApp.app"
    ```

4. Используйте средство обеспечения безопасности для проверки прав внедренного подготовительного профиля приложения, где `YourApp.app` — это реальное имя вашего пакета APP.

    ```bash
    security cms -D -i "Payload/YourApp.app/embedded.mobileprovision"
    ```

### <a name="remove-entitlements-from-an-app-by-using-the-e-parameter"></a>Удаление прав из приложения с помощью параметра —e

Эта команда удаляет все возможности, включенные в приложении, которые не находятся в файле прав. Удаление возможностей, которые используются приложением, может нарушить работу приложения. Примером ситуации, в которой можно удалить отсутствующие возможности, является наличие приобретенного у поставщика приложения, содержащего все возможности по умолчанию.

```bash
./IntuneMAMPackager/Contents/MacOS/IntuneMAMPackager –i /<path of input app>/<app filename> -o /<path to output folder>/<app filename> –p /<path to provisioning profile> –c <SHA1 hash of the certificate> -e
```

## <a name="security-and-privacy-for-the-app-wrapping-tool"></a>Обеспечение безопасности и конфиденциальности инструмента упаковки приложений

При использовании инструмента упаковки приложений придерживайтесь следующих рекомендаций по обеспечению безопасности и конфиденциальности.

- Указываемые вами сертификат для подписи, профиль подготовки и бизнес-приложение должны находиться на том же компьютере Mac OS, который используется для запуска инструмента упаковки приложений. Если файлы находятся по пути UNC, убедитесь, что они доступны с компьютера Mac OS. Путь должен быть защищен с помощью подписи IPsec или SMB.

    Упакованное приложение, импортированное в консоль администрирования, должно находиться на том же компьютере, на котором запускается инструмент. Если файл находится по UNC-пути, убедитесь, что он доступен на компьютере, на котором запущена консоль администрирования. Путь должен быть защищен с помощью подписи IPsec или SMB.

- Окружение, куда скачивается инструмент упаковки приложений из репозитория GitHub, должно быть защищено с помощью подписи IPsec или SMB.

- Чтобы обеспечить защиту от атак, обрабатываемое приложение должно быть получено из надежного источника.

- Убедитесь, что целевая папка, указанная в инструменте упаковки приложений, защищена. Особенно это касается удаленных папок.

- Приложения для iOS, имеющие диалоговое окно отправки файла, позволяют обходить примененные ограничения на вырезание, копирование и вставку. Например, диалоговое окно отправки файла можно использовать для отправки снимка экрана с данными приложения.

- Просматривая папку документов на своих устройствах из изолированного приложения, вы можете увидеть папку с именем .msftintuneapplauncher. Изменение или удаление этого файла может повлиять на правильность работы ограниченных приложений.

## <a name="intune-app-wrapping-tool-for-ios-with-citrix-mdx-mvpn"></a>Использование инструмента упаковки приложений Intune для iOS с Citrix MDX mVPN

Эта функция обеспечивает интеграцию инструмента упаковки приложений Citrix MDX для iOS/iPadOS. Интеграция представляет собой просто дополнительный флаг командной строки `-citrix` для общего набора инструментов упаковки приложений Intune.

### <a name="requirements"></a>Requirements (Требования)

Чтобы использовать флаг `-citrix`, также потребуется установить [инструмент упаковки приложений Citrix MDX для iOS](https://docs.citrix.com/en-us/mdx-toolkit/10/xmob-mdx-kit-app-wrap-ios.html) на том же компьютере с macOS. Скачиваемые файлы находятся в разделе [Скачиваемые файлы Citrix XenMobile](https://www.citrix.com/downloads/xenmobile/) и доступны только клиентам Citrix после входа в систему. Установите инструмент в папку по умолчанию: `/Applications/Citrix/MDXToolkit`. 

> [!NOTE] 
> Поддержка интеграции Intune и Citrix доступна только для устройств с iOS 10 и более поздними версиями.

### <a name="use-the--citrix-flag"></a>Использование флага `-citrix`

Просто запустите общую команду упаковки приложения, добавив флаг `-citrix`. С флагом `-citrix` сейчас не указывается никаких аргументов.

**Формат использования**:

```bash
./IntuneMAMPackager/Contents/MacOS/IntuneMAMPackager -i /<path of input app>/<app filename> -o /<path to output folder>/<app filename> -p /<path to provisioning profile> -c <SHA1 hash of the certificate> [-b [<output app build string>]] [-v] [-e] [-x /<array of extension provisioing profile paths>] [-citrix]
```

**Пример команды**:

```bash
./IntuneMAMPackager/Contents/MacOS/IntuneMAMPackager -i ~/Desktop/MyApp.ipa -o ~/Desktop/MyApp_Wrapped.ipa -p ~/Desktop/My_Provisioning_Profile_.mobileprovision -c 12A3BC45D67EF8901A2B3CDEF4ABC5D6E7890FAB  -v true -citrix
```

## <a name="see-also"></a>См. также

- [Выбор способа подготовки приложений для управления мобильными приложениями с помощью Microsoft Intune](apps-prepare-mobile-application-management.md)
- [Распространенные вопросы, проблемы с политиками и профилями устройств в Microsoft Intune и возможные решения](../configuration/device-profile-troubleshoot.md)
- [Подготовка приложений для управления мобильными приложениями с помощью пакета SDK](app-sdk.md)
