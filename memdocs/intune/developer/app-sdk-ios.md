---
title: Руководство для разработчиков по пакету SDK для приложений Microsoft Intune в iOS
description: Пакет SDK для приложений Microsoft Intune для iOS позволяет встроить в собственное приложение для iOS политики защиты приложений Intune, также известные как политики защиты приложений (APP) или политики управления мобильными приложениями (MAM).
keywords: ''
author: Erikre
ms.author: erikre
manager: dougeby
ms.date: 04/02/2020
ms.topic: reference
ms.service: microsoft-intune
ms.subservice: developer
ms.localizationpriority: medium
ms.technology: ''
ms.assetid: 8e280d23-2a25-4a84-9bcb-210b30c63c0b
ms.reviewer: aanavath
ms.suite: ems
search.appverid: MET150
ms.custom: ''
ms.collection: M365-identity-device-management
ms.openlocfilehash: 379eacee731c8cdd773fc7a15f556ab85e409f7c
ms.sourcegitcommit: 302556d3b03f1a4eb9a5a9ce6138b8119d901575
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/27/2020
ms.locfileid: "83989894"
---
# <a name="microsoft-intune-app-sdk-for-ios-developer-guide"></a>Руководство для разработчиков по пакету SDK для приложений Microsoft Intune в iOS

> [!NOTE]
> Рекомендуется прочесть статью [Начало работы с пакетом SDK для приложений Intune](app-sdk-get-started.md), где описана подготовка к интеграции на каждой поддерживаемой платформе.
>
> Инструкции по скачиванию пакета SDK см. в [этой статье](../developer/app-sdk-get-started.md#download-the-sdk-files).

Пакет SDK для приложений Microsoft Intune для iOS позволяет встроить в собственное приложение для iOS политики защиты приложений Intune, также известные как политики защиты приложений (APP) или политики управления мобильными приложениями (MAM). В приложение, которое использует MAM, встроен пакет SDK для приложений Intune. ИТ-администраторы могут развернуть политики защиты приложений в вашем мобильном приложении, когда Intune активно управляет им.

## <a name="prerequisites"></a>Предварительные условия

* Потребуется компьютер под управлением Mac OS X 10.8.5 или более поздней версии, на котором также установлен XCode версии 9 или более поздней.

* Ваше приложение должно быть предназначено для iOS 11 или более поздней версии.

* См. статью [Условия лицензии пакета SDK для приложений Intune для iOS](https://github.com/msintuneappsdk/ms-intune-app-sdk-ios/blob/master/Microsoft%20License%20Terms%20Intune%20App%20SDK%20for%20iOS.pdf). Распечатайте и сохраните копию условий лицензии для своих записей. Скачивая и используя пакет SDK для приложений Intune в iOS, вы соглашаетесь с этими условиями лицензии.  Если вы не согласны, не используйте это программное обеспечение.

* Скачайте файлы для пакета SDK для приложений Intune в iOS на сайте [GitHub](https://github.com/msintuneappsdk/ms-intune-app-sdk-ios).

## <a name="whats-in-the-sdk-repository"></a>Что находится в репозитории SDK

Следующие файлы относятся к приложениям и расширениям, которые не содержат SWIFT-кода или компилируются с версией Xcode до 10.2:

* **IntuneMAM.framework**. Платформа пакета SDK для приложений Intune. Рекомендуется связать эту платформу с приложением или расширениями, чтобы включить управление клиентскими приложениями Intune. Однако некоторые разработчики могут предпочесть преимущества производительности статической библиотеки. См. следующие ресурсы:

* **libIntuneMAM.a**. Статическая библиотека пакета SDK для приложений Intune. Разработчики могут связать статическую библиотеку, а не платформу. Поскольку статические библиотеки внедряются непосредственно в двоичный код приложения или расширения во время сборки, для использования статической библиотеки существует ряд преимуществ производительности во время запуска. Однако ее интеграция в приложение является более сложным процессом. Если приложение содержит расширения, связывание статической библиотеки с приложением и расширениями приведет к увеличению размера пакета приложений, так как статическая библиотека будет внедрена в каждый двоичный файл приложения или расширения. При использовании платформы приложения и расширения могут совместно использовать один и тот же двоичный файл пакета SDK Intune, что приводит к уменьшению размера приложения.

* **IntuneMAMResources.bundle**. Набор ресурсов, на которых основан пакет SDK. Пакет ресурсов требуется только для приложений, которые интегрируются со статической библиотекой (libIntuneMAM.a).

Следующие файлы относятся к приложениям и расширениям, содержащим SWIFT-код, и компилируются с помощью Xcode 10.2 и более поздних версий.

* **IntuneMAMSwift.framework**: платформа Swift Intune App SDK. Эта платформа содержит все заголовки для API-интерфейсов, которые будут вызываться приложением. Свяжите эту платформу с приложением или расширениями, чтобы включить управление клиентскими приложениями Intune.

* **IntuneMAMSwiftStub.framework**: платформа Swift Stub Intune App SDK. Это обязательная зависимость IntuneMAMSwift.framework, с которой должны быть связаны приложения или расширения.


Следующие файлы относятся ко всем приложениям и расширениям.

* **IntuneMAMConfigurator**: средство, используемое для настройки файла Info.plist приложения или расширения с минимально необходимыми изменениями для управления Intune. В зависимости от функциональных возможностей приложения или расширения может потребоваться внести дополнительные изменения в файл Info.plist вручную.

* **Заголовки**. Предоставляет API пакета SDK для приложений Intune. Эти заголовки включены в платформы IntuneMAM/IntuneMAMSwift, поэтому разработчикам, использующим любую из этих платформ, не нужно вручную добавлять заголовки в свой проект. Разработчикам, которые выбирают связь со статической библиотекой (libIntuneMAM.a), потребуется вручную включить эти заголовки в свой проект.

Следующие файлы заголовков включают API, типы данных и протоколы, предоставляемые разработчиком в SDK-пакете Intune для приложений.

-  IntuneMAMAppConfig.h
-  IntuneMAMAppConfigManager.h
-  IntuneMAMDataProtectionInfo.h
-  IntuneMAMDataProtectionManager.h
-  IntuneMAMDefs.h
-  IntuneMAMDiagnosticConsole.h
-  IntuneMAMEnrollmentDelegate.h
-  IntuneMAMEnrollmentManager.h
-  IntuneMAMEnrollmentStatus.h
-  IntuneMAMFileProtectionInfo.h
-  IntuneMAMFileProtectionManager.h
-  IntuneMAMLogger.h
-  IntuneMAMPolicy.h
-  IntuneMAMPolicyDelegate.h
-  IntuneMAMPolicyManager.h
-  IntuneMAMVersionInfo.h

Чтобы получить доступ ко всем указанным выше файлам заголовков, разработчикам достаточно просто импортировать IntuneMAM.h


## <a name="how-the-intune-app-sdk-works"></a>Принцип работы пакета SDK для приложений Intune

Назначение пакета SDK для приложений Intune для iOS заключается в том, чтобы добавить возможности управления в приложения iOS с минимальными изменениями кода. Сокращение объема изменений в коде уменьшает время выхода на рынок, но не затрагивает согласованность и стабильность работы мобильного приложения.


## <a name="build-the-sdk-into-your-mobile-app"></a>Интеграция пакета SDK с мобильным приложением

Чтобы использовать пакет SDK для приложений Intune, сделайте следующее.

1. **Вариант 1 — платформа (рекомендуется)** . Если вы используете Xcode 10.2 и более поздней версии и ваше приложение или расширение содержит код SWIFT, свяжите `IntuneMAMSwift.framework` и `IntuneMAMSwiftStub.framework` с целевым объектом: Перетащите `IntuneMAMSwift.framework` и `IntuneMAMSwiftStub.framework` в список **Встроенные двоичные файлы** целевого объекта проекта.

    В противном случае свяжите `IntuneMAM.framework` с целевым объектом: Перетащите `IntuneMAM.framework` в список **Embedded Binaries** (Встроенные двоичные файлы) цели проекта.

   > [!NOTE]
   > При использовании платформы вам необходимо вручную убрать архитектуры симулятора из универсальной платформы перед отправкой приложения в App Store. См. дополнительные сведения [об отправке приложения в App Store](#submit-your-app-to-the-app-store).

   **Вариант 2 — статическая библиотека**. Этот вариант доступен только для приложений и расширений, которые не содержат SWIFT-кода или были созданы с помощью Xcode до версии 10.2. Выполните связывание с библиотекой `libIntuneMAM.a`. Перетащите библиотеку `libIntuneMAM.a` в список **Linked Frameworks and Libraries** (Связанные платформы и библиотеки) цели проекта.

    ![Пакет SDK для приложений Intune в iOS — связанные платформы и библиотеки](./media/app-sdk-ios/intune-app-sdk-ios-linked-frameworks-and-libraries.png)

    Добавьте `-force_load {PATH_TO_LIB}/libIntuneMAM.a` в любое из следующих расположений, заменив `{PATH_TO_LIB}` путем к пакету SDK для приложений Intune.
   * Параметр конфигурации сборки `OTHER_LDFLAGS` проекта.
   * **Other Linker Flags** (Другие флаги компоновщика) в пользовательском интерфейсе Xcode.

     > [!NOTE]
     > Чтобы найти `PATH_TO_LIB`, выберите файл `libIntuneMAM.a`, а затем пункт **Получить сведения** в меню **Файл**. Скопируйте и вставьте сведения **Где** (путь) из раздела **Общие** окна **Сведения**.

     Добавьте пакет ресурсов `IntuneMAMResources.bundle` в проект, перетащив этот набор в узел **Copy Bundle Resources** (Копирование ресурсов пакета) раздела **Build Phases** (Этапы сборки).

     ![Пакет SDK для приложений Intune для iOS — копирование ресурсов пакета](./media/app-sdk-ios/intune-app-sdk-ios-copy-bundle-resources.png)
         
2. Добавьте в проект следующие платформы iOS.  
-  MessageUI.framework  
-  Security.framework  
-  CoreServices.framework  
-  SystemConfiguration.framework  
-  libsqlite3.tbd;  
-  libc++.tbd;  
-  ImageIO.framework  
-  LocalAuthentication.framework  
-  AudioToolbox.framework  
-  QuartzCore.framework  
-  WebKit.framework

3. Включите совместное использование цепочки ключей (если оно еще не включено), щелкнув **Capabilities** (Возможности) в каждой цели проекта и включив параметр **Keychain Sharing** (Совместное использование цепочки ключей). Совместное использование цепочки ключей требуется для перехода к следующему шагу.

   > [!NOTE]
   > Профиль подготовки должен поддерживать новые значения совместного использования цепочки ключей. Группы доступа к цепочке ключей должны поддерживать подстановочный знак. Чтобы проверить это, откройте MOBILEPROVISION-файл в текстовом редакторе, найдите **keychain-access-groups** и убедитесь в наличии подстановочного знака. Пример.
   >
   >  ```xml
   >  <key>keychain-access-groups</key>
   >  <array>
   >  <string>YOURBUNDLESEEDID.*</string>
   >  </array>
   >  ```

4. Чтобы создать отдельную группу доступа, в которой будут храниться данные пакета SDK для приложений Intune, включив совместное использование цепочки ключей, выполните приведенные ниже инструкции. Группу доступа к цепочке ключей можно создать с помощью пользовательского интерфейса или с помощью файла прав. При использовании пользовательского интерфейса для создания группы доступа к цепочке ключей обязательно выполните следующие действия:

     a. Если для мобильного приложения не определено ни одной группы доступа к цепочке ключей, добавьте идентификатор пакета приложения в качестве **первой** группы.
    
    b. Добавьте группу общей цепочки ключей `com.microsoft.intune.mam` к существующим группам доступа. Пакет SDK для приложений Intune использует эту группу доступа для хранения данных.
    
    c. Добавьте `com.microsoft.adalcache` в свои существующие группы доступа.
    
      ![Пакет SDK для приложений Intune в iOS — совместное использование цепочки ключей](./media/app-sdk-ios/intune-app-sdk-ios-keychain-sharing.png)
    
    d. Если вы изменяете файл прав непосредственно (не с помощью пользовательского интерфейса Xcode, показанного выше) для создания группы доступа к цепочке ключей, добавьте `$(AppIdentifierPrefix)` в начало групп доступа к цепочке ключей (Xcode обрабатывает это значение автоматически). Пример.
    
      - `$(AppIdentifierPrefix)com.microsoft.intune.mam`
      - `$(AppIdentifierPrefix)com.microsoft.adalcache`
    
      > [!NOTE]
      > Файл прав — это XML-файл, который является уникальным в рамках вашего мобильного приложения. Он используется для задания специальных разрешений и возможностей в вашем приложении для iOS. Если файла прав нет, включите общий доступ к цепочке ключей (шаг 3), чтобы это файл был создан в Xcode для вашего приложения. Убедитесь, что идентификатор пакета является первой записью в списке.

5. Включите в массив `LSApplicationQueriesSchemes` в файле Info.plist приложения каждый из протоколов, которые приложение передает в `UIApplication canOpenURL`. Не забудьте сохранить изменения перед переходом к следующему шагу.

6. Если ваше приложение еще не использует FaceID, убедитесь, что для [ключа NSFaceIDUsageDescription Info.plist](https://developer.apple.com/library/archive/documentation/General/Reference/InfoPlistKeyReference/Articles/CocoaKeys.html#//apple_ref/doc/uid/TP40009251-SW75) настроено сообщение по умолчанию. Это необходимо, чтобы iOS могла сообщить пользователю о том, как приложение собирается использовать FaceID. Настройка политики защиты приложений Intune позволяет использовать FaceID в качестве метода для доступа к приложению, если он настроен ИТ-администратором.

7. Используйте средство IntuneMAMConfigurator, включенное в [репозиторий SDK](https://github.com/msintuneappsdk/ms-intune-app-sdk-ios), для завершения настройки приложения в файле Info.plist. У средства есть три параметра:

   |Свойство|Способ использования|
   |---------------|--------------------------------|
   |- i |  `<Path to the input plist>` |
   |- e | `<Path to the entitlements file>` |
   |- o |  (Необязательно) `<Path to the output plist>` |

Если параметр "-о" не указан, входной файл будет изменен на месте. Средство является идемпотентным, поэтому его нужно перезапускать каждый раз, когда вносятся изменения в файл Info.plist. Кроме того, необходимо загрузить и запустить последнюю версию средства при обновлении пакета SDK Intune, если в последнем выпуске изменены требования к конфигурации Info.plist.

## <a name="configure-adalmsal"></a>Настройка ADAL/MSAL

Пакет SDK для приложений Intune может использовать либо [библиотеку проверки подлинности Azure Active Directory](https://github.com/AzureAD/azure-activedirectory-library-for-objc), либо [библиотеку проверки подлинности Майкрософт](https://github.com/AzureAD/microsoft-authentication-library-for-objc) для процедур проверки подлинности и условного запуска. Он также использует ADAL/MSAL для регистрации удостоверения пользователя в службе MAM для управления без сценариев регистрации устройства.

Как правило, ADAL/MSAL требует, чтобы приложение было зарегистрировано в Azure Active Directory (AAD) и получило уникальный идентификатор клиента и URI перенаправления. Эти условия гарантируют защищенность токенов, предоставленных этому приложению. Если приложение уже использует ADAL или MSAL для проверки подлинности пользователей, оно должно применить существующие значения регистрации и переопределить используемые по умолчанию значения пакета SDK для приложений Intune. Это гарантирует, что пользователей не попросят пройти проверку подлинности дважды (один раз в пакете SDK для приложений Intune, а другой — в приложении).

Если ваше приложение еще не использует ADAL или MSAL и вам не требуется доступ к ресурсам AAD, вам не нужно настраивать регистрацию клиентского приложения в AAD, если вы решили интегрировать ADAL. Если вы решили интегрировать MSAL, необходимо настроить регистрацию приложения и переопределить идентификатор клиента Intune по умолчанию и URI перенаправления.  

Рекомендуется, чтобы ваше приложение ссылалось на последнюю версию [ADAL](https://github.com/AzureAD/azure-activedirectory-library-for-objc/releases) или [MSAL](https://github.com/AzureAD/microsoft-authentication-library-for-objc/releases).

### <a name="link-to-adal-or-msal-binaries"></a>Ссылка на двоичные файлы ADAL или MSAL

**Вариант 1**. Выполните следующие [действия](https://github.com/AzureAD/azure-activedirectory-library-for-objc#download), чтобы связать приложение с двоичными файлами ADAL.

**Вариант 2**. Или выполните [эти инструкции](https://github.com/AzureAD/microsoft-authentication-library-for-objc#installation), чтобы связать приложение с двоичными файлами MSAL.

1. Если для приложения не определено ни одной группы доступа к цепочке ключей, добавьте идентификатор пакета приложения в качестве первой группы.

2. Включите единый вход ADAL/MSAL, добавив `com.microsoft.adalcache` к группам доступа ключей.

3. Если вы явным образом задаете группу цепочки ключей для общего кэша ADAL, убедитесь, что она имеет значение `<appidprefix>.com.microsoft.adalcache`. ADAL автоматически задает это значение, пока вы не переопределите его. Если вы хотите задать настраиваемую группу цепочки ключей для замены `com.microsoft.adalcache`, укажите ее в разделе "IntuneMAMSettings" файла Info.plist, используя ключ `ADALCacheKeychainGroupOverride`.

### <a name="configure-adalmsal-settings-for-the-intune-app-sdk"></a>Настройка параметров ADAL/MSAL для пакета SDK для приложений Intune

Если приложение уже использует ADAL или MSAL для проверки подлинности и для приложения уже настроены параметры Azure Active Directory, можно настроить принудительное использование пакетом SDK для приложений Intune тех же параметров во время проверки подлинности в Azure Active Directory. Это гарантирует, что приложение не будет дважды отображать пользователю запрос на проверку подлинности. Чтобы указать значения следующих параметров, см. сведения о [настройке параметров пакета SDK для приложений Intune](#configure-settings-for-the-intune-app-sdk).  

* ADALClientId
* ADALAuthority
* ADALRedirectUri
* ADALRedirectScheme
* ADALCacheKeychainGroupOverride

Если приложение уже использует ADAL или MSAL, требуются следующие настройки:

1. В словаре **IntuneMAMSettings** с именем ключа `ADALClientId`в файле Info.plist проекта укажите идентификатор клиента, который будет использоваться для вызовов ADAL.

2. В словаре **IntuneMAMSettings** с именем ключа `ADALAuthority` также укажите центр сертификации Azure AD.

3. В словаре **IntuneMAMSettings** с именем ключа `ADALRedirectUri` также укажите URI перенаправления, который будет использоваться для вызовов ADAL. Или можно указать `ADALRedirectScheme`, если URI перенаправления приложения имеет формат `scheme://bundle_id`.

Кроме того, приложения могут переопределять эти настройки Azure AD во время выполнения. Для этого нужно определить свойства `aadAuthorityUriOverride`, `aadClientIdOverride` и `aadRedirectUriOverride` для экземпляра `IntuneMAMPolicyManager`.

4. Убедитесь, что вы предоставили приложению iOS права доступа к службе политики защиты приложений (APP). См. сведения о [начале работы с пакетом SDK для Intune](app-sdk-get-started.md#next-steps-after-integration) в руководстве по [предоставлению приложению доступа к службе защиты приложений Intune (необязательно)](app-sdk-get-started.md#give-your-app-access-to-the-intune-app-protection-service-optional).  

> [!NOTE]
> Подход с файлом Info.plist рекомендуется использовать для всех параметров, которые являются статическими, но которые не обязательно определять во время выполнения. Значения, присвоенные свойствам `IntuneMAMPolicyManager`, имеют приоритет над любыми соответствующими значениями, установленными в файле Info.plist, и сохраняются даже после перезапуска приложения. Пакет SDK будет продолжать их использовать для возвратов политики до отмены регистрации либо очистки или изменения значений.

### <a name="if-your-app-does-not-use-adal-or-msal"></a>Если приложение не использует ADAL или MSAL

Как упоминалось ранее, пакет SDK для приложений Intune может использовать либо [библиотеку проверки подлинности Azure Active Directory](https://github.com/AzureAD/azure-activedirectory-library-for-objc), либо [библиотеку проверки подлинности Майкрософт](https://github.com/AzureAD/microsoft-authentication-library-for-objc) для процедур проверки подлинности и условного запуска. Пакет SDK также использует ADAL/MSAL для регистрации удостоверения пользователя в службе MAM для управления без сценариев регистрации устройства. Если **приложение не использует ADAL или MSAL для собственного механизма проверки подлинности**, может потребоваться настроить пользовательские параметры AAD в зависимости от библиотеки проверки подлинности, которую вы хотите интегрировать:   

ADAL — пакет SDK для приложений Intune предоставит значения по умолчанию для параметров ADAL и будет обрабатывать операции проверки подлинности в Azure AD. Разработчикам не нужно указывать какие бы то ни было значения для параметров ADAL. 

При использовании MSAL разработчики должны создать регистрацию приложения в AAD с помощью пользовательского URI перенаправления в указанном [здесь](https://github.com/AzureAD/microsoft-authentication-library-for-objc/wiki/Migrating-from-ADAL-Objective-C-to-MSAL-Objective-C#app-registration-migration) формате. Разработчикам следует задать ранее упомянутые параметры `ADALClientID` и `ADALRedirectUri` или эквивалентные свойства `aadClientIdOverride` и `aadRedirectUriOverride` в экземпляре `IntuneMAMPolicyManager`. Разработчики также должны выполнить шаг 4 в предыдущем разделе, чтобы предоставить доступ к службе защиты приложений Intune для регистрации приложений.

### <a name="special-considerations-when-using-msal"></a>Специальные рекомендации при использовании MSAL 

1. **Проверьте веб-представление** — приложениям не следует использовать SFSafariViewController, SFAuthSession или ASWebAuthSession в качестве веб-представления для любых интерактивных операций проверки подлинности MSAL, инициированных приложением. Если по некоторым причинам приложение должно использовать одно из этих веб-представлений для любых интерактивных операций проверки подлинности MSAL, необходимо также задать `SafariViewControllerBlockedOverride` для `true` в словаре `IntuneMAMSettings` в файле Info.plist приложения. WARNING: Это приведет к отключению перехватчиков SafariViewController Intune для включения сеанса проверки подлинности. В других местах приложения может возникнуть утечка данных, если приложение использует SafariViewController для просмотра корпоративных данных, поэтому приложение не должно отображать корпоративные данные в любом из этих типов веб-представлений.
2. **Связывание с ADAL и MSAL** — разработчики должны настроить предпочтение MSAL вместо ADAL в Intune в этом сценарии. По умолчанию Intune будет предпочитать поддерживаемые версии ADAL поддерживаемым версиям MSAL, если оба варианта используются в среде выполнения. Intune будет предпочитать поддерживаемую версию MSAL, только если во время первой операции проверки подлинности Intune `IntuneMAMUseMSALOnNextLaunch` имеет значение `true` в `NSUserDefaults`. Если параметр `IntuneMAMUseMSALOnNextLaunch` имеет значение `false` или не задан, Intune вернется к поведению по умолчанию. Как видно из названия, изменение `IntuneMAMUseMSALOnNextLaunch` вступит в силу при следующем запуске.


## <a name="configure-settings-for-the-intune-app-sdk"></a>Настройка параметров пакета SDK для приложений Intune

Словарь **IntuneMAMSettings** в файле Info.plist приложения можно использовать для настройки Intune App SDK. Если словарь IntuneMAMSettings не отображается в файле Info.plist, необходимо создать его.

В словаре IntuneMAMSettings можно использовать следующие поддерживаемые параметры для настройки пакета SDK для приложений Intune.

Некоторые из этих параметров уже описаны в предыдущих разделах, а некоторые используются только в определенных приложениях.

Параметр  | Type  | Определение | Необходим?
--       |  --   |   --       |  --
ADALClientId  | Строка  | Идентификатор клиента Azure AD для приложения. | Требуется для всех приложений, использующих MSAL, и любых приложений, использующих ADAL, которые обращаются к ресурсу AAD не в Intune. |
ADALAuthority | Строка | Используется центр сертификации Azure AD приложения. Вам нужно использовать собственное окружение, где были настроены учетные записи AAD. | Необязательный параметр. Рекомендуется, если приложение является пользовательским бизнес-приложением, предназначенным для использования в одной организации или на одном клиенте AAD. Если это значение отсутствует, используется общий центр AAD.|
ADALRedirectUri  | Строка  | URI перенаправления Azure AD для приложения. | ADALRedirectUri или ADALRedirectScheme требуется для всех приложений, использующих MSAL, и любых приложений, использующих ADAL, которые обращаются к ресурсу AAD не в Intune.  |
ADALRedirectScheme  | Строка  | Схема перенаправления Azure AD для приложения. Может использоваться вместо ADALRedirectUri, если URI перенаправления приложения имеет формат `scheme://bundle_id`. | ADALRedirectUri или ADALRedirectScheme требуется для всех приложений, использующих MSAL, и любых приложений, использующих ADAL, которые обращаются к ресурсу AAD не в Intune. |
ADALLogOverrideDisabled | Логическое значение  | Определяет, будет ли пакет SDK перенаправлять все журналы ADAL/MSAL (включая вызовы ADAL из приложения при их наличии) в свой файл журнала. По умолчанию используется значение NO (Нет). Задайте значение YES (Да), если в приложении настроен собственный обратный вызов журнала ADAL/MSAL. | Необязательный параметр. |
ADALCacheKeychainGroupOverride | Строка  | Указывает группе цепочки ключей использовать кэш ADAL/MSAL вместо "com.microsoft.adalcache". Обратите внимание, что этот параметр не содержит префикс идентификатора приложения. Он будет добавлен к предоставленной строке во время выполнения. | Необязательный параметр. |
AppGroupIdentifiers | Массив строк  | Массив групп приложений из раздела com.apple.security.application-groups прав приложения. | Требуется, если приложение использует группы приложений. |
ContainingAppBundleId | Строка | Указывает идентификатор пакета приложения, которое содержит расширение. | Требуется для расширений iOS. |
DebugSettingsEnabled| Логическое значение | Если задано значение "YES" (Да), можно применить политики теста в пакете параметров. В поставляемых приложения этот параметр *должен* быть отключен. | Необязательный параметр. По умолчанию используется значение No (Нет). |
AutoEnrollOnLaunch| Логическое значение| Указывает, должно ли приложение автоматически регистрироваться при запуске, если приложение еще не зарегистрировано и если обнаружено существующее управляемое удостоверение. По умолчанию используется значение NO (Нет). <br><br> Примечания. Если управляемое удостоверение не найдено или в кэше ADAL/MSAL отсутствует действительный токен для удостоверения, то попытка регистрации завершится сбоем без сообщения об ошибке и без запроса учетных данных (за исключением случая, когда параметр приложения MAMPolicyRequired имеет значение YES). | Необязательный параметр. По умолчанию используется значение No (Нет). |
MAMPolicyRequired| Логическое значение| Указывает, будет ли блокироваться запуск приложения при отсутствии политики защиты приложений Intune. По умолчанию используется значение NO (Нет). <br><br> Примечания. В магазин приложений нельзя отправить приложения, у которых параметр MAMPolicyRequired имеет значение YES. При установке значения YES в параметр MAMPolicyRequired также следует установить значение YES в параметр AutoEnrollOnLaunch. | Необязательный параметр. По умолчанию используется значение No (Нет). |
MAMPolicyWarnAbsent | Логическое значение| Указывает, будет ли приложение, для которого не настроена политика защиты приложений Intune, уведомлять пользователя во время запуска. <br><br> Примечание. Пользователи по-прежнему смогут использовать приложение без политики, отклонив предупреждение. | Необязательный параметр. По умолчанию используется значение No (Нет). |
MultiIdentity | Логическое значение| Указывает, поддерживает ли приложение множество удостоверений. | Необязательный параметр. По умолчанию используется значение No (Нет). |
SafariViewControllerBlockedOverride | Логическое значение| Отключает перехватчики SafariViewController в Intune, чтобы включить проверку подлинности MSAL через SFSafariViewController, SFAuthSession или ASWebAuthSession. | Необязательный параметр. По умолчанию используется значение No (Нет). Предупреждение. Это может привести к утечке данных при неправильном использовании. Включайте только в случае крайней необходимости. Дополнительные сведения см. разделе [Специальные рекомендации при использовании MSAL](#special-considerations-when-using-msal).  |
SplashIconFile <br>SplashIconFile~ipad | Строка  | Задает файл значка заставки Intune. | Необязательный параметр. |
SplashDuration | Число | Минимальное число секунд, в течение которого заставка Intune отображается при запуске приложения. По умолчанию используется значение 1,5. | Необязательный параметр. |
BackgroundColor| Строка| Задает цвет фона для компонентов пользовательского интерфейса пакета SDK для Intune. Принимает шестнадцатеричную строку RGB в виде "#XXXXXX", где "X" может принимать значение от 0 до 9 или от A до F. Символ решетки можно пропустить.   | Необязательный параметр. По умолчанию используется системный цвет фона, который может различаться в разных версиях iOS и зависит от параметра темного режима iOS. |
ForegroundColor| Строка| Задает цвет переднего плана для компонентов пользовательского интерфейса пакета SDK для Intune, например цвет текста. Принимает шестнадцатеричную строку RGB в виде "#XXXXXX", где "X" может принимать значение от 0 до 9 или от A до F. Символ решетки можно пропустить.  | Необязательный параметр. По умолчанию используется системный цвет метки, который может различаться в разных версиях iOS и зависит от параметра темного режима iOS. |
AccentColor | Строка| Задает контрастный цвет для компонентов пользовательского интерфейса пакета SDK для Intune, таких как цвет текста кнопки и цвет выделения в поле ПИН-кода. Принимает шестнадцатеричную строку RGB в виде "#XXXXXX", где "X" может принимать значение от 0 до 9 или от A до F. Символ решетки можно пропустить.| Необязательный параметр. По умолчанию используется системный синий цвет. |
SecondaryBackgroundColor| Строка| Задает дополнительный цвет фона для экрана MTD. Принимает шестнадцатеричную строку RGB в виде "#XXXXXX", где "X" может принимать значение от 0 до 9 или от A до F. Символ решетки можно пропустить.   | Необязательный параметр. По умолчанию — белый. |
SecondaryForegroundColor| Строка| Задает вторичный цвет переднего плана для экранов MTD, например цвет сноски. Принимает шестнадцатеричную строку RGB в виде "#XXXXXX", где "X" может принимать значение от 0 до 9 или от A до F. Символ решетки можно пропустить.  | Необязательный параметр. По умолчанию — серый. |
SupportsDarkMode| Логическое значение | Указывает, должна ли цветовая схема пользовательского интерфейса пакета SDK для Intune соблюдать параметр темного режима системы, если для BackgroundColor/ForegroundColor/AccentColor не задано явное значение | Необязательный параметр. По умолчанию — yes. |
MAMTelemetryDisabled| Логическое значение| Указывает, будет ли пакет SDK отправлять данные телеметрии в свою серверную часть.| Необязательный параметр. По умолчанию используется значение No (Нет). |
MAMTelemetryUsePPE | Логическое значение | Указывает, будет ли пакет SDK для MAM отправлять данные в серверную часть телеметрии PPE. Используется при тестировании приложений с помощью политики Intune, чтобы данные телеметрии теста не смешивались с данными клиентов. | Необязательный параметр. По умолчанию используется значение No (Нет). |
MaxFileProtectionLevel | Строка | Необязательный параметр. Позволяет приложению указать максимальное значение `NSFileProtectionType`, которое оно поддерживает. Это значение будет переопределять политику, отправленную службой, если уровень выше того, который поддерживается приложением. Возможные значения: `NSFileProtectionComplete`, `NSFileProtectionCompleteUnlessOpen`, `NSFileProtectionCompleteUntilFirstUserAuthentication`, `NSFileProtectionNone`.|
OpenInActionExtension | Логическое значение | Задайте значение YES (Да) для расширений OpenInAction. Дополнительные сведения см. в разделе "Предоставление общего доступа к данным через UIActivityViewController". |
WebViewHandledURLSchemes | Массив строк | Указывает схемы URL-адресов, обрабатываемые веб-представлением приложения. | Требуется, если приложение использует веб-представление, которое обрабатывает URL-адреса посредством ссылок и (или) javascript. |
DocumentBrowserFileCachePath | Строка | Если приложение использует [`UIDocumentBrowserViewController`](https://developer.apple.com/documentation/uikit/uidocumentbrowserviewcontroller?language=objc) для просмотра файлов в различных поставщиках файлов, этот путь можно задать относительно домашнего каталога в песочнице приложения, чтобы пакет SDK Intune мог перенести расшифрованные управляемые файлы в эту папку. | Необязательный параметр. По умолчанию — каталог `/Documents/`. |
VerboseLoggingEnabled | Логическое значение | Если задано значение YES (да), Intune будет использовать режим подробного протоколирования. | Необязательный параметр. По умолчанию используется значение НЕТ (нет) |

## <a name="receive-app-protection-policy"></a>Получение политики защиты приложений

### <a name="overview"></a>Обзор

Чтобы получить политику защиты Intune, приложения должны активировать запрос на регистрацию в службе Intune MAM. В консоли Intune можно настроить приложения для получения политики защиты с регистрацией устройства или без нее. Политика защиты приложений без регистрации, также известная как **APP-WE** или MAM-WE, позволяет управлять приложениями с помощью Intune без необходимости регистрации устройств в ПО управления мобильными устройствами (MDM) Intune. В обоих случаях для получения политики требуется регистрация в службе Intune MAM.

> [!Important]
> В пакете SDK для приложений Intune для iOS предусмотрено использование 256-битных ключей шифрования, если шифрование разрешено политиками защиты приложений. Чтобы использовать защищенный общий доступ к данным, всем приложениям потребуется текущая версия пакета SDK.

### <a name="apps-that-already-use-adal-or-msal"></a>Приложения, которые уже используют ADAL или MSAL

Приложения, которые уже используют ADAL или MSAL, должны вызвать метод `registerAndEnrollAccount` в экземпляре `IntuneMAMEnrollmentManager` после успешной аутентификации пользователя:

```objc
/*
 *  This method will add the account to the list of registered accounts.
 *  An enrollment request will immediately be started.
 *  @param identity The UPN of the account to be registered with the SDK
 */

(void)registerAndEnrollAccount:(NSString *)identity;
```

Путем вызова метода `registerAndEnrollAccount` пакет SDK регистрирует учетную запись пользователя и пытается зарегистрировать приложение от имени этой учетной записи. Если по какой-либо причине регистрация не удается, пакет SDK повторит ее попытку через 24 часа. Для отладки приложение может при помощи делегата получать [уведомления](#status-result-and-debug-notifications) о результатах запросов на регистрацию.

После вызова этого API приложение может продолжить работу в обычном режиме. В случае успешной регистрации пакет SDK уведомит пользователя о том, что требуется перезапуск приложения. При этом пользователь может немедленно перезапустить приложение.

```objc
[[IntuneMAMEnrollmentManager instance] registerAndEnrollAccount:@"user@foo.com"];
```

### <a name="apps-that-do-not-use-adal-or-msal"></a>Приложения, не использующие ADAL или MSAL

Если пользователь не вошел с помощью ADAL или MSAL, приложения все равно могут получать политики защиты приложений из службы Intune MAM при вызове интерфейса API. При этом выполнять аутентификацию будет пакет SDK. Этот способ нужно использовать, если проверка подлинности пользователя в Azure AD не была выполнена, но приложению все равно необходимо получить политики защиты приложений для защиты данных. Например, если для входа в приложение используется другая служба проверки подлинности или если приложение не поддерживает вход. Для этого приложение должно вызывать метод `loginAndEnrollAccount` в экземпляре `IntuneMAMEnrollmentManager`:

```objc
/**
 *  Creates an enrollment request which is started immediately.
 *  If no token can be retrieved for the identity, the user will be prompted
 *  to enter their credentials, after which enrollment will be retried.
 *  @param identity The UPN of the account to be logged in and enrolled.
 */
 (void)loginAndEnrollAccount: (NSString *)identity;
```

Вызвав этот метод, пакет SDK запросит учетные данные пользователя, если не удастся найти токен. Пакет SDK попытается зарегистрировать приложение с помощью службы Intune MAM от имени указанной учетной записи пользователя. Этот метод можно вызывать с "nil" в качестве удостоверения. В этом случае пакет SDK регистрируется на устройстве при помощи существующего управляемого пользователя (если используется управление мобильными устройствами), а при отсутствии такового запрашивает имя пользователя.

В случае сбоя регистрации приложение должно иметь возможность снова вызвать этот API позже (в зависимости от характера сбоя). Приложение может через делегата получать [уведомления](#status-result-and-debug-notifications) о результатах запросов на регистрацию.

После вызова этого API приложение может продолжить работу в обычном режиме. В случае успешной регистрации пакет SDK уведомит пользователя о том, что требуется перезапуск приложения.

Пример:

```objc
[[IntuneMAMEnrollmentManager instance] loginAndEnrollAccount:@"user@foo.com"];
```

### <a name="let-intune-handle-authentication-and-enrollment-at-launch"></a>Разрешить Intune выполнять проверку подлинности и регистрацию при запуске

Если для выполнения проверки подлинности с помощью ADAL/MSAL и регистрации до завершения запуска приложения требуется использовать пакет SDK для Intune, а для развертывания этого приложения необходима политика приложений Intune, необязательно использовать API `loginAndEnrollAccount`. Можно просто задать для двух параметров ниже значение YES в словаре IntuneMAMSettings в файле Info.plist приложения.

Параметр  | Type  | Определение |
--       |  --   |   --       |  
AutoEnrollOnLaunch| Логическое значение| Указывает, должно ли приложение автоматически регистрироваться при запуске, если приложение еще не зарегистрировано и если обнаружено существующее управляемое удостоверение. По умолчанию используется значение NO (Нет). <br><br> Примечание. Если управляемое удостоверение не найдено или в кэше ADAL/MSAL отсутствует действительный токен для удостоверения, то попытка регистрации завершится сбоем без сообщения об ошибке и без запроса учетных данных (за исключением случая, когда параметр приложения MAMPolicyRequired имеет значение YES). |
MAMPolicyRequired| Логическое значение| Указывает, будет ли блокироваться запуск приложения при отсутствии политики защиты приложений Intune. По умолчанию используется значение NO (Нет). <br><br> Примечание. В магазин приложений нельзя отправить приложения, у которых параметр MAMPolicyRequired имеет значение YES. При установке значения YES в параметр MAMPolicyRequired также следует установить значение YES в параметр AutoEnrollOnLaunch. |

Если для приложения выбран этот параметр, перезапуск приложения после регистрации не требуется.

### <a name="deregister-user-accounts"></a>Отмена регистрации учетных записей пользователей

Перед выходом пользователя из приложения оно должно отменить регистрацию пользователя в пакете SDK. Этим обеспечивается следующее.

1. Для учетной записи пользователя прекращаются повторные попытки регистрации.

2. Политика защиты приложений будет удалена.

3. Если приложение инициирует выборочную очистку данных (что необязательно), все корпоративные данные будут удалены.

До выхода пользователя из системы приложение должно вызвать следующий метод в экземпляре `IntuneMAMEnrollmentManager`:

```objc
/*
 *  This method will remove the provided account from the list of
 *  registered accounts.  Once removed, if the account has enrolled
 *  the application, the account will be un-enrolled.
 *  @note In the case where an un-enroll is required, this method will block
 *  until the Intune APP AAD token is acquired, then return.  This method must be called before  
 *  the user is removed from the application (so that required AAD tokens are not purged
 *  before this method is called).
 *  @param identity The UPN of the account to be removed.
 *  @param doWipe   If YES, a selective wipe if the account is un-enrolled
 */
(void)deRegisterAndUnenrollAccount:(NSString *)identity withWipe:(BOOL)doWipe;
```

Этот метод должен вызываться до удаления токенов Azure AD учетной записи пользователя. Пакету SDK требуется, чтобы токены AAD учетной записи пользователя выполняли определенные запросы к службе Intune MAM от имени пользователя.

Если приложение самостоятельно удалит корпоративные данные пользователя, для флага `doWipe` можно задать значение false. В противном случае пакет SDK в приложении может инициировать выборочную очистку данных. Это приведет к вызову делегата выборочной очистки данных приложения.

Пример:

```objc
[[IntuneMAMEnrollmentManager instance] deRegisterAndUnenrollAccount:@"user@foo.com" withWipe:YES];
```

## <a name="status-result-and-debug-notifications"></a>Уведомления о состоянии, результатах и отладке

Приложение может получать уведомления о состоянии, результатах и отладке для следующих запросов в службе MAM Intune:

* запросы на регистрацию;
* запросы на обновление политики;
* запросы на отмену регистрации.

Уведомления передаются через методы делегата в `IntuneMAMEnrollmentDelegate.h`:

```objc
/**
 *  Called when an enrollment request operation is completed.
 * @param status status object containing debug information
 */

(void)enrollmentRequestWithStatus:(IntuneMAMEnrollmentStatus *)status;

/**
 *  Called when a MAM policy request operation is completed.
 *  @param status status object containing debug information
 */
(void)policyRequestWithStatus:(IntuneMAMEnrollmentStatus *)status;

/**
 *  Called when a un-enroll request operation is completed.
 *  @Note: when a user is un-enrolled, the user is also de-registered with the SDK
 *  @param status status object containing debug information
 */

(void)unenrollRequestWithStatus:(IntuneMAMEnrollmentStatus *)status;
```

Эти методы делегата возвращают объект `IntuneMAMEnrollmentStatus`, который содержит следующую информацию:

* Удостоверение учетной записи, связанной с запросом
* Код состояния, обозначающий результат запроса.
* Строка ошибки с описанием кода состояния
* Объект `NSError`. Этот объект определяется в `IntuneMAMEnrollmentStatus.h` вместе с конкретными кодами состояния, которые могут возвратиться.

### <a name="sample-code"></a>Образец кода

Ниже приведены примеры реализации методов делегата:

```objc
- (void)enrollmentRequestWithStatus:(IntuneMAMEnrollmentStatus*)status
{
    NSLog(@"enrollment result for identity %@ with status code %ld", status.identity, (unsigned long)status.statusCode);
    NSLog(@"Debug Message: %@", status.errorString);
}

- (void)policyRequestWithStatus:(IntuneMAMEnrollmentStatus*)status
{
    NSLog(@"policy check-in result for identity %@ with status code %ld", status.identity, (unsigned long)status.statusCode);
    NSLog(@"Debug Message: %@", status.errorString);
}

- (void)unenrollRequestWithStatus:(IntuneMAMEnrollmentStatus*)status
{
    NSLog(@"un-enroll result for identity %@ with status code %ld", status.identity, (unsigned long)status.statusCode);
    NSLog(@"Debug Message: %@", status.errorString);
}
```

## <a name="application-restart"></a>Перезапуск приложения

Когда приложение впервые получает политики MAM, требуется перезапустить его для применения необходимых обработчиков. Чтобы уведомить приложение о необходимости перезапуска, пакет SDK предоставляет метод делегата в `IntuneMAMPolicyDelegate.h`.

```objc
 - (BOOL) restartApplication
```

Возвращаемое значение этого метода сообщает SDK, нужно ли приложению выполнить требуемый перезапуск:

* Если возвращается значение true, за обработку перезапуска должно отвечать приложение.

* Если возвращается значение False, пакет SDK перезапускает приложение. Пакет SDK сразу покажет диалоговое окно с сообщением о том, что пользователю необходимо перезапустить приложение.

## <a name="customize-your-apps-behavior-with-apis"></a>Настройка поведения приложения с помощью интерфейсов API

Пакет SDK для приложений Intune включает несколько API, которые можно вызвать, чтобы получить сведения о политике приложений Intune, которые были развернуты для приложения. Эти сведения можно использовать для настройки поведения приложения. В следующей таблице приведены сведения о некоторых важных классах Intune, которые вы будете использовать:

Class | Описание:
----- | -----------
IntuneMAMPolicyManager.h | Класс IntuneMAMPolicyManager предоставляет политику приложений Intune, которая была развернута для приложения. В частности, он предоставляет интерфейсы API, которые удобны для [Включения множественного удостоверения](app-sdk-ios.md#enable-multi-identity-optional). |
IntuneMAMPolicy.h | Класс IntuneMAMPolicy предоставляет некоторые параметры политики MAM, которые применяются к приложению. Эти параметры политики доступны для настройки пользовательского интерфейса приложения. Большинство параметров политики применяется пакетом SDK, а не приложением. Единственный параметр, который нужно реализовать в приложении, — элемент управления "Сохранить как". Этот класс предоставляет некоторые интерфейсы API, необходимые для реализации элемента управления "Сохранить как". |
IntuneMAMFileProtectionManager.h | Класс IntuneMAMFileProtectionManager предоставляет интерфейсы API, которые приложение может использовать для защиты файлов и каталогов явным образом на основе предоставленного удостоверения. Для удостоверения можно применить или отменить управление Intune, а пакет SDK применит соответствующую политику MAM. Использование этого класса не является обязательным. |
IntuneMAMDataProtectionManager.h | Класс IntuneMAMDataProtectionManager предоставляет API, которые приложение может использовать для защиты буферов данных, учитывая указанное удостоверение. Для удостоверения можно применить или отменить управление Intune, а пакет SDK применит соответствующее шифрование. |

## <a name="implement-allowed-accounts"></a>Реализация разрешенных учетных записей

Intune позволяет ИТ-администраторам указывать, какие учетные записи могут входить в систему. Приложения могут отправлять запросы к Intune App SDK для получения указанного списка разрешенных учетных записей, а затем гарантировать, что войти на устройство могут только разрешенные учетные записи.

Чтобы запросить разрешенные учетные записи, приложение должно проверить свойство `allowedAccounts` в `IntuneMAMEnrollmentManager`. Свойство `allowedAccounts` является либо массивом, содержащим допустимые учетные записи, либо пустым. Если свойство пустое, то допустимые учетные записи не указаны.

Приложения также могут реагировать на изменения свойства `allowedAccounts`, просматривая уведомление `IntuneMAMAllowedAccountsDidChangeNotification`. Уведомление отправляется каждый раз, когда свойство `allowedAccounts` изменяется.

## <a name="implement-save-as-and-open-from-controls"></a>Реализация элементов управления "Сохранить как" и "Открыть из"

Служба Intune позволяет ИТ-администраторам выбирать места хранения, в которых управляемое приложение может сохранять данные или из которых оно может открывать данные. Приложения могут запрашивать разрешенные места сохранения у пакета SDK для Intune MAM с помощью интерфейса API `isSaveToAllowedForLocation`, который определен в файле `IntuneMAMPolicy.h`. Приложения также могут запрашивать разрешенные места открытия у пакета SDK для Intune MAM с помощью интерфейса API `isOpenFromAllowedForLocation`, который определен в файле `IntuneMAMPolicy.h`.

Перед тем как приложения смогут сохранить управляемые данные в облачном или локальном расположении, они должны вызвать API `isSaveToAllowedForLocation`, чтобы определить, разрешил ли ИТ-администратор сохранение данных в этом месте.
Перед открытием данных в приложении из облачного хранилища или локального расположения приложение должно выполнить проверку с помощью API `isOpenFromAllowedForLocation`, чтобы узнать, разрешил ли ИТ-администратор открывать данные.

При использовании API `isSaveToAllowedForLocation` или `isOpenFromAllowedForLocation` приложение должно передать имя субъекта-пользователя в расположение для хранения данных, если оно доступно.

### <a name="supported-save-locations"></a>Поддерживаемые расположения сохранения

API `isSaveToAllowedForLocation` предоставляет константы, указывающие, разрешил ли ИТ-администратор сохранять данные в следующих расположениях, определенных в `IntuneMAMPolicy.h`:

* IntuneMAMSaveLocationOther;
* IntuneMAMSaveLocationOneDriveForBusiness
* IntuneMAMSaveLocationSharePoint;
* IntuneMAMSaveLocationLocalDrive.
* IntuneMAMSaveLocationAccountDocument

Приложения должны использовать константы в `isSaveToAllowedForLocation` для проверки того, можно ли сохранять данные в расположениях, считающихся управляемыми (например, в OneDrive для бизнеса) или личными. Кроме того, этот API следует использовать, если приложению не удается проверить, является ли расположение управляемым или личным.

Константу `IntuneMAMSaveLocationLocalDrive` следует использовать, если приложение сохраняет данные в каком-либо месте на локальном устройстве.

Если учетная запись для целевого расположения неизвестна, то необходимо передать `nil`. Расположение `IntuneMAMSaveLocationLocalDrive` всегда должно быть подключено к учетной записи `nil`.

### <a name="supported-open-locations"></a>Поддерживаемые открытые расположения

API `isOpenFromAllowedForLocation` предоставляет константы, указывающие, разрешил ли ИТ-администратор открывать данные из следующих расположений, определенных в `IntuneMAMPolicy.h`.

* IntuneMAMOpenLocationOther
* IntuneMAMOpenLocationOneDriveForBusiness
* IntuneMAMOpenLocationSharePoint
* IntuneMAMOpenLocationCamera
* IntuneMAMOpenLocationLocalStorage
* IntuneMAMOpenLocationAccountDocument

Приложения должны использовать константы в `isOpenFromAllowedForLocation` для проверки того, можно ли открывать данные из расположений, считающихся управляемыми (например, в OneDrive для бизнеса) или личными. Кроме того, этот API следует использовать, если приложению не удается проверить, является ли расположение управляемым или личным.

Константа `IntuneMAMOpenLocationCamera` должна использоваться, когда приложение открывает данные с камеры или из фотоальбома.

Константу `IntuneMAMOpenLocationLocalStorage` следует использовать, если приложение открывает данные из расположения на локальном устройстве.

Константу `IntuneMAMOpenLocationAccountDocument` следует использовать, если приложение открывает документ с удостоверением управляемой учетной записи (см. раздел "Общие данные" ниже)

Если учетная запись для исходного расположения неизвестна, необходимо передать `nil`. Расположения `IntuneMAMOpenLocationLocalStorage` и `IntuneMAMOpenLocationCamera` всегда должны быть подключены к учетной записи `nil`.

### <a name="unknown-or-unlisted-locations"></a>Неизвестные или неуказанные расположения

Если нужное расположение не указано в списке в перечислениях `IntuneMAMSaveLocation` или `IntuneMAMOpenLocation` или неизвестно, следует использовать одно из двух расположений.
* Если доступ к расположению сохранения осуществляется с помощью управляемой учетной записи, следует использовать расположение `IntuneMAMSaveLocationAccountDocument` (`IntuneMAMOpenLocationAccountDocument` для открытия).
* В противном случае используйте расположение `IntuneMAMSaveLocationOther` (`IntuneMAMOpenLocationOther` для открытия).

Важно четко различать управляемую учетную запись и учетную запись, которая совместно использует имя участника-пользователя управляемой учетной записи. Например, управляемая учетная запись с именем участника-пользователя "user@contoso.com", выполнившая вход в OneDrive, не совпадает с учетной записью с именем участника-пользователя "user@contoso.com", выполнившей вход в Dropbox. Если доступ к неизвестной или неуказанной службе осуществляется путем входа в управляемую учетную запись (например, "user@contoso.com" вошел в OneDrive), она должна быть представлена расположением `AccountDocument`. Если неизвестная или неуказанная служба входит в систему через другую учетную запись (например, "user@contoso.com" вошел в Dropbox), она не обращается к расположению с управляемой учетной записью и должна быть представлена расположением `Other`.

### <a name="sharing-blocked-alert"></a>Оповещение о блокировке общего доступа

Вспомогательную функцию пользовательского интерфейса можно использовать, когда API `isSaveToAllowedForLocation` или `isOpenFromAllowedForLocation` вызывается и блокирует действие сохранения или открытия. Если приложение хочет уведомить пользователя о том, что действие было заблокировано, оно может вызвать API `showSharingBlockedMessage`, определенный в `IntuneMAMUIHelper.h`, чтобы предоставить оповещение с универсальным сообщением.

## <a name="share-data-via-uiactivityviewcontroller"></a>Предоставление общего доступа к данным через UIActivityViewController

Начиная с версии 8.0.2 пакет SDK для приложений Intune может фильтровать действия `UIActivityViewController` так, чтобы для выбора были доступны только общие папки под управлением Intune. Этим поведением будет управлять политика передачи данных приложения.

### <a name="copy-to-actions"></a>Действия "Копировать в"

При предоставлении общего доступа к документам через `UIActivityViewController` и `UIDocumentInteractionController` для каждого приложения, поддерживающего открытие такого документа, в iOS отображаются действия "Копировать в". Приложения объявляют типы документов, которые они поддерживают, с помощью параметра `CFBundleDocumentTypes` в файле Info.plist. Этот тип предоставления общего доступа не будет доступен, если политика запрещает общий доступ к неуправляемым приложениям. В качестве обходного решения пользователю потребуется добавить не связанное с интерфейсом расширение действия в свое приложение и связать его с пакетом SDK для приложений Intune. Расширение действия выступает в качестве заглушки. Пакет SDK реализует возможности совместного использования файлов. Выполните инструкции, описанные ниже.

1. Приложение должно иметь по крайней мере один schemeURL, определенный в параметре `CFBundleURLTypes` файла Info.plist со своим аналогом `-intunemam`. Пример.
    ```objc
    <key>CFBundleURLSchemes</key>
    <array>
        <string>launch-com.contoso.myapp</string>
        <string>launch-com.contoso.myapp-intunemam</string>
    </array>
    ```

2. Приложение и расширение действия должны совместно использовать хотя бы одну группу приложений, которая должна быть указана в массиве `AppGroupIdentifiers` в словарях IntuneMAMSettings для приложения и расширения.

3. Как приложение, так и расширение действия должны иметь возможность совместного использования цепочки ключей и совместно использовать группу цепочки ключей `com.microsoft.intune.mam`.

4. Назовите расширение действия "Открыть в", после чего следует имя приложения. При необходимости локализуйте файл Info.plist.

5. Укажите значок шаблона для расширения, как описано в [документации по разработке Apple](https://developer.apple.com/ios/human-interface-guidelines/extensions/sharing-and-actions/). Кроме того, средство IntuneMAMConfigurator можно использовать для создания этих изображений из каталога .app приложения. Для этого выполните следующие действия:

    ```bash
    IntuneMAMConfigurator -generateOpenInIcons /path/to/app.app -o /path/to/output/directory
    ```

6. В разделе IntuneMAMSettings в файле Info.plist расширения добавьте логический параметр `OpenInActionExtension` со значением YES.

7. Настройте `NSExtensionActivationRule`, так чтобы оно поддерживало отдельный файл и все типы из `CFBundleDocumentTypes` приложения с префиксом `com.microsoft.intune.mam`. Например, если приложение поддерживает public.text и public.image, правило активации будет таким:

    ```objc
    SUBQUERY (
        extensionItems,
        $extensionItem,
        SUBQUERY (
            $extensionItem.attachments,
            $attachment,
            ANY $attachment.registeredTypeIdentifiers UTI-CONFORMS-TO "com.microsoft.intune.mam.public.text" ||
            ANY $attachment.registeredTypeIdentifiers UTI-CONFORMS-TO "com.microsoft.intune.mam.public.image").@count == 1
    ).@count == 1
    ```

### <a name="update-existing-share-and-action-extensions"></a>Обновление имеющихся расширений действия и предоставления общего доступа

Если приложение уже содержит расширения действия или предоставления общего доступа, тогда правило `NSExtensionActivationRule` будет изменено, чтобы разрешать типы Intune. Для каждого типа, поддерживаемого расширением, добавьте дополнительный тип с префиксом `com.microsoft.intune.mam`. Например, если имеющееся правило активации:  

```objc
SUBQUERY (
    extensionItems,
    $extensionItem,
    SUBQUERY (
        $extensionItem.attachments,
        $attachment,
        ANY $attachment.registeredTypeIdentifiers UTI-CONFORMS-TO "public.url" ||
        ANY $attachment.registeredTypeIdentifiers UTI-CONFORMS-TO "public.plain-text" ||
        ANY $attachment.registeredTypeIdentifiers UTI-CONFORMS-TO "public.image" ||
        ANY $attachment.registeredTypeIdentifiers UTI-CONFORMS-TO "public.data"
    ).@count > 0
).@count > 0
```

Его следует изменить на:

```objc
SUBQUERY (
    extensionItems,
    $extensionItem,
    SUBQUERY (
        $extensionItem.attachments,
        $attachment,
        ANY $attachment.registeredTypeIdentifiers UTI-CONFORMS-TO "public.url" ||
        ANY $attachment.registeredTypeIdentifiers UTI-CONFORMS-TO "public.plain-text" ||
        ANY $attachment.registeredTypeIdentifiers UTI-CONFORMS-TO "public.image" ||
        ANY $attachment.registeredTypeIdentifiers UTI-CONFORMS-TO "public.data" ||
        ANY $attachment.registeredTypeIdentifiers UTI-CONFORMS-TO "com.microsoft.intune.mam.public.url" ||
        ANY $attachment.registeredTypeIdentifiers UTI-CONFORMS-TO "com.microsoft.intune.mam.public.plain-text" ||
        ANY $attachment.registeredTypeIdentifiers UTI-CONFORMS-TO "com.microsoft.intune.mam.public.image" ||
        ANY $attachment.registeredTypeIdentifiers UTI-CONFORMS-TO "com.microsoft.intune.mam.public.data"
    ).@count > 0
).@count > 0
```

> [!NOTE]
> Средство IntuneMAMConfigurator можно использовать для добавления типов Intune в средство активации. Если имеющееся правило активации использует предварительно определенные строковые константы (например, NSExtensionActivationSupportsFileWithMaxCount, NSExtensionActivationSupportsText и т. д.), тогда синтаксис предиката может стать довольно сложным. Средство IntuneMAMConfigurator также можно использовать для преобразования правила активации из строковых констант в строку предиката при добавлении типов Intune.

### <a name="what-the-ui-should-look-like"></a>Как будет выглядеть пользовательский интерфейс

Старый пользовательский интерфейс:

![Совместное использование данных — старый пользовательский интерфейс общего доступа iOS](./media/app-sdk-ios/sharing-UI-old.png)

Новый пользовательский интерфейс:

![Совместное использование данных — новый пользовательский интерфейс общего доступа iOS](./media/app-sdk-ios/sharing-UI-new.png)

## <a name="enable-targeted-configuration-appmam-app-config-for-your-ios-applications"></a>Включение целевой конфигурации (конфигурация приложения APP/MAM) для приложений iOS

Ориентированная на MAM конфигурация (также известная как "конфигурация приложений MAM") позволяет приложению получать данные конфигурации с помощью пакета SDK для приложений Intune. Формат и варианты этих данных должны быть определены и переданы клиентам Intune владельцем или разработчиком приложения.

Администраторы Intune могут нацеливать и развертывать данные конфигурации в Intune на портале Azure и через API Graph Intune. В пакете SDK для приложений Intune для iOS версии 7.0.1 приложениям, которые входят в целевую конфигурацию MAM, можно предоставлять данные об этой конфигурации через службу MAM. Данные конфигурации приложения передаются через службу MAM непосредственно в приложения, а не по каналу MDM. Пакет SDK для приложений Intune предоставляет класс для доступа к данным, полученным из этих консолей. Ниже перечислены обязательные требования.

* Прежде чем обращаться к пользовательскому интерфейсу целевой конфигурации MAM, нужно зарегистрировать приложение с помощью службы Intune MAM. Дополнительные сведения см. в разделе [Получение политики защиты приложений](#receive-app-protection-policy).

* Включите `IntuneMAMAppConfigManager.h` в файле исходного кода приложения.

* Вызовите `[[IntuneMAMAppConfigManager instance] appConfigForIdentity:]`, чтобы получить объект конфигурации приложения.

* Вызовите подходящий селектор для объекта `IntuneMAMAppConfig`. Например, если ключ приложения является строкой, можно использовать `stringValueForKey` или `allStringsForKey`. Подробное описание возвращаемых значений и условий возникновения ошибок см. в разделе `IntuneMAMAppConfig.h`.

Дополнительные сведения о возможностях API Graph см. в [справочнике по API Graph](https://developer.microsoft.com/graph/docs/concepts/overview).

Дополнительные сведения о создании целевой политики конфигурации приложений MAM в iOS см. в разделе, посвященном целевой конфигурации MAM приложения, статьи [Использование политик конфигурации приложений Microsoft Intune для iOS/iPadOS](../apps/app-configuration-policies-use-ios.md).

## <a name="telemetry"></a>Телеметрия

По умолчанию пакет SDK для приложений Intune в iOS собирает данные телеметрии при следующих типах событий:

* **Запуск приложения**: чтобы предоставить Microsoft Intune информацию об использовании приложений с поддержкой MAM по типу управления (MAM с MDM, MAM без регистрации MDM и т. д.).

* **Вызовы регистрации**: чтобы предоставить Microsoft Intune информацию об уровне успешности и других метриках производительности вызовов регистрации со стороны клиента.

* **Действия Intune**: мы собираем сведения о действиях пакета SDK для Intune для диагностики проблем и гарантии работоспособности Intune.

> [!NOTE]
> Если вы решили не отправлять данные телеметрии пакета SDK для приложений Intune в Microsoft Intune из своего мобильного приложения, необходимо отключить фиксирование данных телеметрии пакета SDK для приложений Intune. Задайте для свойства `MAMTelemetryDisabled` значение YES (Да) в словаре IntuneMAMSettings.

## <a name="enable-multi-identity-optional"></a>Включение множественного удостоверения (необязательно)

По умолчанию пакет SDK применяет политику ко всему приложению. Использование нескольких удостоверений — это функция MAM, которую можно включить для применения политики на уровне удостоверения. Для этого требуется больше содействия со стороны приложения, чем для других функций MAM.

Приложение должно уведомить пакет SDK для приложения о том, что оно собирается сменить активное удостоверение. Пакет SDK также будет уведомлять приложение, когда требуется сменить удостоверение. Сейчас поддерживается только одно управляемое удостоверение. После регистрации приложения или устройства пользователем пакет SDK использует это удостоверение, считая его основным управляемым удостоверением. Другие пользователи в приложении будут рассматриваться как неуправляемые и не будут иметь ограничения для параметров политик.

Обратите внимание, что удостоверение определяется просто в виде строки. В удостоверениях не учитывается регистр. Запросы удостоверения, направляемые пакету SDK, могут возвращать удостоверения с регистром, отличным от изначального.

### <a name="identity-overview"></a>Общие сведения об удостоверениях

Удостоверение — это просто имя пользователя учетной записи (например, user@contoso.com). Разработчики могут задать удостоверение приложения на следующих уровнях.

* **Удостоверение процесса**: задает удостоверение всего процесса и используется в основном для приложений с одним удостоверением. Это удостоверение затрагивает все задачи, файлы и элементы пользовательского интерфейса.

* **Удостоверение пользовательского интерфейса**: определяет, какие политики применяются к задачам пользовательского интерфейса в основном потоке, таким как вырезание, копирование, вставка, ввод ПИН-кода, проверка подлинности и совместный доступ к данным. Удостоверение пользовательского интерфейса не затрагивает задачи, связанные с файлами, такие как шифрование и резервное копирование.

* **Удостоверение потока**: влияет на то, какие политики применяются к текущему потоку. Это удостоверение затрагивает все задачи, файлы и элементы пользовательского интерфейса.

Независимо от того, является ли пользователь управляемым, приложение отвечает за правильную настройку удостоверений.

В любой момент времени каждый поток имеет действующее удостоверение для задач, связанных с пользовательским интерфейсом, и задач файлов. Это удостоверение используется для определения применяемых политик (если таковые имеются). Если в качестве удостоверения задано значение "no identity" (без удостоверения) либо пользователь не является управляемым, никакие политики не применяются. На рисунках ниже показано, как определяются действующие удостоверения.

  ![Пакет SDK iOS для приложений Intune. процесс определения удостоверений](./media/app-sdk-ios/ios-thread-identities.png)

### <a name="thread-queues"></a>Очереди потоков

Приложения часто отправляют асинхронные и синхронные задачи в очереди потоков. Пакет SDK перехватывает вызовы Grand Central Dispatch (Grand Central Dispatch) и сопоставляет удостоверение текущего потока с направленными задачами. При выполнении задач пакет SDK временно меняет удостоверение потока на удостоверение, связанное с конкретной задачей, выполняет ее, а затем восстанавливает исходное удостоверение потока.


Так как `NSOperationQueue` основана на GCD, `NSOperations` будет выполняться с удостоверением потока во время добавления задач в `NSOperationQueue`. `NSOperations` или функции, отправленные напрямую при помощи GCD, также могут менять удостоверение текущего потока во время выполнения. Это удостоверение переопределяет удостоверение, унаследованное от потока диспетчеризации.

### <a name="file-owner"></a>Владелец файла

Пакет SDK отслеживает удостоверения владельцев локальных файлов и применяет нужные политики. Владелец файла задается при создании файла или при его открытии в режиме усечения. Для владельца задается действующее удостоверение для задачи, связанной с файлом, в потоке, выполняющем такую задачу.

Кроме того, приложения могут явным образом задать удостоверение для владельца файла при помощи `IntuneMAMFilePolicyManager`. Приложения могут использовать `IntuneMAMFilePolicyManager` для извлечения имени владельца файла и для задания удостоверения пользовательского интерфейса перед отображением содержимого файла.

### <a name="shared-data"></a>Файлы общих данных

Если приложение создает файлы, содержащие данные как управляемых, так и неуправляемых пользователей, оно отвечает за шифрование данных управляемых пользователей. Вы можете зашифровать данные с помощью API-интерфейсов `protect` и `unprotect` в `IntuneMAMDataProtectionManager`.

Метод `protect` принимает удостоверение, которое может относиться как к управляемому, так и к неуправляемому пользователю. Если пользователь является управляемым, данные шифруются. Если пользователь является неуправляемым, в данные добавляется заголовок, кодирующий удостоверение, но сами данные не шифруются. Метод `protectionInfo` можно использовать для извлечения владельца данных.

### <a name="share-extensions"></a>Расширения общего доступа

Если приложение содержит расширение общего доступа, владельца общего элемента можно извлечь при помощи метода `protectionInfoForItemProvider` в `IntuneMAMDataProtectionManager`. Если общий элемент является файлом, пакет SDK обрабатывает задание владельца файла. Если общий элемент — данные, приложение отвечает за задание владельца файла, если эти данные сохранены в файле, и за вызов API `setUIPolicyIdentity` перед отображением этих данных в пользовательском интерфейсе.

### <a name="turn-on-multi-identity"></a>Включение множественных удостоверений

По умолчанию приложения считаются приложениями с одним удостоверением. Пакет SDK задает удостоверение процесса для зарегистрированного пользователя. Чтобы включить поддержку множественных удостоверений, в словарь IntuneMAMSettings в файле Info.plist приложения нужно добавить логический параметр `MultiIdentity` и значение YES (Да).

> [!NOTE]
> Когда множественное удостоверение включено, удостоверениям процесса, пользовательского интерфейса и потока присваивается значение "nil". Приложение отвечает за их правильную настройку.

### <a name="switch-identities"></a>Переключение на другое удостоверение

* **Замена удостоверений, инициированная приложением**:

    При запуске приложений с множественным удостоверением считается, что они выполняются под неизвестной и неуправляемой учетной записью. Пользовательский интерфейс условного запуска не открывается, а политики не применяются к приложению. Приложение отвечает за своевременное уведомление пакета SDK о смене удостоверения. Как правило, это происходит перед тем, как приложение собирается отобразить данные для конкретной учетной записи пользователя.

    Примером служит ситуация, когда пользователь пытается открыть документ, почтовый ящик или вкладку в записной книжке. Приложению необходимо уведомить пакет SDK до фактического открытия файла, почтового ящика или вкладки. Это осуществляется посредством API `setUIPolicyIdentity` в `IntuneMAMPolicyManager`. Этот API должен вызываться независимо от того, является ли пользователь управляемым. Если пользователь является управляемым, пакет SDK выполняет проверки условного запуска, такие как обнаружение снятия ограничения на доступ к файловой системе, ПИН-код и проверка подлинности.

    Результат замены удостоверения возвращается в приложение асинхронно через завершающий обработчик. Приложение должно отложить открытие документа, почтового ящика или вкладки до тех пор, пока не будет возвращен код результата. Если переключить удостоверения не удалось, приложение должно отменить задачу.

* **Замена удостоверений, инициированная пакетом SDK**

    Иногда пакету SDK необходимо, чтобы приложение переключилось на определенное удостоверение. Для обработки этого запроса приложения с множественным удостоверением должны реализовать метод `identitySwitchRequired` в `IntuneMAMPolicyDelegate`.

    Если при вызове метода приложение может обработать запрос по переключению на указанное удостоверение, оно должно передать `IntuneMAMAddIdentityResultSuccess` в завершающий обработчик. Если приложению не удается обработать смену удостоверения, ему следует передать в завершающий обработчик значение `IntuneMAMAddIdentityResultFailed`.

    Приложению не нужно вызывать `setUIPolicyIdentity` в ответ на этот вызов. Если пакету SDK необходимо, чтобы приложение переключилось на учетную запись неуправляемого пользователя, в вызов `identitySwitchRequired` передается пустая строка.

* **Выборочная очистка**:

    Когда к приложению применяется выборочная очистка, пакет SDK вызывает метод `wipeDataForAccount` в `IntuneMAMPolicyDelegate`. Приложение отвечает за удаление учетной записи указанного пользователя и любых связанных с ней данных. Пакет SDK может удалить все файлы, принадлежащие такому пользователю, и сделает это, если приложение возвращает значение FALSE из вызова `wipeDataForAccount`.

    Обратите внимание, что этот метод вызывается из фонового потока. Приложение не должно возвращать значение до тех пор, пока все данные пользователя не будут удалены (за исключением файлов, если приложение вернет значение FALSE).

## <a name="siri-intents"></a>Намерения Siri
Если ваше приложение интегрируется с Siri, ознакомьтесь с комментариями для `areSiriIntentsAllowed` в `IntuneMAMPolicy.h`, чтобы получить инструкции по поддержке этого сценария. 
    
## <a name="notifications"></a>Уведомления
Если ваше приложение получает уведомления, ознакомьтесь с комментариями для `notificationPolicy` в `IntuneMAMPolicy.h`, чтобы получить инструкции по поддержке этого сценария.  Рекомендуется регистрировать приложения для `IntuneMAMPolicyDidChangeNotification`, как описано в `IntuneMAMPolicyManager.h`, и передавать это значение в `UNNotificationServiceExtension` через цепочку ключей.
## <a name="displaying-web-content-within-application"></a>Отображение веб-содержимого в приложении
Если приложение может отображать веб-сайты в веб-представлении, а отображаемые веб-страницы могут переходить на произвольные сайты, то приложение должно установить текущее удостоверение, чтобы предотвратить утечку управляемых данных через веб-представление. Примеры: веб-страницы "Предложить функцию" или "Обратная связь", которые содержат прямые или косвенные ссылки на поисковую систему.
Приложения с несколькими удостоверениями должны вызывать IntuneMAMPolicyManager setUIPolicyIdentity, передавая пустую строку до отображения веб-представления. После закрытия веб-представления приложение должно вызвать setUIPolicyIdentity, передавая текущее удостоверение.
Приложения с одним удостоверением должны вызывать IntuneMAMPolicyManager setCurrentThreadIdentity, передавая пустую строку до отображения веб-представления. После закрытия веб-представления приложение должно вызвать setCurrentThreadIdentity, передавая пустое значение.

## <a name="ios-best-practices"></a>Рекомендации по iOS

Ниже приведены рекомендации для разработки приложений для iOS:

* Файловая система iOS учитывает регистр. Убедитесь, что имена файлов, таких как `libIntuneMAM.a` и `IntuneMAMResources.bundle`, написаны в правильном регистре.

* Если Xcode не удается найти `libIntuneMAM.a`, можно устранить эту проблему, добавив путь к данной библиотеке в пути поиска компоновщика.

## <a name="faqs"></a>Частые вопросы

### <a name="are-all-of-the-apis-addressable-through-native-swift-or-the-objective-c-and-swift-interoperability"></a>Обращение ко всем интерфейсам API осуществляется через собственный язык Swift или за счет взаимодействия языков Objective-C и Swift?

API пакета SDK для приложений Intune используют только язык Objective-C и не поддерживают **собственный** язык Swift. Совместимость языков Swift и Objective-C является обязательной.

### <a name="do-all-users-of-my-application-need-to-be-registered-with-the-app-we-service"></a>Нужно ли регистрировать в службе APP-WE всех пользователей моего приложения?

Нет. На самом деле с использованием пакета SDK для приложений Intune требуется регистрировать только рабочие или учебные учетные записи. Именно приложения должны определять, используется ли учетная запись в контексте рабочей или учебной.

### <a name="what-about-users-that-have-already-signed-in-to-the-application-do-they-need-to-be-enrolled"></a>А что насчет пользователей, которые уже вошли в приложение? Нужно ли их регистрировать?

Приложение отвечает за регистрацию пользователей после успешной проверки подлинности. Приложение также отвечает за регистрацию существующих учетных записей, которые присутствовали еще до того, как приложение получило функции MAM без MDM.

Для этого приложение должно использовать метод `registeredAccounts:`. Этот метод возвращает NSDictionary, содержащий все учетные записи, зарегистрированные в службе MAM Intune. Если любые из имеющихся в приложении учетных записей отсутствуют в списке, приложение должно зарегистрировать их при помощи `registerAndEnrollAccount:`.

### <a name="how-often-does-the-sdk-retry-enrollments"></a>Как часто пакет SDK повторяет попытки регистрации?

Пакет SDK автоматически повторяет все ранее неудачные попытки регистрации с 24-часовым интервалом. Пакет SDK делает это для того, чтобы убедиться, что если организация пользователя включила функции MAM после его входа в приложение, пользователь будет успешно зарегистрирован и получит политики.

Пакет SDK прекратит попытки, когда обнаружит, что пользователь успешно зарегистрировал приложение. Это вызвано тем, что только один пользователь может зарегистрировать приложение в отдельный момент времени. В случае отмены регистрации пользователя повторные попытки возобновляются с тем же 24-часовым интервалом.

### <a name="why-does-the-user-need-to-be-deregistered"></a>Почему требуется отменять регистрацию пользователя?

Пакет SDK будет периодически выполнять в фоновом режиме следующие действия:

* Если приложение еще не зарегистрировано, он будет пытаться зарегистрировать все указанные учетные записи каждые 24 часа.
* Если приложение зарегистрировано, пакет SDK будет каждые 8 часов проверять наличие обновлений для политики MAM.

При отмене регистрации пользователя пакет SDK уведомляется о том, что пользователь больше не будет использовать приложение, и можно прекратить любые периодические действия для этой учетной записи. Кроме того, при необходимости вызывается отмена регистрации приложения и выборочная очистка данных.

### <a name="should-i-set-the-dowipe-flag-to-true-in-the-deregister-method"></a>Следует установить флаг doWipe в значение true в методе deregister?

Этот метод должен вызываться перед выходом пользователя из приложения.  Если в рамках выхода данные пользователя удаляются из приложения, то для `doWipe` можно задать значение False. Однако если приложение не удаляет данные пользователя, `doWipe` следует присвоить значение True, чтобы пакет SDK мог самостоятельно удалить эти данные.

### <a name="are-there-any-other-ways-that-an-application-can-be-un-enrolled"></a>Существуют другие способы отменены регистрации для приложения?

Да, ИТ-администратор может отправить команду выборочной очистки данных в приложение. Регистрация пользователя будет отменена, а данные — удалены. Пакет SDK автоматически обрабатывает эту ситуацию и отправляет уведомление через метод делегата для отмены регистрации.

### <a name="is-there-a-sample-app-that-demonstrates-how-to-integrate-the-sdk"></a>Есть ли пример приложения, в котором показано, как интегрировать пакет SDK?

Да. Мы недавно пересмотрели и обновили наше приложение-пример с открытым исходным кодом [Wagr для iOS](https://github.com/Microsoft/Wagr-Sample-Intune-iOS-App). Wagr теперь поддерживается политикой защиты в пакете SDK для приложений Intune.

### <a name="how-can-i-troubleshoot-my-app"></a>Как можно устранить неполадки в приложении?

Пакет SDK для Intune для iOS 9.0.3 и более поздних версий поддерживает возможность добавления консоли диагностики в мобильное приложение для тестирования политик и ведения журнала ошибок. `IntuneMAMDiagnosticConsole.h` определяет интерфейс `IntuneMAMDiagnosticConsole` класса, который разработчики могут использовать для отображения консоли диагностики Intune. Это позволяет конечным пользователям или разработчикам во время тестирования получать и совместно использовать журналы Intune для диагностики любых возникающих проблем. Этот API является необязательным для интеграторов.

## <a name="submit-your-app-to-the-app-store"></a>Отправка приложения в App Store

Статическая библиотека и платформенные сборки пакета SDK для приложений Intune являются универсальными двоичными файлами. Это означает, что у них есть код для всех архитектур устройств и симуляторов. Apple отклоняет приложения, отправляемые в App Store, если они содержат код симулятора. При компиляции со статической библиотекой для сборок, предназначенных только для устройств, компоновщик автоматически удаляет код симуляторов. Выполните описанные ниже действия, чтобы убедиться в удалении всего кода симулятора, прежде чем отправлять приложение в магазин приложений.

1. Убедитесь, что `IntuneMAM.framework` находится на вашем рабочем столе.

2. Выполните следующие команды:

    ```bash
    lipo ~/Desktop/IntuneMAM.framework/IntuneMAM -remove i386 -remove x86_64 -output ~/Desktop/IntuneMAM.device_only
    ```

    ```bash
    cp ~/Desktop/IntuneMAM.device_only ~/Desktop/IntuneMAM.framework/IntuneMAM
    ```

    Первая команда удаляет архитектуры симулятора из DYLIB-файла платформы. Вторая команда копирует в каталог платформы DYLIB-файл, предназначенный только для устройств.
